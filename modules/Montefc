<h2 id='montefc'>MONTEFC()</h2>
<ul>
<li>Calculates collision events and updates diffusion and velocity.</li>
<li>Handles terminations at fixed drfit times.</li>
<li>Solves motion in coordinate system with Magnetic field aligned to X-axis and electric field at an angle <code>BTHETA</code> in the X-Z plane</li>
<li>The results for velocity vectors are then rotated into the standard coordinate frame with the electric field along the Z-axis and magnetic field at an angle <code>BTHETA</code> to the electric field in X-Z plane.</li>
</ul>
<h3 id='arguments'>Arguments</h3>
<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NONE</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id='pseudo-code'>Pseudo Code</h3><pre class="highlight fortran tab-fortran"><code><span class="w">      </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">MONTEFC</span><span class="w">                                                
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">H</span><span class="p">,</span><span class="n">O</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="w"> 
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">INTEGER</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">N</span><span class="p">)</span><span class="w">                                        
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">INPT</span><span class="p">/</span><span class="n">NGAS</span><span class="p">,</span><span class="n">NSTEP</span><span class="p">,</span><span class="n">NANISO</span><span class="p">,</span><span class="n">EFINAL</span><span class="p">,</span><span class="n">ESTEP</span><span class="p">,</span><span class="n">AKT</span><span class="p">,</span><span class="n">ARY</span><span class="p">,</span><span class="n">TEMPC</span><span class="p">,</span><span class="n">TORR</span><span class="p">,</span><span class="n">IPEN</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">INPT1</span><span class="p">/</span><span class="n">NDVEC</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CNSTS1</span><span class="p">/</span><span class="n">CONST1</span><span class="p">,</span><span class="n">CONST2</span><span class="p">,</span><span class="n">CONST3</span><span class="p">,</span><span class="n">CONST4</span><span class="p">,</span><span class="n">CONST5</span><span class="w">                  
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">SETP</span><span class="p">/</span><span class="n">TMAX</span><span class="p">,</span><span class="n">SMALL</span><span class="p">,</span><span class="n">API</span><span class="p">,</span><span class="n">ESTART</span><span class="p">,</span><span class="n">THETA</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">TCFMAX</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">TCFMAX1</span><span class="p">,</span><span class="w">
     </span><span class="p">/</span><span class="n">RSTART</span><span class="p">,</span><span class="n">EFIELD</span><span class="p">,</span><span class="n">ETHRM</span><span class="p">,</span><span class="n">ECUT</span><span class="p">,</span><span class="n">NDELTA</span><span class="p">,</span><span class="n">IMIP</span><span class="p">,</span><span class="n">IWRITE</span><span class="w">  
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">BFLD</span><span class="p">/</span><span class="n">EOVB</span><span class="p">,</span><span class="n">WB</span><span class="p">,</span><span class="n">BTHETA</span><span class="p">,</span><span class="n">BMAG</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">LARGE</span><span class="p">/</span><span class="n">CF</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span><span class="n">EIN</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">TCF</span><span class="p">(</span><span class="mi">20000</span><span class="p">),</span><span class="n">IARRY</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="w">    
     </span><span class="p">/</span><span class="n">RGAS</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">IPN</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">WPL</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">IZBR</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">IPLAST</span><span class="p">,</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">512</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">LARGEN</span><span class="p">/</span><span class="n">CFN</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span><span class="n">TCFN</span><span class="p">(</span><span class="mi">20000</span><span class="p">),</span><span class="n">SCLENUL</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span><span class="n">NPLAST</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">OUTPT</span><span class="p">/</span><span class="n">ICOLL</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span><span class="n">NETOT</span><span class="p">,</span><span class="n">NPRIME</span><span class="p">,</span><span class="n">TMAX1</span><span class="p">,</span><span class="n">TIME</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">NNULL</span><span class="p">,</span><span class="w"> 
     </span><span class="p">/</span><span class="n">NITOT</span><span class="p">,</span><span class="n">ICOLN</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">ICOLNN</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span><span class="n">NREAL</span><span class="p">,</span><span class="n">NEXCTOT</span><span class="w">  
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">RLTVY</span><span class="p">/</span><span class="n">BET</span><span class="p">(</span><span class="mi">20000</span><span class="p">),</span><span class="n">GAM</span><span class="p">(</span><span class="mi">20000</span><span class="p">),</span><span class="n">VC</span><span class="p">,</span><span class="n">EMS</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">STTS</span><span class="p">/</span><span class="n">XST</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">YST</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">ZST</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">TST</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">TTIME</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">NFGF</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">NFGPP</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">NFGBR</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">NELEC</span><span class="p">,</span><span class="w">
     </span><span class="p">/</span><span class="n">NEGION</span><span class="p">,</span><span class="n">EST1</span><span class="p">,</span><span class="n">EST2</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">STEXC</span><span class="p">/</span><span class="n">XSTEXC</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">YSTEXC</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">ZSTEXC</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">TSTEXC</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">NSTEXC</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">STEXCNUL</span><span class="p">/</span><span class="n">XSTN</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">YSTN</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">ZSTN</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">TSTN</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">IDNUL</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">NEXCNUL</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">IONC</span><span class="p">/</span><span class="kt">DOUBLE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">20000</span><span class="p">),</span><span class="n">CMINIXSC</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">CMINEXSC</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">ECLOSS</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">WPLN</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">ICOUNT</span><span class="p">,</span><span class="n">AVPFRAC</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">IONFL</span><span class="p">/</span><span class="n">NC0</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">EC0</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">NG1</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">EG1</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">NG2</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EG2</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">WKLM</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">DSTFL</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">IONMOD</span><span class="p">/</span><span class="n">ESPLIT</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">IONMODEL</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span><span class="w"> 
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">ANIS</span><span class="p">/</span><span class="n">PSCT</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span><span class="n">ANGCT</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span><span class="nb">INDEX</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">NISO</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CASRS</span><span class="p">/</span><span class="n">ECAS</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">XCAS</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">YCAS</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">ZCAS</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">DRXS</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRYS</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">DRZS</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">TT1</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">NFLGF</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">NFLGPP</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">IEVNTL</span><span class="w">     
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">COMP</span><span class="p">/</span><span class="n">LCMP</span><span class="p">,</span><span class="n">LCFLG</span><span class="p">,</span><span class="n">LRAY</span><span class="p">,</span><span class="n">LRFLG</span><span class="p">,</span><span class="n">LPAP</span><span class="p">,</span><span class="n">LPFLG</span><span class="p">,</span><span class="n">LBRM</span><span class="p">,</span><span class="n">LBFLG</span><span class="p">,</span><span class="n">LPEFLG</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">BREMG</span><span class="p">/</span><span class="n">EBRGAM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">BRDCOSX</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">BRDCOSY</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">BRDCOSZ</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">BRX</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">BRY</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">BRZ</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">BRT</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">EBRTOT</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">NBREM</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> 
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CASRSB</span><span class="p">/</span><span class="n">ECASB</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">XCASB</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">YCASB</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">ZCASB</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRXB</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">DRYB</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">DRZB</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">TTB1</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">NFLGFB</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">NFLGPPB</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">IEVNTLB</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CASRSE</span><span class="p">/</span><span class="n">ECASE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">XCASE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">YCASE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">ZCASE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRXCE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">DRYCE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">DRZCE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">TCASE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">NFLGFE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">NFLGPPE</span><span class="p">(</span><span class="mi">400</span><span class="p">),</span><span class="n">IEVENTE</span><span class="w">     
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">ECASC</span><span class="p">/</span><span class="n">NEGAS</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">LEGAS</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">IESHELL</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">IECASC</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">IDEXC</span><span class="p">/</span><span class="n">NGEXC1</span><span class="p">,</span><span class="n">NGEXC2</span><span class="p">,</span><span class="n">NGEXC3</span><span class="p">,</span><span class="n">NGEXC4</span><span class="p">,</span><span class="n">NGEXC5</span><span class="p">,</span><span class="n">NGEXC6</span><span class="p">,</span><span class="w">
     </span><span class="p">/</span><span class="n">IDG1</span><span class="p">,</span><span class="n">IDG2</span><span class="p">,</span><span class="n">IDG3</span><span class="p">,</span><span class="n">IDG4</span><span class="p">,</span><span class="n">IDG5</span><span class="p">,</span><span class="n">IDG6</span><span class="w">
      </span><span class="k">DIMENSION</span><span class="w"> </span><span class="n">XS</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">YS</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">ZS</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">TS</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">ES</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DCX</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">DCY</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">DCZ</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">NFLGFC</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">NFLGPPC</span><span class="p">(</span><span class="mi">150000</span><span class="p">),</span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="mi">150000</span><span class="p">)</span><span class="w">           
      </span><span class="k">DIMENSION</span><span class="w"> </span><span class="n">TEMP</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span><span class="w"> 
</span><span class="n">C</span><span class="w"> </span><span class="o">-------------------------------------------------------------------</span><span class="w"> 
</span><span class="n">C</span><span class="w">   </span><span class="n">RELATIVISTIC</span><span class="w"> </span><span class="n">VERSION</span><span class="w">  
</span><span class="n">C</span><span class="w">   </span><span class="n">CALCULATES</span><span class="w"> </span><span class="n">COLLISION</span><span class="w"> </span><span class="n">EVENTS</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">UPDATES</span><span class="w"> </span><span class="n">DIFFUSION</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">VELOCITY</span><span class="err">.</span><span class="w">
</span><span class="n">C</span><span class="w">   </span><span class="n">THIS</span><span class="w"> </span><span class="n">ROUTINE</span><span class="w"> </span><span class="n">HANDLES</span><span class="w"> </span><span class="n">TERMINATIONS</span><span class="w"> </span><span class="n">AT</span><span class="w"> </span><span class="n">FIXED</span><span class="w"> </span><span class="n">DRIFT</span><span class="w"> </span><span class="n">TIMES</span><span class="err">.</span><span class="w"> 
</span><span class="n">C</span><span class="w">   </span><span class="n">SOLVES</span><span class="w"> </span><span class="n">MOTION</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">COORDINATE</span><span class="w"> </span><span class="n">SYSTEM</span><span class="w"> </span><span class="n">WITH</span><span class="w"> </span><span class="n">BFIELD</span><span class="w"> </span><span class="n">ALIGNED</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">AXIS</span><span class="w">
</span><span class="n">C</span><span class="w">   </span><span class="n">ELECTRIC</span><span class="w"> </span><span class="n">FIELD</span><span class="w"> </span><span class="n">AT</span><span class="w"> </span><span class="n">AN</span><span class="w"> </span><span class="n">ANGLE</span><span class="w"> </span><span class="n">BTHETA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="n">PLANE</span><span class="err">.</span><span class="w">
</span><span class="n">C</span><span class="w">   </span><span class="n">THE</span><span class="w"> </span><span class="n">RESULTS</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">VELOCITY</span><span class="w"> </span><span class="n">VECTORS</span><span class="w">  </span><span class="n">ARE</span><span class="w"> </span><span class="k">THEN</span><span class="w"> 
</span><span class="n">C</span><span class="w">   </span><span class="n">ROTATED</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">STANDARD</span><span class="w"> </span><span class="n">COORDINATE</span><span class="w"> </span><span class="n">FRAME</span><span class="w"> </span><span class="n">WITH</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">ELECTRIC</span><span class="w"> </span><span class="n">FIELD</span><span class="w"> 
</span><span class="n">C</span><span class="w">   </span><span class="n">ALONG</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">Z</span><span class="o">-</span><span class="n">AXIS</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">BFIELD</span><span class="w"> </span><span class="n">AT</span><span class="w"> </span><span class="n">AN</span><span class="w"> </span><span class="n">ANGLE</span><span class="w"> </span><span class="n">BTHETA</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">ELECTRIC</span><span class="w">
</span><span class="n">C</span><span class="w">   </span><span class="n">FIELD</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Z</span><span class="w"> </span><span class="n">PLANE</span><span class="w">  
</span><span class="n">C</span><span class="w"> </span><span class="o">-------------------------------------------------------------------</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">VARYING</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">STEPS</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">EFINAL</span><span class="ow">.LE.</span><span class="mf">140000.</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">ESTEP1</span><span class="o">=</span><span class="p">(</span><span class="n">EFINAL</span><span class="mf">-16000.0</span><span class="p">)/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="mi">4000</span><span class="p">)</span><span class="w">
      </span><span class="k">ELSE</span><span class="w">
        </span><span class="n">ESTEP1</span><span class="o">=</span><span class="mf">20.0</span><span class="w">
        </span><span class="n">ESTEP2</span><span class="o">=</span><span class="p">(</span><span class="n">EFINAL</span><span class="mf">-92000.0</span><span class="p">)/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="mi">4000</span><span class="p">)</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
      </span><span class="n">NPRINT</span><span class="o">=</span><span class="mi">0</span><span class="w"> 
      </span><span class="n">J20000</span><span class="o">=</span><span class="mi">20000</span><span class="w">
      </span><span class="n">J300</span><span class="o">=</span><span class="mi">300</span><span class="w">
      </span><span class="n">API</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">-1.0D0</span><span class="p">)</span><span class="w">
      </span><span class="n">SMALL</span><span class="o">=</span><span class="mf">1.0D-20</span><span class="w">
      </span><span class="n">EMAX</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">TMAX1</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">RDUM</span><span class="o">=</span><span class="n">RSTART</span><span class="w">
      </span><span class="n">CONST9</span><span class="o">=</span><span class="n">CONST3</span><span class="o">*</span><span class="mf">0.01D0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">300</span><span class="w">
   </span><span class="mi">25</span><span class="w"> </span><span class="n">TIME</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="w">
   </span><span class="mi">26</span><span class="w"> </span><span class="n">ICOLL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">512</span><span class="w">
   </span><span class="mi">27</span><span class="w"> </span><span class="n">ICOLN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NREAL</span><span class="o">=</span><span class="mi">0</span><span class="w">           
      </span><span class="n">NNULL</span><span class="o">=</span><span class="mi">0</span><span class="w">                                                           
      </span><span class="n">NETOT</span><span class="o">=</span><span class="mi">0</span><span class="w"> 
      </span><span class="n">NEXCTOT</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NITOT</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NMXADD</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NTMPFLG</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALC</span><span class="w"> </span><span class="n">ROTATION</span><span class="w"> </span><span class="n">MATRIX</span><span class="w"> </span><span class="n">ANGLES</span><span class="w">
      </span><span class="n">RCS</span><span class="o">=</span><span class="n">DCOS</span><span class="p">((</span><span class="n">BTHETA</span><span class="mf">-90.0D0</span><span class="p">)</span><span class="o">*</span><span class="n">API</span><span class="p">/</span><span class="mf">180.0D0</span><span class="p">)</span><span class="w">
      </span><span class="n">RSN</span><span class="o">=</span><span class="n">DSIN</span><span class="p">((</span><span class="n">BTHETA</span><span class="mf">-90.0D0</span><span class="p">)</span><span class="o">*</span><span class="n">API</span><span class="p">/</span><span class="mf">180.0D0</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w"> 
      </span><span class="n">RTHETA</span><span class="o">=</span><span class="n">BTHETA</span><span class="o">*</span><span class="n">API</span><span class="p">/</span><span class="mf">180.0D0</span><span class="w">
      </span><span class="n">EFZ100</span><span class="o">=</span><span class="n">EFIELD</span><span class="o">*</span><span class="mf">100.0D0</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">RTHETA</span><span class="p">)</span><span class="w">
      </span><span class="n">EFX100</span><span class="o">=</span><span class="n">EFIELD</span><span class="o">*</span><span class="mf">100.0D0</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">RTHETA</span><span class="p">)</span><span class="w">
      </span><span class="n">F1</span><span class="o">=</span><span class="n">EFIELD</span><span class="o">*</span><span class="n">CONST2</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">RTHETA</span><span class="p">)</span><span class="w">
      </span><span class="n">F4</span><span class="o">=</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">API</span><span class="w">
      </span><span class="n">EOVBR</span><span class="o">=</span><span class="n">EOVB</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">RTHETA</span><span class="p">)</span><span class="w">
      </span><span class="n">THETA1</span><span class="o">=</span><span class="n">THETA</span><span class="w">
      </span><span class="n">PHI1</span><span class="o">=</span><span class="n">PHI</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">MAXIMUM</span><span class="w"> </span><span class="n">COLLISION</span><span class="w"> </span><span class="n">FREQUENCY</span><span class="w">
      </span><span class="n">TLIM</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">111</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">20000</span><span class="w">
      </span><span class="n">TEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">TCFN</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">+</span><span class="n">TCF</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w"> 
      </span><span class="k">IF</span><span class="p">(</span><span class="n">TLIM</span><span class="ow">.LT.</span><span class="n">TEMP</span><span class="p">(</span><span class="n">J</span><span class="p">))</span><span class="w"> </span><span class="n">TLIM</span><span class="o">=</span><span class="n">TEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w"> 
  </span><span class="mi">111</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="n">NEOVFL</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">J1</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">START</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">PRIMARY</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="n">LOOP</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">210</span><span class="w"> </span><span class="n">J11</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NDELTA</span><span class="w">
      </span><span class="n">J1</span><span class="o">=</span><span class="n">J1</span><span class="mi">+1</span><span class="w">
      </span><span class="n">NPRIME</span><span class="o">=</span><span class="n">J1</span><span class="w">
      </span><span class="n">NGEXC1</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NGEXC2</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NGEXC3</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NGEXC4</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NGEXC5</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NGEXC6</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">INITIAL</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w"> </span><span class="n">COSINES</span><span class="w"> 
      </span><span class="k">IF</span><span class="p">(</span><span class="n">THETA1</span><span class="ow">.EQ.</span><span class="p">(</span><span class="n">API</span><span class="p">/</span><span class="mf">2.0</span><span class="p">)</span><span class="ow">.OR.</span><span class="n">NDVEC</span><span class="ow">.NE.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w">  </span><span class="k">ONLY</span><span class="w"> </span><span class="n">ALLOW</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">DELTA</span><span class="w"> </span><span class="n">IS</span><span class="w"> </span><span class="n">ALONG</span><span class="w"> </span><span class="n">E</span><span class="o">-</span><span class="n">FIELD</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w">
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span><span class="w"> 
   </span><span class="mi">22</span><span class="w">  </span><span class="k">FORMAT</span><span class="p">(</span><span class="l">2</span><span class="p">(</span><span class="l">/</span><span class="p">),</span><span class="l">3X</span><span class="p">,</span><span class="s1">'PROGRAM STOPPED ONLY ALLOWED TO HAVE DELTA ELECTR
     /ON PRALLEL TO E-FIELD IN CASE WITH ARBITRARY ANGLE FOR B-FIELD'</span><span class="p">)</span><span class="w">  
       </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FIX</span><span class="w"> </span><span class="n">DELTA</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FIELD</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w">
      </span><span class="n">PHI1</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">THETA1</span><span class="o">=</span><span class="p">(</span><span class="n">API</span><span class="p">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">-</span><span class="n">RTHETA</span><span class="w">
      </span><span class="n">DCZ1</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETA1</span><span class="p">)</span><span class="w">                                                 
      </span><span class="n">DCX1</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETA1</span><span class="p">)</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHI1</span><span class="p">)</span><span class="w">                                      
      </span><span class="n">DCY1</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETA1</span><span class="p">)</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHI1</span><span class="p">)</span><span class="w"> 
      </span><span class="n">NFLGFF</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NFLGPPP</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NFLGBRMM</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NFLGHIGH</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">EST1</span><span class="o">=</span><span class="n">ESTART</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">INITIAL</span><span class="w"> </span><span class="n">VELOCITY</span><span class="w">
      </span><span class="n">E1</span><span class="o">=</span><span class="n">ESTART</span><span class="w">
      </span><span class="n">GAM1</span><span class="o">=</span><span class="p">(</span><span class="n">EMS</span><span class="o">+</span><span class="n">E1</span><span class="p">)/</span><span class="n">EMS</span><span class="w">
      </span><span class="n">GAM12</span><span class="o">=</span><span class="n">GAM1</span><span class="w">
      </span><span class="n">BET1</span><span class="o">=</span><span class="n">DSQRT</span><span class="p">(</span><span class="mf">1.0D0-1.0D0</span><span class="p">/(</span><span class="n">GAM1</span><span class="o">*</span><span class="n">GAM1</span><span class="p">))</span><span class="w">
      </span><span class="n">VTOT</span><span class="o">=</span><span class="n">BET1</span><span class="o">*</span><span class="n">VC</span><span class="o">*</span><span class="mf">1.0D-12</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">VTOT</span><span class="o">=</span><span class="n">CONST9</span><span class="o">*</span><span class="n">DSQRT</span><span class="p">(</span><span class="n">E1</span><span class="p">)</span><span class="w">
      </span><span class="n">CX1</span><span class="o">=</span><span class="n">DCX1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">CY1</span><span class="o">=</span><span class="n">DCY1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">CZ1</span><span class="o">=</span><span class="n">DCZ1</span><span class="o">*</span><span class="n">VTOT</span><span class="w"> 
      </span><span class="n">X</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">Y</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">Z</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">K1</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">KEXC</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NSTEXC</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NEXCNUL</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NCLUS</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NELEC</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NEGION</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">TLAST</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ST</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">TDASH</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">  
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IMIP</span><span class="ow">.EQ.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">1</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IMIP</span><span class="ow">.GT.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">READIN</span><span class="w"> </span><span class="n">FIRST</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">BETA</span><span class="w"> </span><span class="n">DECAY</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">RAY</span><span class="w"> </span><span class="n">UNTHERMALISED</span><span class="w"> </span><span class="n">CLUSTERS</span><span class="w">
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">CASRES</span><span class="p">(</span><span class="n">J11</span><span class="p">,</span><span class="n">IBADTOT</span><span class="p">,</span><span class="n">IBAD1</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">  </span><span class="n">SKIP</span><span class="w"> </span><span class="n">BAD</span><span class="w"> </span><span class="n">EVENT</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">IBAD1</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">J1</span><span class="o">=</span><span class="n">J1</span><span class="mi">-1</span><span class="w">
        </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">210</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
      </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">IMIP</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="k">READ</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">FIRST</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">MIP</span><span class="w"> </span><span class="n">INTERACTION</span><span class="w">
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">CASREM</span><span class="p">(</span><span class="n">J11</span><span class="p">)</span><span class="w">
       </span><span class="n">EST1</span><span class="o">=</span><span class="n">ECAS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
       </span><span class="n">EST2</span><span class="o">=</span><span class="n">EST1</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
      </span><span class="n">X</span><span class="o">=</span><span class="n">XCAS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">Y</span><span class="o">=</span><span class="n">YCAS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">Z</span><span class="o">=</span><span class="n">ZCAS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">ST</span><span class="o">=</span><span class="n">TT1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">TS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">TT1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">E1</span><span class="o">=</span><span class="n">ECAS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">DCZ1</span><span class="o">=</span><span class="n">DRZS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">DCY1</span><span class="o">=</span><span class="n">DRYS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">DCX1</span><span class="o">=</span><span class="n">DRXS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGFF</span><span class="o">=</span><span class="n">NFLGF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGPPP</span><span class="o">=</span><span class="n">NFLGPP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGBRMM</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NFLGHIGH</span><span class="o">=</span><span class="n">NFLGFF</span><span class="w">
      </span><span class="n">GAM1</span><span class="o">=</span><span class="p">(</span><span class="n">EMS</span><span class="o">+</span><span class="n">E1</span><span class="p">)/</span><span class="n">EMS</span><span class="w">
      </span><span class="n">BET1</span><span class="o">=</span><span class="n">DSQRT</span><span class="p">(</span><span class="mf">1.0D0-1.0D0</span><span class="p">/(</span><span class="n">GAM1</span><span class="o">*</span><span class="n">GAM1</span><span class="p">))</span><span class="w">
      </span><span class="n">VTOT</span><span class="o">=</span><span class="n">BET1</span><span class="o">*</span><span class="n">VC</span><span class="o">*</span><span class="mf">1.0D-12</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">VTOT</span><span class="o">=</span><span class="n">CONST9</span><span class="o">*</span><span class="n">DSQRT</span><span class="p">(</span><span class="n">E1</span><span class="p">)</span><span class="w">
      </span><span class="n">CX1</span><span class="o">=</span><span class="n">DCX1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">CY1</span><span class="o">=</span><span class="n">DCY1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">CZ1</span><span class="o">=</span><span class="n">DCZ1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">PUT</span><span class="w"> </span><span class="n">REMAINDER</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">ELECTRONS</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="n">CLUSTER</span><span class="w"> </span><span class="n">STORE</span><span class="w">
      </span><span class="n">ISDUM</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="n">IST</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">IEVNTL</span><span class="w">
      </span><span class="n">ISDUM</span><span class="o">=</span><span class="n">ISDUM</span><span class="mi">+1</span><span class="w">
      </span><span class="n">XS</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">XCAS</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">YS</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">YCAS</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">ZS</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">ZCAS</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">TS</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">TT1</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">ES</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">ECAS</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">DCX</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">DRXS</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">DCY</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">DRYS</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">DCZ</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">DRZS</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGF</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGPPC</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGPP</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="n">ISDUM</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NCLUS</span><span class="o">=</span><span class="n">ISDUM</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="ow">.GT.</span><span class="n">NFLGHIGH</span><span class="p">)</span><span class="w"> </span><span class="n">NFLGHIGH</span><span class="o">=</span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">IST</span><span class="p">)</span><span class="w">
   </span><span class="mi">35</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="n">GAM12</span><span class="o">=</span><span class="n">GAM1</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">START</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">LOOP</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">NEW</span><span class="w"> </span><span class="n">ELECTRONS</span><span class="w">                                       
    </span><span class="mi">1</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w"> 
      </span><span class="n">R1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="n">T</span><span class="o">=-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">R1</span><span class="p">)/</span><span class="n">TLIM</span><span class="o">+</span><span class="n">TDASH</span><span class="w">
      </span><span class="n">TDASH</span><span class="o">=</span><span class="n">T</span><span class="w">
      </span><span class="n">WBT</span><span class="o">=</span><span class="n">WB</span><span class="o">*</span><span class="n">T</span><span class="p">/</span><span class="n">GAM12</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">WBT</span><span class="o">=</span><span class="n">WB</span><span class="o">*</span><span class="n">T</span><span class="w">
      </span><span class="n">COSWT</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">WBT</span><span class="p">)</span><span class="w">
      </span><span class="n">SINWT</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">WBT</span><span class="p">)</span><span class="w">
      </span><span class="n">DZ</span><span class="o">=</span><span class="n">GAM12</span><span class="o">*</span><span class="p">(</span><span class="n">CZ1</span><span class="o">*</span><span class="n">SINWT</span><span class="o">+</span><span class="p">(</span><span class="n">EOVBR</span><span class="o">-</span><span class="n">CY1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">COSWT</span><span class="p">))/</span><span class="n">WB</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">DZ</span><span class="o">=</span><span class="p">(</span><span class="n">CZ1</span><span class="o">*</span><span class="n">SINWT</span><span class="o">+</span><span class="p">(</span><span class="n">EOVBR</span><span class="o">-</span><span class="n">CY1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">COSWT</span><span class="p">))/</span><span class="n">WB</span><span class="w">
      </span><span class="n">DX</span><span class="o">=</span><span class="n">CX1</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="n">F1</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">/</span><span class="n">GAM12</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">DX</span><span class="o">=</span><span class="n">CX1</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="n">F1</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="w">
      </span><span class="n">E</span><span class="o">=</span><span class="n">E1</span><span class="o">+</span><span class="n">DZ</span><span class="o">*</span><span class="n">EFZ100</span><span class="o">+</span><span class="n">DX</span><span class="o">*</span><span class="n">EFX100</span><span class="w">
      </span><span class="n">GAM2</span><span class="o">=</span><span class="p">(</span><span class="n">EMS</span><span class="o">+</span><span class="n">E</span><span class="p">)/</span><span class="n">EMS</span><span class="w">
      </span><span class="n">BET2</span><span class="o">=</span><span class="n">DSQRT</span><span class="p">(</span><span class="mf">1.0D0-1.0D0</span><span class="p">/(</span><span class="n">GAM2</span><span class="o">+</span><span class="n">GAM2</span><span class="p">))</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">E</span><span class="ow">.LT.</span><span class="mf">0.0D0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="n">E</span><span class="o">=</span><span class="mf">0.001D0</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">                                                   
</span><span class="n">C</span><span class="w"> </span><span class="n">INSERT</span><span class="w"> </span><span class="n">NEW</span><span class="w"> </span><span class="n">ALGORITHM</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">FIND</span><span class="w"> </span><span class="n">IE</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">VARYING</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">STEP</span><span class="w">          
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IMIP</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">                                     
       </span><span class="n">IE</span><span class="o">=</span><span class="n">DINT</span><span class="p">(</span><span class="n">E</span><span class="p">/</span><span class="n">ESTEP</span><span class="p">)</span><span class="mi">+1</span><span class="w">                                               
      </span><span class="k">ELSE</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">EFINAL</span><span class="ow">.LE.</span><span class="mf">20000.</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">IE</span><span class="o">=</span><span class="n">DINT</span><span class="p">(</span><span class="n">E</span><span class="p">/</span><span class="n">ESTEP</span><span class="p">)</span><span class="mi">+1</span><span class="w">
       </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">EFINAL</span><span class="ow">.LE.</span><span class="mf">140000.</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">E</span><span class="ow">.LE.</span><span class="mf">16000.</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
         </span><span class="n">IE</span><span class="o">=</span><span class="n">DINT</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="mi">+1</span><span class="w">
        </span><span class="k">ELSE</span><span class="w">
         </span><span class="n">IE</span><span class="o">=</span><span class="mi">16000</span><span class="o">+</span><span class="n">DINT</span><span class="p">((</span><span class="n">E</span><span class="mf">-16000.</span><span class="p">)/</span><span class="n">ESTEP1</span><span class="p">)</span><span class="w">
        </span><span class="k">ENDIF</span><span class="w">
       </span><span class="k">ELSE</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">E</span><span class="ow">.LE.</span><span class="mf">12000.</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
         </span><span class="n">IE</span><span class="o">=</span><span class="n">DINT</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="mi">+1</span><span class="w">
        </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">E</span><span class="ow">.LE.</span><span class="mf">92000.</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
         </span><span class="n">IE</span><span class="o">=</span><span class="mi">12000</span><span class="o">+</span><span class="n">DINT</span><span class="p">((</span><span class="n">E</span><span class="mf">-12000.</span><span class="p">)/</span><span class="n">ESTEP1</span><span class="p">)</span><span class="w">
        </span><span class="k">ELSE</span><span class="w">
         </span><span class="n">IE</span><span class="o">=</span><span class="mi">16000</span><span class="o">+</span><span class="n">DINT</span><span class="p">((</span><span class="n">E</span><span class="mf">-92000.</span><span class="p">)/</span><span class="n">ESTEP2</span><span class="p">)</span><span class="w">
        </span><span class="k">ENDIF</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w"> 
      </span><span class="n">IE</span><span class="o">=</span><span class="n">DMIN0</span><span class="p">(</span><span class="n">IE</span><span class="p">,</span><span class="n">J20000</span><span class="p">)</span><span class="w">                                            
</span><span class="n">C</span><span class="w">                                                                       
</span><span class="n">C</span><span class="w">     </span><span class="n">TEST</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="kt">REAL</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">COLLISION</span><span class="w">                                   
</span><span class="n">C</span><span class="w">                                                                       
      </span><span class="n">R5</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="n">TEST1</span><span class="o">=</span><span class="n">TCF</span><span class="p">(</span><span class="n">IE</span><span class="p">)/</span><span class="n">TLIM</span><span class="w">                                                
      </span><span class="k">IF</span><span class="p">(</span><span class="n">R5</span><span class="ow">.LE.</span><span class="n">TEST1</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">137</span><span class="w">                                         
      </span><span class="n">NNULL</span><span class="o">=</span><span class="n">NNULL</span><span class="mi">+1</span><span class="w">       
      </span><span class="n">TEST2</span><span class="o">=</span><span class="n">TEMP</span><span class="p">(</span><span class="n">IE</span><span class="p">)/</span><span class="n">TLIM</span><span class="w">                      
      </span><span class="k">IF</span><span class="p">(</span><span class="n">R5</span><span class="ow">.LT.</span><span class="n">TEST2</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">TEST</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">LEVELS</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">NPLAST</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">1</span><span class="w">
       </span><span class="n">R2</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w"> 
       </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="w">
  </span><span class="mi">888</span><span class="w">  </span><span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="mi">+1</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">CFN</span><span class="p">(</span><span class="n">IE</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="ow">.LT.</span><span class="n">R2</span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">888</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">INCREMENT</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="n">LEVEL</span><span class="w"> </span><span class="nb">SUM</span><span class="w">
       </span><span class="n">NEXCNUL</span><span class="o">=</span><span class="n">NEXCNUL</span><span class="mi">+1</span><span class="w">
       </span><span class="n">ICOLNN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">ICOLNN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="mi">+1</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="n">Z</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">MOLECULAR</span><span class="w"> </span><span class="n">LIGHT</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">DISSOCIATION</span><span class="w"> </span><span class="n">FROM</span><span class="w"> 
</span><span class="n">C</span><span class="w">   </span><span class="nb">NULL</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">SMALL</span><span class="w"> </span><span class="n">APPROX</span><span class="w"> </span><span class="n">USED</span><span class="w"> </span><span class="n">POSITION</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">PREVIOUS</span><span class="w"> </span><span class="kt">REAL</span><span class="w"> </span><span class="n">COLLISION</span><span class="w">
       </span><span class="n">XSTN</span><span class="p">(</span><span class="n">NEXCNUL</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="w">
       </span><span class="n">YSTN</span><span class="p">(</span><span class="n">NEXCNUL</span><span class="p">)</span><span class="o">=</span><span class="n">Y</span><span class="w">
       </span><span class="n">ZSTN</span><span class="p">(</span><span class="n">NEXCNUL</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="w">
       </span><span class="n">TSTN</span><span class="p">(</span><span class="n">NEXCNUL</span><span class="p">)</span><span class="o">=</span><span class="n">ST</span><span class="w">
       </span><span class="n">IDNUL</span><span class="p">(</span><span class="n">NEXCNUL</span><span class="p">)</span><span class="o">=</span><span class="n">I</span><span class="w">               
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">1</span><span class="w">         
      </span><span class="k">ELSE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="nb">NULL</span><span class="w">
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">1</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">                                                 
</span><span class="n">C</span><span class="w">                                                                       
</span><span class="n">C</span><span class="w">  </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w"> </span><span class="n">COSINES</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">POSITIONS</span><span class="w"> </span><span class="n">AT</span><span class="w"> </span><span class="n">INSTANT</span><span class="w"> </span><span class="n">BEFORE</span><span class="w"> </span><span class="n">COLLISION</span><span class="w">
  </span><span class="mi">137</span><span class="w"> </span><span class="n">T2</span><span class="o">=</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">E</span><span class="ow">.GT.</span><span class="n">EMAX</span><span class="p">)</span><span class="w"> </span><span class="n">EMAX</span><span class="o">=</span><span class="n">E</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">T</span><span class="ow">.GT.</span><span class="n">TMAX1</span><span class="p">)</span><span class="w"> </span><span class="n">TMAX1</span><span class="o">=</span><span class="n">T</span><span class="w">
      </span><span class="n">TDASH</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">NREAL</span><span class="o">=</span><span class="n">NREAL</span><span class="mi">+1</span><span class="w">  
</span><span class="n">C</span><span class="w"> </span><span class="n">CALC</span><span class="w"> </span><span class="n">VELOCITY</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">CX2</span><span class="o">=</span><span class="n">CX1</span><span class="mf">+2.0</span><span class="o">*</span><span class="n">F1</span><span class="o">*</span><span class="n">T</span><span class="w">        
      </span><span class="n">CX2</span><span class="o">=</span><span class="n">CX1</span><span class="mf">+2.0</span><span class="o">*</span><span class="n">F1</span><span class="o">*</span><span class="n">T</span><span class="p">/</span><span class="n">GAM12</span><span class="w">
      </span><span class="n">CY2</span><span class="o">=</span><span class="p">(</span><span class="n">CY1</span><span class="o">-</span><span class="n">EOVBR</span><span class="p">)</span><span class="o">*</span><span class="n">COSWT</span><span class="o">+</span><span class="n">CZ1</span><span class="o">*</span><span class="n">SINWT</span><span class="o">+</span><span class="n">EOVBR</span><span class="w">
      </span><span class="n">CZ2</span><span class="o">=</span><span class="n">CZ1</span><span class="o">*</span><span class="n">COSWT</span><span class="o">-</span><span class="p">(</span><span class="n">CY1</span><span class="o">-</span><span class="n">EOVBR</span><span class="p">)</span><span class="o">*</span><span class="n">SINWT</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALC</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w"> </span><span class="n">COSINES</span><span class="w">
      </span><span class="n">VTOT</span><span class="o">=</span><span class="n">DSQRT</span><span class="p">(</span><span class="n">CX2</span><span class="o">*</span><span class="n">CX2</span><span class="o">+</span><span class="n">CY2</span><span class="o">*</span><span class="n">CY2</span><span class="o">+</span><span class="n">CZ2</span><span class="o">*</span><span class="n">CZ2</span><span class="p">)</span><span class="w">
      </span><span class="n">DCX2</span><span class="o">=</span><span class="n">CX2</span><span class="p">/</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">DCY2</span><span class="o">=</span><span class="n">CY2</span><span class="p">/</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">DCZ2</span><span class="o">=</span><span class="n">CZ2</span><span class="p">/</span><span class="n">VTOT</span><span class="w">                                                     
</span><span class="n">C</span><span class="w"> </span><span class="n">CALC</span><span class="w"> </span><span class="n">NEW</span><span class="w"> </span><span class="n">POSITION</span><span class="w">                                                
      </span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">+</span><span class="n">DX</span><span class="w">                                                            
      </span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="o">+</span><span class="n">EOVBR</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="n">GAM12</span><span class="o">*</span><span class="p">((</span><span class="n">CY1</span><span class="o">-</span><span class="n">EOVBR</span><span class="p">)</span><span class="o">*</span><span class="n">SINWT</span><span class="o">+</span><span class="n">CZ1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">COSWT</span><span class="p">))/</span><span class="n">WB</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="o">+</span><span class="n">EOVBR</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">((</span><span class="n">CY1</span><span class="o">-</span><span class="n">EOVBR</span><span class="p">)</span><span class="o">*</span><span class="n">SINWT</span><span class="o">+</span><span class="n">CZ1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">COSWT</span><span class="p">))/</span><span class="n">WB</span><span class="w">
      </span><span class="n">Z</span><span class="o">=</span><span class="n">Z</span><span class="o">+</span><span class="n">DZ</span><span class="w">          
      </span><span class="n">GAM12</span><span class="o">=</span><span class="p">(</span><span class="n">GAM1</span><span class="o">+</span><span class="n">GAM2</span><span class="p">)/</span><span class="mf">2.0D0</span><span class="w">
      </span><span class="n">ST</span><span class="o">=</span><span class="n">ST</span><span class="o">+</span><span class="n">T</span><span class="w">
      </span><span class="n">IT</span><span class="o">=</span><span class="n">DINT</span><span class="p">(</span><span class="n">T</span><span class="mf">+1.0D0</span><span class="p">)</span><span class="w">                                                  
      </span><span class="n">IT</span><span class="o">=</span><span class="n">DMIN0</span><span class="p">(</span><span class="n">IT</span><span class="p">,</span><span class="n">J300</span><span class="p">)</span><span class="w">                                               
      </span><span class="n">TIME</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span><span class="o">=</span><span class="n">TIME</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span><span class="mf">+1.0D0</span><span class="w">                                           
</span><span class="n">C</span><span class="w"> </span><span class="o">---------------------------------------------------------------------</span><span class="w"> 
</span><span class="n">C</span><span class="w">     </span><span class="n">DETERMINATION</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="kt">REAL</span><span class="w"> </span><span class="n">COLLISION</span><span class="w"> </span><span class="k">TYPE</span><span class="w">                              
</span><span class="n">C</span><span class="w"> </span><span class="o">---------------------------------------------------------------------</span><span class="w"> 
      </span><span class="n">R2</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="w">                                                               
  </span><span class="mi">140</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="mi">+1</span><span class="w">                                                             
      </span><span class="k">IF</span><span class="p">(</span><span class="n">CF</span><span class="p">(</span><span class="n">IE</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="ow">.LT.</span><span class="n">R2</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">140</span><span class="w">     
</span><span class="n">C</span><span class="o">************************************************************</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CHECK</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="n">BREMSSTRAHLUNG</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IZBR</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.NE.</span><span class="mf">0.</span><span class="n">AND</span><span class="ow">.LBRM.</span><span class="n">EQ</span><span class="mf">.1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="n">NFLGBRMM</span><span class="o">=</span><span class="mi">1</span><span class="w">
       </span><span class="n">IPT</span><span class="o">=</span><span class="n">IARRY</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
       </span><span class="n">ICOLL</span><span class="p">(</span><span class="n">IPT</span><span class="p">)</span><span class="o">=</span><span class="n">ICOLL</span><span class="p">(</span><span class="n">IPT</span><span class="p">)</span><span class="mi">+1</span><span class="w">
       </span><span class="n">ICOLN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">ICOLN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="mi">+1</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="mi">141</span><span class="w"> </span><span class="n">KNGS</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NGAS</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">IPT</span><span class="ow">.EQ.</span><span class="p">(</span><span class="n">KNGS</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">142</span><span class="w">
  </span><span class="mi">141</span><span class="w">  </span><span class="k">CONTINUE</span><span class="w">
  </span><span class="mi">142</span><span class="w">  </span><span class="n">IATOMNO</span><span class="o">=</span><span class="n">IZBR</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> 
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">BREMS</span><span class="p">(</span><span class="n">IATOMNO</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">DCX2</span><span class="p">,</span><span class="n">DCY2</span><span class="p">,</span><span class="n">DCZ2</span><span class="p">,</span><span class="n">EOUT</span><span class="p">,</span><span class="n">EDCX</span><span class="p">,</span><span class="n">EDCY</span><span class="p">,</span><span class="n">EDCZ</span><span class="p">,</span><span class="w">
     </span><span class="p">/</span><span class="n">EGAMMA</span><span class="p">,</span><span class="n">GDCX</span><span class="p">,</span><span class="n">GDCY</span><span class="p">,</span><span class="n">GDCZ</span><span class="p">)</span><span class="w">
       </span><span class="n">NBREM</span><span class="p">(</span><span class="n">KNGS</span><span class="p">)</span><span class="o">=</span><span class="n">NBREM</span><span class="p">(</span><span class="n">KNGS</span><span class="p">)</span><span class="mi">+1</span><span class="w">
       </span><span class="n">EBRTOT</span><span class="p">(</span><span class="n">KNGS</span><span class="p">)</span><span class="o">=</span><span class="n">EBRTOT</span><span class="p">(</span><span class="n">KNGS</span><span class="p">)</span><span class="o">+</span><span class="n">EGAMMA</span><span class="w">
</span><span class="n">C</span><span class="w">      </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">668</span><span class="p">)</span><span class="w"> </span><span class="n">EGAMMA</span><span class="p">,</span><span class="n">J11</span><span class="w">   
</span><span class="n">C</span><span class="w"> </span><span class="mi">668</span><span class="w"> </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' BREM EGAMMA='</span><span class="p">,</span><span class="l">D12.4</span><span class="p">,</span><span class="s1">' EVENT NO='</span><span class="p">,</span><span class="l">I5</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">GET</span><span class="w">  </span><span class="n">NEW</span><span class="w"> </span><span class="n">DRCOS</span><span class="w"> </span><span class="n">DRCOSY</span><span class="w"> </span><span class="n">DRCOSX</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w">
       </span><span class="n">E1</span><span class="o">=</span><span class="n">EOUT</span><span class="w">
       </span><span class="n">DCX1</span><span class="o">=</span><span class="n">EDCX</span><span class="w">
       </span><span class="n">DCY1</span><span class="o">=</span><span class="n">EDCY</span><span class="w">
       </span><span class="n">DCZ1</span><span class="o">=</span><span class="n">EDCZ</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RUN</span><span class="w"> </span><span class="n">BREMSSTRAHLUNG</span><span class="w"> </span><span class="n">GAMMA</span><span class="w"> </span><span class="n">THROUGH</span><span class="w"> </span><span class="n">CASCADE</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">CONVERTED</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ELECTRONS</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CASRSB</span><span class="p">/</span><span class="w">
</span><span class="n">C</span><span class="w"> 
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">BREMSCASC</span><span class="p">(</span><span class="n">J11</span><span class="p">,</span><span class="n">EGAMMA</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">ST</span><span class="p">,</span><span class="n">GDCX</span><span class="p">,</span><span class="n">GDCY</span><span class="p">,</span><span class="n">GDCZ</span><span class="p">,</span><span class="n">ILOW</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">BREMSSTRAHLUNG</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">TOO</span><span class="w"> </span><span class="n">LOW</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">IONISE</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">ILOW</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">190</span><span class="w">
</span><span class="n">C</span><span class="w"> 
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">BREMSSTRAHLUNG</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">CLUSTER</span><span class="w"> </span><span class="n">STORE</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="mi">890</span><span class="w"> </span><span class="n">KBR</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IEVNTLB</span><span class="w">
       </span><span class="n">NCLUS</span><span class="o">=</span><span class="n">NCLUS</span><span class="mi">+1</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">NCLUS</span><span class="ow">.GT.</span><span class="mi">150000</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> 
        </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">546</span><span class="p">)</span><span class="w"> </span><span class="n">NCLUS</span><span class="p">,</span><span class="n">NREAL</span><span class="w">
        </span><span class="k">STOP</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">     
       </span><span class="n">ES</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ECASB</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
       </span><span class="n">XS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">XCASB</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
       </span><span class="n">YS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">YCASB</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
       </span><span class="n">ZS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ZCASB</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
       </span><span class="n">TS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">TTB1</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
       </span><span class="n">DCX</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">DRXB</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
       </span><span class="n">DCY</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">DRYB</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
       </span><span class="n">DCZ</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">DRZB</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
       </span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGFB</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="o">+</span><span class="n">NFLGHIGH</span><span class="w">
       </span><span class="n">NFLGPPC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGPPB</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
       </span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="mi">2</span><span class="w">
  </span><span class="mi">890</span><span class="w">  </span><span class="k">CONTINUE</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="ow">.GT.</span><span class="n">NFLGHIGH</span><span class="p">)</span><span class="w"> </span><span class="n">NFLGHIGH</span><span class="o">=</span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="w">
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">190</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
  </span><span class="mi">891</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
</span><span class="n">C</span><span class="o">****************************************************************</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">S1</span><span class="o">=</span><span class="n">RGAS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">                                                        
      </span><span class="n">S1</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">+</span><span class="n">GAM2</span><span class="o">*</span><span class="p">(</span><span class="n">RGAS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="mf">-1.0D0</span><span class="p">)</span><span class="w">                                     
      </span><span class="n">EI</span><span class="o">=</span><span class="n">EIN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">E</span><span class="ow">.LT.</span><span class="n">EI</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
      </span><span class="n">EI</span><span class="o">=</span><span class="n">E</span><span class="mf">-0.0001D0</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">                                                          
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IPN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">666</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ATTACHMENT</span><span class="w">       
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IPN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="n">NETOT</span><span class="o">=</span><span class="n">NETOT</span><span class="mi">+1</span><span class="w">
       </span><span class="n">NITOT</span><span class="o">=</span><span class="n">NITOT</span><span class="mi">+1</span><span class="w">
       </span><span class="n">NELEC</span><span class="o">=</span><span class="n">NELEC</span><span class="mi">+1</span><span class="w">
       </span><span class="n">NEGION</span><span class="o">=</span><span class="n">NEGION</span><span class="mi">+1</span><span class="w">
       </span><span class="n">IPT</span><span class="o">=</span><span class="n">IARRY</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
       </span><span class="n">ICOLL</span><span class="p">(</span><span class="n">IPT</span><span class="p">)</span><span class="o">=</span><span class="n">ICOLL</span><span class="p">(</span><span class="n">IPT</span><span class="p">)</span><span class="mi">+1</span><span class="w">
       </span><span class="n">ICOLN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">ICOLN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="mi">+1</span><span class="w"> 
       </span><span class="n">IT</span><span class="o">=</span><span class="n">DINT</span><span class="p">(</span><span class="n">T</span><span class="mf">+1.0D0</span><span class="p">)</span><span class="w">
       </span><span class="n">IT</span><span class="o">=</span><span class="n">DMIN0</span><span class="p">(</span><span class="n">IT</span><span class="p">,</span><span class="n">J300</span><span class="p">)</span><span class="w">
       </span><span class="n">TIME</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span><span class="o">=</span><span class="n">TIME</span><span class="p">(</span><span class="n">IT</span><span class="p">)</span><span class="mf">+1.0D0</span><span class="w">
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">335</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">    
      </span><span class="n">EISTR</span><span class="o">=</span><span class="n">EI</span><span class="w">                                   
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IONMODEL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.GT.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w"> </span><span class="n">ENERGY</span><span class="p">,</span><span class="n">ESEC</span><span class="p">,</span><span class="k">IN</span><span class="w"> </span><span class="n">IONISATION</span><span class="w"> </span><span class="n">COLLISION</span><span class="w"> </span><span class="n">USING</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FIVE</span><span class="w"> </span><span class="n">DIFFERENT</span><span class="w"> </span><span class="n">MODELS</span><span class="w">
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">IONSPLIT</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">EI</span><span class="p">,</span><span class="n">ESEC</span><span class="p">)</span><span class="w"> 
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">544</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">               
      </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">    </span><span class="k">USE</span><span class="w"> </span><span class="n">OPAL</span><span class="w"> </span><span class="n">PETERSON</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">BEATY</span><span class="w"> </span><span class="n">SPLITTING</span><span class="w"> </span><span class="n">FACTOR</span><span class="err">.</span><span class="w">
      </span><span class="n">ESEC</span><span class="o">=</span><span class="n">WPL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="nb">TAN</span><span class="p">(</span><span class="n">R9</span><span class="o">*</span><span class="nb">ATAN</span><span class="p">((</span><span class="n">E</span><span class="o">-</span><span class="n">EI</span><span class="p">)/(</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">WPL</span><span class="p">(</span><span class="n">I</span><span class="p">))))</span><span class="w"> 
      </span><span class="n">ESEC</span><span class="o">=</span><span class="n">WPL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ESEC</span><span class="p">/</span><span class="n">WPL</span><span class="p">(</span><span class="n">I</span><span class="p">))</span><span class="o">**</span><span class="mf">0.9524</span><span class="w">
  </span><span class="mi">544</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="n">EI</span><span class="o">=</span><span class="n">ESEC</span><span class="o">+</span><span class="n">EI</span><span class="w"> 
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">POSITION</span><span class="w"> </span><span class="p">,</span><span class="n">ENERGY</span><span class="p">,</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w"> </span><span class="n">COSINES</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">TIME</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">GENERATION</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w"> </span><span class="n">IONISATION</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> 
      </span><span class="n">NCLUS</span><span class="o">=</span><span class="n">NCLUS</span><span class="mi">+1</span><span class="w">
      </span><span class="n">NMXADD</span><span class="o">=</span><span class="nb">MAX</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">,</span><span class="n">NMXADD</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">NCLUS</span><span class="ow">.GT.</span><span class="mi">150000</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> 
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">546</span><span class="p">)</span><span class="w"> </span><span class="n">NCLUS</span><span class="p">,</span><span class="n">NREAL</span><span class="w"> 
 </span><span class="mi">546</span><span class="w">   </span><span class="k">FORMAT</span><span class="p">(</span><span class="l">2X</span><span class="p">,</span><span class="s1">' PROGRAM STOPPED . NCLUS='</span><span class="p">,</span><span class="l">I7</span><span class="p">,</span><span class="s1">' NREAL='</span><span class="p">,</span><span class="l">I10</span><span class="p">)</span><span class="w">
       </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">     
      </span><span class="n">XS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="w">       
      </span><span class="n">YS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Y</span><span class="w">
      </span><span class="n">ZS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="w">
      </span><span class="n">TS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ST</span><span class="w">
      </span><span class="n">ES</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ESEC</span><span class="w"> 
      </span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGFF</span><span class="w">
      </span><span class="n">NFLGPPC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGPPP</span><span class="w">
      </span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGBRMM</span><span class="w">         
      </span><span class="n">NTMPFLG</span><span class="o">=</span><span class="mi">1</span><span class="w">
      </span><span class="n">NCLTMP</span><span class="o">=</span><span class="n">NCLUS</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RANDOMISE</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">THETA0</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="n">F3</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">F6</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETA0</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">F5</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETA0</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">PHI0</span><span class="o">=</span><span class="n">F4</span><span class="o">*</span><span class="n">R4</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">F8</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">F9</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">               
</span><span class="n">C</span><span class="w">     </span><span class="n">DCX</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">DCY</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">DCZ</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F6</span><span class="w">    
</span><span class="n">C</span><span class="o">*********************************************************</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IECASC</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">333</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">LEGAS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">333</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="k">USE</span><span class="w"> </span><span class="n">COMPLETE</span><span class="w"> </span><span class="n">CASCADE</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">IONISATION</span><span class="w">
      </span><span class="n">KG1</span><span class="o">=</span><span class="n">NEGAS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="n">LG1</span><span class="o">=</span><span class="n">LEGAS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="n">IGSHEL</span><span class="o">=</span><span class="n">IESHELL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="k">CALL</span><span class="w"> </span><span class="n">CASCADEE</span><span class="p">(</span><span class="n">J11</span><span class="p">,</span><span class="n">KG1</span><span class="p">,</span><span class="n">LG1</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">ST</span><span class="p">,</span><span class="n">ESEC</span><span class="p">,</span><span class="n">IGSHEL</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">CASCADE</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">CLUSTER</span><span class="w"> </span><span class="n">STORE</span><span class="w">
</span><span class="n">C</span><span class="w">
      </span><span class="n">ETSUM</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">844</span><span class="w"> </span><span class="n">KBR</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IEVENTE</span><span class="w">
      </span><span class="n">NCLUS</span><span class="o">=</span><span class="n">NCLUS</span><span class="mi">+1</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">NCLUS</span><span class="ow">.GT.</span><span class="mi">150000</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">546</span><span class="p">)</span><span class="w"> </span><span class="n">NCLUS</span><span class="p">,</span><span class="n">NREAL</span><span class="w">
       </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
      </span><span class="n">ES</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ECASE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
      </span><span class="n">ETSUM</span><span class="o">=</span><span class="n">ETSUM</span><span class="o">+</span><span class="n">ES</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="w">
      </span><span class="n">XS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">XCASE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
      </span><span class="n">YS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">YCASE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
      </span><span class="n">ZS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ZCASE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
      </span><span class="n">TS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">TCASE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
      </span><span class="n">DCX</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">DRXCE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
      </span><span class="n">DCY</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">DRYCE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
      </span><span class="n">DCZ</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">DRZCE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGFE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="o">+</span><span class="n">NFLGHIGH</span><span class="w">
      </span><span class="n">NFLGPPC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGPPE</span><span class="p">(</span><span class="n">KBR</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGBRMM</span><span class="w">
  </span><span class="mi">844</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="ow">.GT.</span><span class="n">NFLGHIGH</span><span class="p">)</span><span class="w"> </span><span class="n">NFLGHIGH</span><span class="o">=</span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="w">
      </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">666</span><span class="w">
</span><span class="n">C</span><span class="o">*********************************************************</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">POSSIBLE</span><span class="w"> </span><span class="n">SHELL</span><span class="w"> </span><span class="n">EMISSIONS</span><span class="w"> </span><span class="n">AUGER</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w"> 
  </span><span class="mi">333</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">EISTR</span><span class="ow">.GT.</span><span class="mf">30.0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">TEST</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w"> </span><span class="n">EMISSION</span><span class="w">
       </span><span class="n">IFLTST</span><span class="o">=</span><span class="mi">0</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">WKLM</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.GT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">R9</span><span class="ow">.LT.</span><span class="n">WKLM</span><span class="p">(</span><span class="n">I</span><span class="p">))</span><span class="w"> </span><span class="n">IFLTST</span><span class="o">=</span><span class="mi">1</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">IFLTST</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">AUGER</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">WITHOUT</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
        </span><span class="n">NAUG</span><span class="o">=</span><span class="n">NC0</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">EAVAUG</span><span class="o">=</span><span class="n">EC0</span><span class="p">(</span><span class="n">I</span><span class="p">)/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NAUG</span><span class="p">)</span><span class="w">
        </span><span class="k">DO</span><span class="w"> </span><span class="mi">700</span><span class="w"> </span><span class="n">JFL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NC0</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">NCLUS</span><span class="o">=</span><span class="n">NCLUS</span><span class="mi">+1</span><span class="w">
        </span><span class="n">XS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="w">
        </span><span class="n">YS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Y</span><span class="w">
        </span><span class="n">ZS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="w">
        </span><span class="n">TS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ST</span><span class="w">
        </span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGFF</span><span class="w">
        </span><span class="n">NFLGPPC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGPPP</span><span class="w">
        </span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGBRMM</span><span class="w">
        </span><span class="n">ES</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">EAVAUG</span><span class="w">
        </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="w">
        </span><span class="n">THETA0</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="n">F3</span><span class="p">)</span><span class="w">
        </span><span class="n">F6</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETA0</span><span class="p">)</span><span class="w">
        </span><span class="n">F5</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETA0</span><span class="p">)</span><span class="w">
        </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">PHI0</span><span class="o">=</span><span class="n">F4</span><span class="o">*</span><span class="n">R4</span><span class="w">
        </span><span class="n">F8</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">
        </span><span class="n">F9</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">               
        </span><span class="n">DCX</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DCY</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DCZ</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F6</span><span class="w">
  </span><span class="mi">700</span><span class="w">   </span><span class="k">CONTINUE</span><span class="w"> 
       </span><span class="k">ELSE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">AUGER</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">FLUORESENCE</span><span class="w"> 
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NG2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">702</span><span class="w">
        </span><span class="n">NAUG</span><span class="o">=</span><span class="n">NG2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">EAVAUG</span><span class="o">=</span><span class="n">EG2</span><span class="p">(</span><span class="n">I</span><span class="p">)/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NAUG</span><span class="p">)</span><span class="w">
        </span><span class="k">DO</span><span class="w"> </span><span class="mi">701</span><span class="w"> </span><span class="n">JFL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NG2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">NCLUS</span><span class="o">=</span><span class="n">NCLUS</span><span class="mi">+1</span><span class="w">
        </span><span class="n">XS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="w">
        </span><span class="n">YS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Y</span><span class="w">
        </span><span class="n">ZS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="w">
        </span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGFF</span><span class="w">
        </span><span class="n">NFLGPPC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGPPP</span><span class="w">
        </span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGBRMM</span><span class="w">
        </span><span class="n">TS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ST</span><span class="w">
        </span><span class="n">ES</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">EAVAUG</span><span class="w">
        </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="w">
        </span><span class="n">THETA0</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="n">F3</span><span class="p">)</span><span class="w">
        </span><span class="n">F6</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETA0</span><span class="p">)</span><span class="w">
        </span><span class="n">F5</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETA0</span><span class="p">)</span><span class="w">
        </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">PHI0</span><span class="o">=</span><span class="n">F4</span><span class="o">*</span><span class="n">R4</span><span class="w">
        </span><span class="n">F8</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">
        </span><span class="n">F9</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">               
        </span><span class="n">DCX</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DCY</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DCZ</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F6</span><span class="w">
  </span><span class="mi">701</span><span class="w">   </span><span class="k">CONTINUE</span><span class="w">
  </span><span class="mi">702</span><span class="w">   </span><span class="k">IF</span><span class="p">(</span><span class="n">NG1</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">704</span><span class="w">
        </span><span class="n">NAUG</span><span class="o">=</span><span class="n">NG1</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">EAVAUG</span><span class="o">=</span><span class="n">EG1</span><span class="p">(</span><span class="n">I</span><span class="p">)/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NAUG</span><span class="p">)</span><span class="w">
        </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">DFL</span><span class="o">=-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">DSTFL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="k">DO</span><span class="w"> </span><span class="mi">703</span><span class="w"> </span><span class="n">JFL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NG1</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">NCLUS</span><span class="o">=</span><span class="n">NCLUS</span><span class="mi">+1</span><span class="w">
        </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">THEFL</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">1.0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span><span class="w">
        </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">PHIFL</span><span class="o">=</span><span class="n">F4</span><span class="o">*</span><span class="n">R4</span><span class="w">
        </span><span class="n">XS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="o">+</span><span class="n">DFL</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THEFL</span><span class="p">)</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHIFL</span><span class="p">)</span><span class="w">
        </span><span class="n">YS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Y</span><span class="o">+</span><span class="n">DFL</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THEFL</span><span class="p">)</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHIFL</span><span class="p">)</span><span class="w">
        </span><span class="n">ZS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="o">+</span><span class="n">DFL</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THEFL</span><span class="p">)</span><span class="w">
        </span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGHIGH</span><span class="mi">+1</span><span class="w">
        </span><span class="n">NFLGPPC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGPPP</span><span class="w">
        </span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGBRMM</span><span class="w">
        </span><span class="n">TS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ST</span><span class="w">
        </span><span class="n">ES</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">EAVAUG</span><span class="w">
        </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="w">
        </span><span class="n">THETA0</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="n">F3</span><span class="p">)</span><span class="w">
        </span><span class="n">F6</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETA0</span><span class="p">)</span><span class="w">
        </span><span class="n">F5</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETA0</span><span class="p">)</span><span class="w">
        </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">PHI0</span><span class="o">=</span><span class="n">F4</span><span class="o">*</span><span class="n">R4</span><span class="w">
        </span><span class="n">F8</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">
        </span><span class="n">F9</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">               
        </span><span class="n">DCX</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DCY</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DCZ</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">F6</span><span class="w">
        </span><span class="n">NFLGHIGH</span><span class="o">=</span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="w">
  </span><span class="mi">703</span><span class="w">   </span><span class="k">CONTINUE</span><span class="w">
  </span><span class="mi">704</span><span class="w">   </span><span class="k">CONTINUE</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w">
</span><span class="n">C</span><span class="w">  </span><span class="n">GENERATE</span><span class="w"> </span><span class="n">SCATTERING</span><span class="w"> </span><span class="n">ANGLES</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">UPDATE</span><span class="w">  </span><span class="n">LABORATORY</span><span class="w"> </span><span class="n">COSINES</span><span class="w"> </span><span class="n">AFTER</span><span class="w">      
</span><span class="n">C</span><span class="w">   </span><span class="n">COLLISION</span><span class="w"> </span><span class="n">ALSO</span><span class="w"> </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">ELECTRON</span><span class="err">.</span><span class="w">                           
</span><span class="n">C</span><span class="w">
  </span><span class="mi">666</span><span class="w"> </span><span class="n">IPT</span><span class="o">=</span><span class="n">IARRY</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="n">ICOLL</span><span class="p">(</span><span class="n">IPT</span><span class="p">)</span><span class="o">=</span><span class="n">ICOLL</span><span class="p">(</span><span class="n">IPT</span><span class="p">)</span><span class="mi">+1</span><span class="w"> 
      </span><span class="n">ICOLN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">ICOLN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="mi">+1</span><span class="w">   
</span><span class="n">C</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">ADD</span><span class="w"> </span><span class="n">PROBABILITY</span><span class="w"> </span><span class="p">,</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">),</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="nb">TRANSFER</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">GIVE</span><span class="w"> 
</span><span class="n">C</span><span class="w"> </span><span class="n">IONISATION</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">OTHER</span><span class="w"> </span><span class="n">GASES</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">MIXTURE</span><span class="w">            
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IPEN</span><span class="ow">.EQ.</span><span class="mf">0.</span><span class="n">OR</span><span class="ow">.NGAS.</span><span class="n">EQ</span><span class="mf">.1</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">5</span><span class="w">                
      </span><span class="k">IF</span><span class="p">(</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="ow">.NE.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="n">RAN</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">RAN</span><span class="ow">.GT.</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">))</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">5</span><span class="w">
       </span><span class="n">NCLUS</span><span class="o">=</span><span class="n">NCLUS</span><span class="mi">+1</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ENTER</span><span class="w"> </span><span class="n">HERE</span><span class="w"> </span><span class="n">POSSIBLE</span><span class="w"> </span><span class="n">DELOCALISATION</span><span class="w"> </span><span class="n">LENGTH</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">PENNING</span><span class="w"> </span><span class="nb">TRANSFER</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">XS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="w">             
        </span><span class="n">YS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Y</span><span class="w">    
        </span><span class="n">ZS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="w">
        </span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGFF</span><span class="w">
        </span><span class="n">NFLGPPC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGPPP</span><span class="w">
        </span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGBRMM</span><span class="w">
        </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">667</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="n">ASIGN</span><span class="o">=</span><span class="mf">1.0</span><span class="w">
       </span><span class="n">RAN</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">RAN1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">RAN1</span><span class="ow">.LT.</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="n">ASIGN</span><span class="o">=-</span><span class="n">ASIGN</span><span class="w">  
       </span><span class="n">XS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="o">-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">RAN</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">ASIGN</span><span class="w">
       </span><span class="n">RAN</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">RAN1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">RAN1</span><span class="ow">.LT.</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="n">ASIGN</span><span class="o">=-</span><span class="n">ASIGN</span><span class="w"> 
       </span><span class="n">YS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Y</span><span class="o">-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">RAN</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">ASIGN</span><span class="w"> 
       </span><span class="n">RAN</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">RAN1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">RAN1</span><span class="ow">.LT.</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="n">ASIGN</span><span class="o">=-</span><span class="n">ASIGN</span><span class="w">  
       </span><span class="n">ZS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="o">-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">RAN</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">ASIGN</span><span class="w">
  </span><span class="mi">667</span><span class="w">  </span><span class="n">RAN</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">TS</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">ST</span><span class="o">-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">RAN</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ASSIGN</span><span class="w"> </span><span class="n">EXCESS</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="mi">1</span><span class="n">EV</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">PENNING</span><span class="w"> </span><span class="n">CREATED</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w">
       </span><span class="n">ES</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="mf">1.0</span><span class="w">
       </span><span class="n">DCX</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">DCX1</span><span class="w">
       </span><span class="n">DCY</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">DCY1</span><span class="w">
       </span><span class="n">DCZ</span><span class="p">(</span><span class="n">NCLUS</span><span class="p">)</span><span class="o">=</span><span class="n">DCZ1</span><span class="w">
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">6</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">6</span><span class="w"> 
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="nb">SUM</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w"> </span><span class="n">PER</span><span class="w"> </span><span class="n">CLUSTER</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="n">Z</span><span class="w"> </span><span class="n">T</span><span class="w">
   </span><span class="mi">5</span><span class="w">  </span><span class="k">IF</span><span class="p">(</span><span class="n">IPN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="k">IF</span><span class="p">((</span><span class="n">RGAS</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">EIN</span><span class="p">(</span><span class="n">I</span><span class="p">))</span><span class="ow">.GT.</span><span class="mf">4.0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">KEXC</span><span class="o">=</span><span class="n">KEXC</span><span class="mi">+1</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">KEXC</span><span class="ow">.GT.</span><span class="mi">150000</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> 
         </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">548</span><span class="p">)</span><span class="w"> </span><span class="n">KEXC</span><span class="w">
 </span><span class="mi">548</span><span class="w">     </span><span class="k">FORMAT</span><span class="p">(</span><span class="l">2X</span><span class="p">,</span><span class="s1">' PROGRAM STOPPED . KEXC='</span><span class="p">,</span><span class="l">I7</span><span class="p">)</span><span class="w">
         </span><span class="k">STOP</span><span class="w">
        </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FIND</span><span class="w"> </span><span class="n">GAS</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">WHICH</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w"> </span><span class="n">OCCURED</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">INCREMENT</span><span class="w"> </span><span class="n">COUNTER</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">I</span><span class="ow">.LE.</span><span class="n">IDG1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> 
         </span><span class="n">NGEXC1</span><span class="o">=</span><span class="n">NGEXC1</span><span class="mi">+1</span><span class="w">
        </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">I</span><span class="ow">.LE.</span><span class="n">IDG2</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
         </span><span class="n">NGEXC2</span><span class="o">=</span><span class="n">NGEXC2</span><span class="mi">+1</span><span class="w">
        </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">I</span><span class="ow">.LE.</span><span class="n">IDG3</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
         </span><span class="n">NGEXC3</span><span class="o">=</span><span class="n">NGEXC3</span><span class="mi">+1</span><span class="w">
        </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">I</span><span class="ow">.LE.</span><span class="n">IDG4</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
         </span><span class="n">NGEXC4</span><span class="o">=</span><span class="n">NGEXC4</span><span class="mi">+1</span><span class="w">
        </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">I</span><span class="ow">.LE.</span><span class="n">IDG5</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
         </span><span class="n">NGEXC5</span><span class="o">=</span><span class="n">NGEXC5</span><span class="mi">+1</span><span class="w">
        </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">I</span><span class="ow">.LE.</span><span class="n">IDG6</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
         </span><span class="n">NGEXC6</span><span class="o">=</span><span class="n">NGEXC6</span><span class="mi">+1</span><span class="w">
        </span><span class="k">ELSE</span><span class="w">
         </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">9911</span><span class="p">)</span><span class="w"> 
 </span><span class="mi">9911</span><span class="w">    </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' PROGRAM STOPPED BAD GAS ID IN MONTE'</span><span class="p">)</span><span class="w">
         </span><span class="k">STOP</span><span class="w">
        </span><span class="k">ENDIF</span><span class="w">
        </span><span class="n">NEXCTOT</span><span class="o">=</span><span class="n">NEXCTOT</span><span class="mi">+1</span><span class="w">
        </span><span class="n">NSTEXC</span><span class="o">=</span><span class="n">NSTEXC</span><span class="mi">+1</span><span class="w">
        </span><span class="n">XSTEXC</span><span class="p">(</span><span class="n">KEXC</span><span class="p">)</span><span class="o">=</span><span class="n">X</span><span class="w">
        </span><span class="n">YSTEXC</span><span class="p">(</span><span class="n">KEXC</span><span class="p">)</span><span class="o">=</span><span class="n">Y</span><span class="w">
        </span><span class="n">ZSTEXC</span><span class="p">(</span><span class="n">KEXC</span><span class="p">)</span><span class="o">=</span><span class="n">Z</span><span class="w">
        </span><span class="n">TSTEXC</span><span class="p">(</span><span class="n">KEXC</span><span class="p">)</span><span class="o">=</span><span class="n">ST</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w"> 
   </span><span class="mi">6</span><span class="w">  </span><span class="n">S2</span><span class="o">=</span><span class="p">(</span><span class="n">S1</span><span class="o">*</span><span class="n">S1</span><span class="p">)/(</span><span class="n">S1</span><span class="mf">-1.0D0</span><span class="p">)</span><span class="w"> 
</span><span class="n">C</span><span class="w">  </span><span class="n">ANISOTROPIC</span><span class="w"> </span><span class="n">SCATTERING</span><span class="w"> 
      </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="n">R31</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">R3</span><span class="o">*</span><span class="n">ANGCT</span><span class="p">(</span><span class="n">IE</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="w">       
       </span><span class="k">IF</span><span class="p">(</span><span class="n">R31</span><span class="ow">.GT.</span><span class="n">PSCT</span><span class="p">(</span><span class="n">IE</span><span class="p">,</span><span class="n">I</span><span class="p">))</span><span class="w"> </span><span class="n">F3</span><span class="o">=-</span><span class="n">F3</span><span class="w">   
      </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="n">EPSI</span><span class="o">=</span><span class="n">PSCT</span><span class="p">(</span><span class="n">IE</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="w">
       </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">-</span><span class="p">(</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">EPSI</span><span class="p">)/(</span><span class="mf">1.0D0</span><span class="o">+</span><span class="n">EPSI</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="p">)))</span><span class="w">   
      </span><span class="k">ELSE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ISOTROPIC</span><span class="w"> </span><span class="n">SCATTERING</span><span class="w">        
       </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="w">  
      </span><span class="k">ENDIF</span><span class="w">
      </span><span class="n">THETA0</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="n">F3</span><span class="p">)</span><span class="w">                                                  
      </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="n">PHI0</span><span class="o">=</span><span class="n">F4</span><span class="o">*</span><span class="n">R4</span><span class="w">                                                        
      </span><span class="n">F8</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">                                                     
      </span><span class="n">F9</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHI0</span><span class="p">)</span><span class="w">                                                     
      </span><span class="k">IF</span><span class="p">(</span><span class="n">E</span><span class="ow">.LT.</span><span class="n">EI</span><span class="p">)</span><span class="w"> </span><span class="n">EI</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">                                              
      </span><span class="n">ARG1</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">S1</span><span class="o">*</span><span class="n">EI</span><span class="p">/</span><span class="n">E</span><span class="w">                                                
      </span><span class="n">ARG1</span><span class="o">=</span><span class="n">DMAX1</span><span class="p">(</span><span class="n">ARG1</span><span class="p">,</span><span class="n">SMALL</span><span class="p">)</span><span class="w">                                            
      </span><span class="n">D</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">F3</span><span class="o">*</span><span class="n">DSQRT</span><span class="p">(</span><span class="n">ARG1</span><span class="p">)</span><span class="w">                                            
      </span><span class="n">E1</span><span class="o">=</span><span class="n">E</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">EI</span><span class="p">/(</span><span class="n">S1</span><span class="o">*</span><span class="n">E</span><span class="p">)</span><span class="mf">-2.0D0</span><span class="o">*</span><span class="n">D</span><span class="p">/</span><span class="n">S2</span><span class="p">)</span><span class="w"> 
      </span><span class="n">E1</span><span class="o">=</span><span class="n">DMAX1</span><span class="p">(</span><span class="n">E1</span><span class="p">,</span><span class="n">SMALL</span><span class="p">)</span><span class="w">                                                
      </span><span class="n">Q</span><span class="o">=</span><span class="n">DSQRT</span><span class="p">((</span><span class="n">E</span><span class="p">/</span><span class="n">E1</span><span class="p">)</span><span class="o">*</span><span class="n">ARG1</span><span class="p">)/</span><span class="n">S1</span><span class="w">                                           
      </span><span class="n">Q</span><span class="o">=</span><span class="n">DMIN1</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="mf">1.0D0</span><span class="p">)</span><span class="w">                                                  
      </span><span class="n">THETA</span><span class="o">=</span><span class="n">DASIN</span><span class="p">(</span><span class="n">Q</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETA0</span><span class="p">))</span><span class="w">                                       
      </span><span class="n">F6</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETA</span><span class="p">)</span><span class="w">                                                    
      </span><span class="n">U</span><span class="o">=</span><span class="p">(</span><span class="n">S1</span><span class="mf">-1.0D0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">S1</span><span class="mf">-1.0D0</span><span class="p">)/</span><span class="n">ARG1</span><span class="w">                                      
      </span><span class="n">CSQD</span><span class="o">=</span><span class="n">F3</span><span class="o">*</span><span class="n">F3</span><span class="w">                                                        
      </span><span class="k">IF</span><span class="p">(</span><span class="n">F3</span><span class="ow">.LT.</span><span class="mf">0.0D0</span><span class="ow">.AND.</span><span class="n">CSQD</span><span class="ow">.GT.</span><span class="n">U</span><span class="p">)</span><span class="w"> </span><span class="n">F6</span><span class="o">=</span><span class="mf">-1.0D0</span><span class="o">*</span><span class="n">F6</span><span class="w">                        
      </span><span class="n">F5</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETA</span><span class="p">)</span><span class="w">                                                    
      </span><span class="n">DCZ2</span><span class="o">=</span><span class="n">DMIN1</span><span class="p">(</span><span class="n">DCZ2</span><span class="p">,</span><span class="mf">1.0D0</span><span class="p">)</span><span class="w">                                            
      </span><span class="n">ARGZ</span><span class="o">=</span><span class="n">DSQRT</span><span class="p">(</span><span class="n">DCX2</span><span class="o">*</span><span class="n">DCX2</span><span class="o">+</span><span class="n">DCY2</span><span class="o">*</span><span class="n">DCY2</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">ARGZ</span><span class="ow">.EQ.</span><span class="mf">0.0D0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="n">DCZ1</span><span class="o">=</span><span class="n">F6</span><span class="w">         
       </span><span class="n">DCX1</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span><span class="w">                             
       </span><span class="n">DCY1</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span><span class="w"> 
       </span><span class="k">IF</span><span class="p">(</span><span class="n">NTMPFLG</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="k">USE</span><span class="w"> </span><span class="n">FREE</span><span class="w"> </span><span class="n">KINEMATICS</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">IONISATION</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w"> </span><span class="n">ANGLES</span><span class="w">
        </span><span class="n">F5S</span><span class="o">=</span><span class="n">F5</span><span class="o">*</span><span class="n">DSQRT</span><span class="p">(</span><span class="n">E1</span><span class="p">/</span><span class="n">ES</span><span class="p">(</span><span class="n">NCLTMP</span><span class="p">))</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">F5S</span><span class="ow">.GT.</span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="n">F5S</span><span class="o">=</span><span class="mf">1.0</span><span class="w">
        </span><span class="n">THSEC</span><span class="o">=</span><span class="n">DASIN</span><span class="p">(</span><span class="n">F5S</span><span class="p">)</span><span class="w">
        </span><span class="n">F5S</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THSEC</span><span class="p">)</span><span class="w">
        </span><span class="n">F6S</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THSEC</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">F6</span><span class="ow">.LT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">F6S</span><span class="o">=-</span><span class="n">F6S</span><span class="w">
        </span><span class="n">PHIS</span><span class="o">=</span><span class="n">PHI0</span><span class="o">+</span><span class="n">API</span><span class="w">   
        </span><span class="k">IF</span><span class="p">(</span><span class="n">PHIS</span><span class="ow">.GT.</span><span class="n">F4</span><span class="p">)</span><span class="w"> </span><span class="n">PHIS</span><span class="o">=</span><span class="n">PHI0</span><span class="o">-</span><span class="n">F4</span><span class="w">
        </span><span class="n">F8S</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">F9S</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">DCZ</span><span class="p">(</span><span class="n">NCLTMP</span><span class="p">)</span><span class="o">=</span><span class="n">F6S</span><span class="w">
        </span><span class="n">DCX</span><span class="p">(</span><span class="n">NCLTMP</span><span class="p">)</span><span class="o">=</span><span class="n">F9S</span><span class="o">*</span><span class="n">F5S</span><span class="w">
        </span><span class="n">DCY</span><span class="p">(</span><span class="n">NCLTMP</span><span class="p">)</span><span class="o">=</span><span class="n">F8S</span><span class="o">*</span><span class="n">F5S</span><span class="w">
        </span><span class="n">NTMPFLG</span><span class="o">=</span><span class="mi">0</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">190</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">                                            
      </span><span class="n">DCZ1</span><span class="o">=</span><span class="n">DCZ2</span><span class="o">*</span><span class="n">F6</span><span class="o">+</span><span class="n">ARGZ</span><span class="o">*</span><span class="n">F5</span><span class="o">*</span><span class="n">F8</span><span class="w">                                           
      </span><span class="n">DCY1</span><span class="o">=</span><span class="n">DCY2</span><span class="o">*</span><span class="n">F6</span><span class="o">+</span><span class="p">(</span><span class="n">F5</span><span class="p">/</span><span class="n">ARGZ</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">DCX2</span><span class="o">*</span><span class="n">F9</span><span class="o">-</span><span class="n">DCY2</span><span class="o">*</span><span class="n">DCZ2</span><span class="o">*</span><span class="n">F8</span><span class="p">)</span><span class="w">                     
      </span><span class="n">DCX1</span><span class="o">=</span><span class="n">DCX2</span><span class="o">*</span><span class="n">F6</span><span class="o">-</span><span class="p">(</span><span class="n">F5</span><span class="p">/</span><span class="n">ARGZ</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">DCY2</span><span class="o">*</span><span class="n">F9</span><span class="o">+</span><span class="n">DCX2</span><span class="o">*</span><span class="n">DCZ2</span><span class="o">*</span><span class="n">F8</span><span class="p">)</span><span class="w"> 
      </span><span class="k">IF</span><span class="p">(</span><span class="n">NTMPFLG</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="k">USE</span><span class="w"> </span><span class="n">FREE</span><span class="w"> </span><span class="n">KINEMATICS</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">IONISATION</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w"> </span><span class="n">ANGLES</span><span class="w">
       </span><span class="n">F5S</span><span class="o">=</span><span class="n">F5</span><span class="o">*</span><span class="n">DSQRT</span><span class="p">(</span><span class="n">E1</span><span class="p">/</span><span class="n">ES</span><span class="p">(</span><span class="n">NCLTMP</span><span class="p">))</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">F5S</span><span class="ow">.GT.</span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="n">F5S</span><span class="o">=</span><span class="mf">1.0</span><span class="w">            
       </span><span class="n">THSEC</span><span class="o">=</span><span class="n">DASIN</span><span class="p">(</span><span class="n">F5S</span><span class="p">)</span><span class="w">
       </span><span class="n">F5S</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THSEC</span><span class="p">)</span><span class="w">
       </span><span class="n">F6S</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THSEC</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">F6</span><span class="ow">.LT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">F6S</span><span class="o">=-</span><span class="n">F6S</span><span class="w">
       </span><span class="n">PHIS</span><span class="o">=</span><span class="n">PHI0</span><span class="o">+</span><span class="n">API</span><span class="w">   
       </span><span class="k">IF</span><span class="p">(</span><span class="n">PHIS</span><span class="ow">.GT.</span><span class="n">F4</span><span class="p">)</span><span class="w"> </span><span class="n">PHIS</span><span class="o">=</span><span class="n">PHI0</span><span class="o">-</span><span class="n">F4</span><span class="w">
       </span><span class="n">F8S</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
       </span><span class="n">F9S</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
       </span><span class="n">DCZ</span><span class="p">(</span><span class="n">NCLTMP</span><span class="p">)</span><span class="o">=</span><span class="n">DCZ2</span><span class="o">*</span><span class="n">F6S</span><span class="o">+</span><span class="n">ARGZ</span><span class="o">*</span><span class="n">F5S</span><span class="o">*</span><span class="n">F8S</span><span class="w">                               
       </span><span class="n">DCY</span><span class="p">(</span><span class="n">NCLTMP</span><span class="p">)</span><span class="o">=</span><span class="n">DCY2</span><span class="o">*</span><span class="n">F6S</span><span class="o">+</span><span class="p">(</span><span class="n">F5S</span><span class="p">/</span><span class="n">ARGZ</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">DCX2</span><span class="o">*</span><span class="n">F9S</span><span class="o">-</span><span class="n">DCY2</span><span class="o">*</span><span class="n">DCZ2</span><span class="o">*</span><span class="n">F8S</span><span class="p">)</span><span class="w">        
       </span><span class="n">DCX</span><span class="p">(</span><span class="n">NCLTMP</span><span class="p">)</span><span class="o">=</span><span class="n">DCX2</span><span class="o">*</span><span class="n">F6S</span><span class="o">-</span><span class="p">(</span><span class="n">F5S</span><span class="p">/</span><span class="n">ARGZ</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">DCY2</span><span class="o">*</span><span class="n">F9S</span><span class="o">+</span><span class="n">DCX2</span><span class="o">*</span><span class="n">DCZ2</span><span class="o">*</span><span class="n">F8S</span><span class="p">)</span><span class="w">
       </span><span class="n">NTMPFLG</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w"> 
  </span><span class="mi">190</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">  
      </span><span class="n">GAM1</span><span class="o">=</span><span class="p">(</span><span class="n">EMS</span><span class="o">+</span><span class="n">E1</span><span class="p">)/</span><span class="n">EMS</span><span class="w">
      </span><span class="n">BET1</span><span class="o">=</span><span class="n">DSQRT</span><span class="p">(</span><span class="mf">1.0D0-1.0D0</span><span class="p">/(</span><span class="n">GAM1</span><span class="o">*</span><span class="n">GAM1</span><span class="p">))</span><span class="w">
      </span><span class="n">VTOT</span><span class="o">=</span><span class="n">BET1</span><span class="o">*</span><span class="n">VC</span><span class="o">*</span><span class="mf">1.D-12</span><span class="w">
</span><span class="n">C</span><span class="w">     </span><span class="n">VTOT</span><span class="o">=</span><span class="n">CONST9</span><span class="o">*</span><span class="n">DSQRT</span><span class="p">(</span><span class="n">E1</span><span class="p">)</span><span class="w">
      </span><span class="n">CX1</span><span class="o">=</span><span class="n">DCX1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">CY1</span><span class="o">=</span><span class="n">DCY1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">CZ1</span><span class="o">=</span><span class="n">DCZ1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">TEST</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">IS</span><span class="w"> </span><span class="n">THERMALISED</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">E1</span><span class="ow">.GT.</span><span class="n">ETHRM</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="mi">191</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">POSITION</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">TIME</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">THERMALISED</span><span class="w"> </span><span class="n">ELECTRONS</span><span class="w">
      </span><span class="n">K1</span><span class="o">=</span><span class="n">K1</span><span class="mi">+1</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ROTATE</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="n">COORDINATE</span><span class="w"> </span><span class="n">SYSTEM</span><span class="w"> </span><span class="n">WITH</span><span class="w"> </span><span class="n">EFIELD</span><span class="w"> </span><span class="n">ALONG</span><span class="w"> </span><span class="n">Z</span><span class="w">
      </span><span class="n">ZR</span><span class="o">=</span><span class="n">Z</span><span class="o">*</span><span class="n">RCS</span><span class="o">-</span><span class="n">X</span><span class="o">*</span><span class="n">RSN</span><span class="w">
      </span><span class="n">YR</span><span class="o">=</span><span class="n">Y</span><span class="w">
      </span><span class="n">XR</span><span class="o">=</span><span class="n">Z</span><span class="o">*</span><span class="n">RSN</span><span class="o">+</span><span class="n">X</span><span class="o">*</span><span class="n">RCS</span><span class="w">          
      </span><span class="n">XST</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">=</span><span class="n">XR</span><span class="w">
      </span><span class="n">YST</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">=</span><span class="n">YR</span><span class="w">
      </span><span class="n">ZST</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">=</span><span class="n">ZR</span><span class="w">
      </span><span class="n">TST</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">=</span><span class="n">ST</span><span class="w">
      </span><span class="n">NFGF</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGFF</span><span class="w">
      </span><span class="n">NFGPP</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGPPP</span><span class="w">
      </span><span class="n">NFGBR</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">=</span><span class="n">NFLGBRMM</span><span class="w">
      </span><span class="n">TTIME</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span><span class="o">=</span><span class="n">ST</span><span class="o">-</span><span class="n">TLAST</span><span class="w">
      </span><span class="n">NELEC</span><span class="o">=</span><span class="n">NELEC</span><span class="mi">+1</span><span class="w">
      </span><span class="n">NETOT</span><span class="o">=</span><span class="n">NETOT</span><span class="mi">+1</span><span class="w">
  </span><span class="mi">335</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">K1</span><span class="ow">.EQ.</span><span class="mi">150000</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">889</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">NELEC</span><span class="ow">.EQ.</span><span class="p">(</span><span class="n">NCLUS</span><span class="mi">+1</span><span class="p">))</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">LAST</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">CLUSTER</span><span class="err">.</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="n">STATISTICS</span><span class="w"> </span><span class="n">ON</span><span class="w"> </span><span class="n">CLUSTER</span><span class="w">
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">STATS</span><span class="p">(</span><span class="n">J11</span><span class="p">,</span><span class="n">J1</span><span class="p">)</span><span class="w"> 
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">210</span><span class="w">      
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">GET</span><span class="w"> </span><span class="n">NEW</span><span class="w"> </span><span class="n">IONISATION</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">STORE</span><span class="w">
      </span><span class="n">X</span><span class="o">=</span><span class="n">XS</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">Y</span><span class="o">=</span><span class="n">YS</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">Z</span><span class="o">=</span><span class="n">ZS</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">ST</span><span class="o">=</span><span class="n">TS</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGFF</span><span class="o">=</span><span class="n">NFLGFC</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGPPP</span><span class="o">=</span><span class="n">NFLGPPC</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">NFLGBRMM</span><span class="o">=</span><span class="n">NFLGBRMC</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">TLAST</span><span class="o">=</span><span class="n">TS</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">E1</span><span class="o">=</span><span class="n">ES</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">DCX1</span><span class="o">=</span><span class="n">DCX</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">DCY1</span><span class="o">=</span><span class="n">DCY</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="n">DCZ1</span><span class="o">=</span><span class="n">DCZ</span><span class="p">(</span><span class="n">NELEC</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">E1</span><span class="ow">.LT.</span><span class="n">ETHRM</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">191</span><span class="w">
      </span><span class="n">GAM1</span><span class="o">=</span><span class="p">(</span><span class="n">EMS</span><span class="o">+</span><span class="n">E1</span><span class="p">)/</span><span class="n">EMS</span><span class="w">
      </span><span class="n">BET1</span><span class="o">=</span><span class="n">DSQRT</span><span class="p">(</span><span class="mf">1.0D0-1.0D0</span><span class="p">/(</span><span class="n">GAM1</span><span class="o">*</span><span class="n">GAM1</span><span class="p">))</span><span class="w">
      </span><span class="n">VTOT</span><span class="o">=</span><span class="n">BET1</span><span class="o">*</span><span class="n">VC</span><span class="o">*</span><span class="mf">1.D-12</span><span class="w">
      </span><span class="n">CX1</span><span class="o">=</span><span class="n">DCX1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">CY1</span><span class="o">=</span><span class="n">DCY1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
      </span><span class="n">CZ1</span><span class="o">=</span><span class="n">DCZ1</span><span class="o">*</span><span class="n">VTOT</span><span class="w">
      </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">1</span><span class="w">  
</span><span class="n">C</span><span class="w"> </span><span class="n">MAIN</span><span class="w"> </span><span class="n">LOOP</span><span class="w"> </span><span class="k">END</span><span class="w">
  </span><span class="mi">210</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RESET</span><span class="w"> </span><span class="n">NUMBER</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">EVENTS</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">BAD</span><span class="w"> </span><span class="n">EVENTS</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IMIP</span><span class="ow">.GT.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">NDELTA</span><span class="o">=</span><span class="n">NDELTA</span><span class="o">-</span><span class="n">IBADTOT</span><span class="w">
      </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">887</span><span class="p">)</span><span class="w"> </span><span class="n">EMAX</span><span class="p">,</span><span class="n">NEOVFL</span><span class="w">
  </span><span class="mi">887</span><span class="w"> </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' EMAX='</span><span class="p">,</span><span class="l">D12.7</span><span class="p">,</span><span class="s1">' NEOVFL ='</span><span class="p">,</span><span class="l">I5</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">EMAX</span><span class="ow">.GT.</span><span class="n">EFINAL</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
      </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">989</span><span class="p">)</span><span class="w"> </span><span class="n">EFINAL</span><span class="p">,</span><span class="n">EMAX</span><span class="w">
  </span><span class="mi">989</span><span class="w"> </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">'INCREASE ENERGY LIMIT FROM'</span><span class="p">,</span><span class="l">D12.6</span><span class="p">,</span><span class="s1">' EV TO AT LEAST'</span><span class="p">,</span><span class="l">D12.6</span><span class="p">,</span><span class="w">
     </span><span class="l">/</span><span class="s1">' EV.'</span><span class="p">)</span><span class="w">
      </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">                                         
      </span><span class="k">RETURN</span><span class="w">
  </span><span class="mi">889</span><span class="w"> </span><span class="n">NLEFT</span><span class="o">=</span><span class="n">NCLUS</span><span class="o">-</span><span class="n">NELEC</span><span class="w">
      </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">992</span><span class="p">)</span><span class="w"> </span><span class="n">NPRIME</span><span class="p">,</span><span class="n">NLEFT</span><span class="p">,</span><span class="n">NCLUS</span><span class="w">
  </span><span class="mi">992</span><span class="w"> </span><span class="k">FORMAT</span><span class="p">(</span><span class="l">3</span><span class="p">(</span><span class="l">/</span><span class="p">),</span><span class="s1">' WARNING STOPPED AFTER NPRIME='</span><span class="p">,</span><span class="l">I6</span><span class="p">,</span><span class="s1">' LAST PRIMARY HAS
     / AT LEAST '</span><span class="p">,</span><span class="l">I6</span><span class="p">,</span><span class="s1">' SECONDARIES LEFT TO TRACK. OUT OF '</span><span class="p">,</span><span class="l">I6</span><span class="p">,</span><span class="s1">' ELECTRON
     /S ALREADY IN CLUSTER'</span><span class="p">)</span><span class="w">
      </span><span class="k">STOP</span><span class="w">
      </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">END</span><span class="w">                                                  

</span></code></pre>