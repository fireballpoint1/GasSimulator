<h2 id='calcn'>CALCN</h2>
<p>Calculates cascade in gas <code>KGAS</code> and molecular component <code>LGAS</code> with initial energy deposit elecen and shell vacancy created at <code>ISHELL</code></p>
<h3 id='arguments'>Arguments</h3>
<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>IPN</td>
<td></td>
</tr>
<tr>
<td>NVAC</td>
<td></td>
</tr>
<tr>
<td>KGAS</td>
<td></td>
</tr>
<tr>
<td>LGAS</td>
<td></td>
</tr>
<tr>
<td>ELECEN</td>
<td></td>
</tr>
<tr>
<td>ISHELL</td>
<td></td>
</tr>
<tr>
<td>ICON</td>
<td></td>
</tr>
</tbody></table>
<h3 id='pseudo-code'>Pseudo-Code</h3><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">CALC</span><span class="p">(</span><span class="n">IPN</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ELECEN</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ICON</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8(A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8(I-N)</span>
    <span class="c"># SCR=""\</span>
    <span class="c"># SCR1=""</span>
    <span class="c">#COMMON/INPT1/</span>
    <span class="k">global</span> <span class="n">NDVEC</span>
    <span class="c">#COMMON/PRIM3/</span>
    <span class="k">global</span> <span class="n">MSUM</span><span class="c">#(10000)</span>
    <span class="k">global</span> <span class="n">MCOMP</span><span class="c">#(10000)</span>
    <span class="k">global</span> <span class="n">MRAYL</span><span class="c">#(10000)</span>
    <span class="k">global</span> <span class="n">MPAIR</span><span class="c">#(10000)</span>
    <span class="k">global</span> <span class="n">MPHOT</span><span class="c">#(10000)</span>
    <span class="k">global</span> <span class="n">MVAC</span><span class="c">#(10000)</span>
    <span class="c">#COMMON/GENCAS/</span>
    <span class="k">global</span> <span class="n">ELEV</span><span class="c">#[17,79]</span>
    <span class="k">global</span> <span class="n">NSDEG</span><span class="c">#(17)</span>
    <span class="k">global</span> <span class="n">AA</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">BB</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">SCR</span><span class="p">,</span><span class="n">SCR1</span>
    <span class="c">#COMMON/MIXC/</span>
    <span class="k">global</span> <span class="n">PRSH</span><span class="c">#(6,3,17,17)</span>
    <span class="k">global</span> <span class="n">ESH</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUG</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RAD</span><span class="c">#[6,3,17,17]</span>
    <span class="k">global</span> <span class="n">PRSHBT</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">IZ</span><span class="c">#[6,3]</span>
    <span class="k">global</span> <span class="n">INIOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">ISHLMX</span><span class="c">#(6,3)</span>
    <span class="k">global</span> <span class="n">AMZ</span><span class="c">#[6,3]    </span>
    <span class="c">#COMMON/UPD/</span>
    <span class="k">global</span> <span class="n">NOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUGR</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RADR</span><span class="c">#(6,3,17,17)</span>
    <span class="c">#COMMON/CALCAS/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]    </span>
    <span class="c">#DIMENSION </span>
    <span class="n">TEMP</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">)]</span>
    <span class="n">TEMP1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">289</span><span class="p">)]</span>
    <span class="c">#</span>
    <span class="c"># CALCULATE CASCADE IN GAS KGAS AND MOLECULAR COMPONENT LGAS</span>
    <span class="c"># WITH INTIAL ENERGY DEPOSIT ELECEN AND SHELL VACANCY CREATED AT ISHELL</span>
    <span class="c">#</span>
    <span class="c"># INITIAL PHOTON DIRECTION  DRX, DRY AND DRZ</span>
    <span class="n">DRXINIT</span><span class="o">=</span><span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">DRYINIT</span><span class="o">=</span><span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">DRZINIT</span><span class="o">=</span><span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ISHELLST</span><span class="o">=</span><span class="n">ISHELL</span>
    <span class="k">def</span> <span class="nf">GOTO100</span><span class="p">():</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELECEN</span>
        <span class="n">ISHELL</span><span class="o">=</span><span class="n">ISHELLST</span>
        <span class="n">API</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
        <span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.00</span><span class="o">*</span><span class="n">API</span>
        <span class="n">ISECOND</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">IFIRST</span><span class="o">=</span><span class="mi">0</span>
        <span class="c"># SET STARTING ARRAY NOCC EQUAL TO INIOCC</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">INIOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="c"># PHOTONS</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="c"># STORE INITIAL PHOTOELECTRON ENERGY AND ANGLE</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">ELECEN</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
            <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>  
            <span class="c">#    ENTRY FOR COMPTON ELECTRON.....</span>
            <span class="k">if</span><span class="p">(</span><span class="n">NVAC</span> <span class="o">&lt;=</span> <span class="n">MCOMP</span><span class="p">[</span><span class="n">IPN</span><span class="p">]):</span>
                <span class="c">#    IF COMPTON EVENT ELECTRON ANGLE FROM COMPTON (ALREADY STORED)</span>
                <span class="n">GOTO4</span><span class="p">()</span>
            <span class="c"># endif</span>
            <span class="c"># USE PHOTOELCTRON ANGULAR DISTRIBUTION</span>
            <span class="n">APE</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
            <span class="n">BPE</span><span class="o">=</span><span class="n">BB</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
            <span class="n">ANGGEN</span><span class="p">(</span><span class="n">APE</span><span class="p">,</span><span class="n">BPE</span><span class="p">,</span><span class="n">THET</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">THET</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">THET</span><span class="o">+</span><span class="n">API</span>
            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
            <span class="c"># INITIAL PHOTON DIRECTION  DRXINIT, DRYINIT AND DRZINIT</span>
            <span class="n">DRCOS</span><span class="p">(</span><span class="n">DRXINIT</span><span class="p">,</span><span class="n">DRYINIT</span><span class="p">,</span><span class="n">DRZINIT</span><span class="p">,</span><span class="n">THET</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span>
            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">DRXX</span>
            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">DRYY</span>
            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">DRZZ</span>
            <span class="n">GOTO4</span><span class="p">()</span>
        <span class="c"># endif</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="c"># BETA DECAY</span>
            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ISHELL</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECEN</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">ELECN</span>
            <span class="k">if</span><span class="p">(</span><span class="n">NDVEC</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="c"># RANDOM EMISSION DIRECTION</span>
                <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">NDVEC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="c"># RANDOM EMISSION IN THE X-Y PLANE</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">API</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">NDVEC</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c"># EMISSION ALONG Z AXIS</span>
                <span class="n">THET</span><span class="o">=</span><span class="mf">0.00</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">NDVEC</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c"># EMISSION ALONG -Z AXIS</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' ERROR NDVEC NOT CORRECT SUBROUTINE STOPPED:'</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="c"># endif</span>
            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
        <span class="c"># endif</span>
        <span class="c"># DOUBLE BETA DECAY</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ISHELL</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECEN</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">ELECN</span>
            <span class="n">ESECOND</span><span class="o">=</span><span class="n">ELECN</span>
            <span class="k">if</span><span class="p">(</span><span class="n">NDVEC</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="c"># RANDOM EMISSION DIRECTION</span>
                <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">NDVEC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="c"># RANDOM EMISSION IN THE X-Y PLANE</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">API</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">NDVEC</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c"># EMISSION ALONG Z AXIS</span>
                <span class="n">THET</span><span class="o">=</span><span class="mf">0.00</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">NDVEC</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c"># EMISSION ALONG -Z AXIS</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' ERROR NDVEC NOT CORRECT SUBROUTINE STOPPED:'</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="c"># endif</span>
            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
        <span class="c"># endif</span>
        <span class="c">#</span>
        <span class="n">THESEC</span><span class="o">=</span><span class="n">API</span><span class="o">-</span><span class="n">THET</span>
        <span class="k">if</span><span class="p">(</span><span class="n">PHI</span> <span class="o">&lt;</span> <span class="n">API</span><span class="p">):</span>
            <span class="n">PHISEC</span><span class="o">=</span><span class="n">API</span><span class="o">+</span><span class="n">PHI</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PHISEC</span><span class="o">=</span><span class="n">PHI</span><span class="o">-</span><span class="n">API</span>
        <span class="c"># endif</span>
        <span class="n">GOTO4</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">GOTO66</span><span class="p">():</span>
            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESECOND</span>
            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THESEC</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHISEC</span><span class="p">)</span>
            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THESEC</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHISEC</span><span class="p">)</span>
            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THESEC</span><span class="p">)</span>
            <span class="n">ELECN</span><span class="o">=</span><span class="n">ESECOND</span>
            <span class="n">ISECOND</span><span class="o">=</span><span class="mi">2</span>
            <span class="n">ISHELL</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">IFIRST</span><span class="o">=</span><span class="mi">0</span>
            <span class="c"># LOOP AROUND CASCADE</span>
            <span class="k">def</span> <span class="nf">GOTO4</span><span class="p">():</span>
                <span class="c"># CHECK FOR ELECTRON SHAKEOFF</span>
                <span class="n">IFIRST</span><span class="o">=</span><span class="n">IFIRST</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">if</span><span class="p">(</span><span class="n">IFIRST</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
                <span class="n">SHAKE</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ELECN</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ESHK</span><span class="p">,</span><span class="n">ICON</span><span class="p">,</span><span class="n">IFIRST</span><span class="p">,</span><span class="n">JVAC</span><span class="p">)</span>
                <span class="c">#  CALCULATE ENERGY OF ELECTRON</span>
                <span class="k">if</span><span class="p">(</span><span class="n">JVAC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="k">if</span><span class="p">(</span><span class="n">IFIRST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="c"># INITIAL ELECTRON + SHAKEOFF</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                            <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">,(</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                            <span class="n">ISHELL</span><span class="o">=</span><span class="n">JVAC</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                            <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][(</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">)]</span>
                        <span class="c"># PRIMARY ELECTRON</span>
                        <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECN</span>
                    <span class="c"># endif</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">IFIRST</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                    <span class="c"># endif</span>
                    <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                    <span class="c"># MAXIMUM ION CHARGE STATE =28</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">):</span>
                        <span class="c">#WRITE(6,99) IONSUM[NVAC] </span>
                        <span class="c">#99  </span>
                        <span class="k">print</span><span class="p">(</span><span class="s">' WARNING ION CHARGE LIMITED TO 28+ IN THIS VERSION'</span><span class="p">)</span> 
                        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                    <span class="c"># endif</span>
                    <span class="c"># SHAKE ELECTRON</span>
                    <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESHK</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">,(</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][(</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">)]</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                        <span class="n">GOTO100</span><span class="p">()</span>
                    <span class="c"># RANDOM EMISSION DIRECTION</span>
                    <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                    <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
                    <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                    <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                    <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                    <span class="c"># RETURN IF NO SHAKE OFF WITH BETA DECAY</span>
                <span class="k">def</span> <span class="nf">GOTO2</span><span class="p">():</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">return</span>
                    <span class="c"># GO INTO SECOND BETA LOOP</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ISECOND</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">GOTO66</span><span class="p">()</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">IFIRST</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">JVAC</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ISECOND</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="k">return</span>
                    <span class="c">#</span>
                    <span class="n">UPDATE</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span>
                    <span class="c">#  CHOOSE FLUORESCENCE OR AUGER TRANSITION</span>
                    <span class="n">TSUM</span><span class="o">=</span><span class="mf">0.0</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                            <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
                    <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">TSUM</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">ISECOND</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">GOTO66</span><span class="p">()</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">TSUM</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
                        <span class="k">return</span>  
                    <span class="c"># NORMALISE TO 1.0</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                        <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                            <span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                    <span class="c"># CREATE CUMULATIVE SUM ARRAY</span>
                    <span class="n">TEMP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">TEMP1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                            <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c"># FIND FLUORESCENCE OR AUGER TRANSITION</span>
                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="p">:</span>
                            <span class="c"># STORE PHOTON ENERGY AND ANGLE : UPDATE NOCC</span>
                            <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                                <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                                <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="k">print</span><span class="p">(</span><span class="s">' PHOTON ENERGY='</span><span class="p">,</span><span class="s">'</span><span class="si">%.3</span><span class="s">f'</span> <span class="o">%</span> <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]],</span><span class="s">'NVAC='</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="s">' IFLSUM='</span><span class="p">,</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">],</span><span class="s">' IN CALC'</span><span class="p">)</span>
                            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]])</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="n">GOTO100</span><span class="p">()</span>
                            <span class="c"># RANDOM EMISSION DIRECTION</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
                            <span class="c"># CALC DIRECTION COSINES OF FLUORESCENCE</span>
                            <span class="n">DRX</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRY</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRZ</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                            <span class="c">#   </span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="c"># FIND LOWEST VACANCY</span>
                            <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                                <span class="c">#  SECOND ELECTRON IN DOUBLE BETA DECAY</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">ISECOND</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                    <span class="n">GOTO66</span><span class="p">()</span>
                                <span class="k">return</span>    
                            <span class="c"># endif</span>
                        <span class="n">GOTO2</span><span class="p">()</span>
                        <span class="c"># endif </span>
                <span class="n">GOTO2</span><span class="p">()</span>    
                <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
                <span class="k">while</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                    <span class="n">counter116</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">R2</span><span class="o">=</span><span class="n">R1</span><span class="o">-</span><span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                            <span class="k">break</span>
                        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">R2</span> <span class="o">&lt;</span> <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">((</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">17</span><span class="p">)]):</span>
                                <span class="c"># AUGER OR COSTER KRONIG  </span>
                                <span class="c"># STORE EJECTED ELECTRON AND UPDATE NOCC</span>
                                <span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                                    <span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                                    <span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">ETEMP</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                    <span class="c"># DO NOT ALLOW NEGATIVE ENERGY TRANSITIONS</span>
                                    <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                    <span class="k">while</span><span class="p">(</span><span class="n">counter117</span><span class="p">):</span>
                                        <span class="n">counter117</span><span class="o">=</span><span class="mi">0</span>
                                        <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                                        <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]):</span>
                                            <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                    <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
                                    <span class="k">break</span>
                                <span class="c"># endif</span>
                                <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">):</span> 
                                    <span class="k">print</span><span class="p">(</span><span class="s">' IONSUM LIMITED TO 28 IN THIS VERSION IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">],</span><span class="s">' IN CALC'</span><span class="p">)</span>
                                    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                                <span class="c"># endif</span>
                                <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ETEMP</span>
                                <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ETEMP</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                    <span class="n">GOTO100</span><span class="p">()</span>
                                <span class="c"># RANDOM EMISSION DIRECTION</span>
                                <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                                <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                                <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                                <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
                                <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                                <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                                <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                                <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                                <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                                <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                                <span class="c"># FIND LOWEST VACANCY</span>
                                <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                    <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                                    <span class="c">#  SECOND ELECTRON IN DOUBLE BETA DECAY</span>
                                    <span class="k">if</span><span class="p">(</span><span class="n">ICON</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">ISECOND</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                        <span class="n">GOTO66</span><span class="p">()</span>
                                    <span class="k">return</span>
                                <span class="c"># endif</span>
                                    <span class="n">GOTO4</span><span class="p">()</span> 
                            <span class="c"># endif</span>
            <span class="n">GOTO4</span><span class="p">()</span>
        <span class="n">GOTO66</span><span class="p">()</span>
    <span class="n">GOTO100</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' ERROR IN CASCADE 0'</span><span class="p">)</span> 
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span> 
    <span class="c"># end</span>
<span class="k">def</span> <span class="nf">CALC1</span><span class="p">(</span><span class="n">IPN</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ELECEN</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">L1</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8(A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8(I-N)</span>
    <span class="c"># SCR=""</span>
    <span class="c">#    SCR1=""</span>
    <span class="c">#COMMON/GENCAS/</span>
    <span class="k">global</span> <span class="n">ELEV</span><span class="c">#[17,79]</span>
    <span class="k">global</span> <span class="n">NSDEG</span><span class="c">#(17)</span>
    <span class="k">global</span> <span class="n">AA</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">BB</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">SCR</span><span class="p">,</span><span class="n">SCR1</span>
    <span class="c">#COMMON/MIXC/</span>
    <span class="k">global</span> <span class="n">PRSH</span><span class="c">#(6,3,17,17)</span>
    <span class="k">global</span> <span class="n">ESH</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUG</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RAD</span><span class="c">#[6,3,17,17]</span>
    <span class="k">global</span> <span class="n">PRSHBT</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">IZ</span><span class="c">#[6,3]</span>
    <span class="k">global</span> <span class="n">INIOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">ISHLMX</span><span class="c">#(6,3)</span>
    <span class="k">global</span> <span class="n">AMZ</span><span class="c">#[6,3]</span>
    <span class="c">#COMMON/UPD/</span>
    <span class="k">global</span> <span class="n">NOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUGR</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RADR</span><span class="c">#(6,3,17,17)</span>
    <span class="c">#COMMON/CALCAS/</span>
    <span class="k">global</span> <span class="n">IONSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ0</span><span class="c">#(10,28)</span>
    <span class="c">#COMMON/CALCAS1/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]    </span>
    <span class="c">#DIMENSION </span>
    <span class="n">TEMP</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">)]</span>
    <span class="n">TEMP1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">289</span><span class="p">)]</span>
    <span class="c">#</span>
    <span class="c"># CALCULATE CASCADE IN GAS KGAS AND MOLECULAR COMPONENT LGAS </span>
    <span class="c"># WITH INTIAL ENERGY DEPOSIT ELECEN AND SHELL VACANCY CREATED AT ISHELL</span>
    <span class="c">#</span>
    <span class="n">ISTART</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">ISTARTF</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">API</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
    <span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.00</span><span class="o">*</span><span class="n">API</span>
    <span class="k">def</span> <span class="nf">GOTO100</span><span class="p">():</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELECEN</span>
        <span class="n">INIT</span><span class="o">=</span><span class="mi">1</span>
        <span class="c"># SET STARTING ARRAY NOCC EQUAL TO INIOCC</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">INIOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTART</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTARTF</span>
        <span class="c"># STORE PHOTOELECTRON ENERGY AND ANGLE</span>
        <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECEN</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
        <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ELECN</span>
        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>  
        <span class="c"># USE PHOTELECTRON ANGULAR DISTRIBUTION</span>
        <span class="n">APE</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">BPE</span><span class="o">=</span><span class="n">BB</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">ANGGEN</span><span class="p">(</span><span class="n">APE</span><span class="p">,</span><span class="n">BPE</span><span class="p">,</span><span class="n">THET</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">THET</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">THET</span><span class="o">=</span><span class="n">THET</span><span class="o">+</span><span class="n">API</span>
        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
        <span class="n">DRCOS</span><span class="p">(</span><span class="n">DRX0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">DRY0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">DRZ0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">THET</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span>
        <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRXX</span>
        <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRYY</span>
        <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRZZ</span>
        <span class="c"># LOOP AROUND CASCADE</span>
        <span class="k">def</span> <span class="nf">GOTO4</span><span class="p">():</span>
            <span class="c"># CHECK FOR ELECTRON SHAKEOFF</span>
            <span class="n">IDUM</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">INIT</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
            <span class="n">INSUM</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
            <span class="n">SHAKE</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ELECN</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ESHK</span><span class="p">,</span><span class="n">IDUM</span><span class="p">,</span><span class="n">INSUM</span><span class="p">,</span><span class="n">JVAC</span><span class="p">)</span>
            <span class="c">#  CALCULATE ENERGY OF ELECTRON</span>
            <span class="k">if</span><span class="p">(</span><span class="n">JVAC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#  ELECTRON + SHAKEOFF</span>
                <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECN</span>
                <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="c"># MAXIMUM ION CHARGE STATE =28</span>
                <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="k">print</span><span class="p">(</span><span class="s">' 1ST GEN LIMITED TO 28 IN THIS VERSION IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span>  
                    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>        
                <span class="c"># endif </span>
                <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESHK</span> 
                <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">]]</span>
                <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="n">GOTO100</span><span class="p">()</span>
                <span class="c"># RANDOM EMISSION DIRECTION </span>
                <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">GOTO2</span><span class="p">():</span>
                <span class="n">UPDATE</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span>
                <span class="n">INIT</span><span class="o">=</span><span class="mi">2</span>
                <span class="c"># CHOOSE FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">TSUM</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                <span class="k">if</span><span class="p">(</span><span class="n">TSUM</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="k">return</span>  
                <span class="c"># NORMALISE TO 1.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                <span class="c"># CREATE CUMULATIVE SUM ARRAY</span>
                <span class="n">TEMP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">TEMP1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c"># FIND FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="p">:</span>
                        <span class="c"># STORE PHOTON ENERGY AND ANGLE : UPDATE NOCC</span>
                        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                            <span class="n">GOTO100</span><span class="p">()</span>
                        <span class="c"># RANDOM EMISSION DIRECTION</span>
                        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                        <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>       
                        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                        <span class="n">DRX</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRY</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRZ</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                        <span class="c"># FIND LOWEST VACANCY</span>
                        <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                            <span class="k">return</span>    
                        <span class="c"># endif</span>
                        <span class="n">GOTO2</span><span class="p">()</span>
                    <span class="c"># endif</span>
            <span class="n">GOTO2</span><span class="p">()</span> 
            <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">while</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                <span class="n">counter116</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">R2</span><span class="o">=</span><span class="n">R1</span><span class="o">-</span><span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">R2</span> <span class="o">&lt;</span> <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">((</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">17</span><span class="p">)])</span> <span class="p">:</span>
                            <span class="c"># AUGER OR COSTER KRONIG  </span>
                            <span class="c"># STORE EJECTED ELECTRON AND UPDATE NOCC</span>
                            <span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ETEMP</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="c"># DO NOT ALLOW NEGATIVE ENERGY TRANSITIONS</span>
                                <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">while</span><span class="p">(</span><span class="n">counter117</span><span class="p">):</span>
                                    <span class="n">counter117</span><span class="o">=</span><span class="mi">0</span>
                                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]):</span>
                                        <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">break</span>
                            <span class="c"># endif</span>
                            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                                <span class="k">print</span><span class="p">(</span><span class="s">' 2ND GEN IONS LIMITED TO 28 IN THIS VERSION IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span> <span class="c">#34602</span>
                                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                            <span class="c"># endif</span>
                            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ETEMP</span>
                            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ETEMP</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="n">GOTO100</span><span class="p">()</span>
                            <span class="c"># RANDOM EMISSION DIRECTION</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="c"># FIND LOWEST VACANCY</span>
                            <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                                <span class="k">return</span>
                            <span class="c"># endif</span>
                            <span class="n">GOTO4</span><span class="p">()</span>    
                    <span class="c"># endif</span>
        <span class="n">GOTO4</span><span class="p">()</span>
    <span class="n">GOTO100</span><span class="p">()</span>            
    <span class="k">print</span><span class="p">(</span><span class="s">' ERROR IN CASCADE 1'</span><span class="p">)</span> 
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span> 
    <span class="c"># end</span>

<span class="k">def</span> <span class="nf">CALC2</span><span class="p">(</span><span class="n">IPN</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ELECEN</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">L1</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8(A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8(I-N)</span>

    <span class="c"># SCR=""</span>
    <span class="c"># SCR1=""</span>
    <span class="c">#COMMON/GENCAS/</span>
    <span class="k">global</span> <span class="n">ELEV</span><span class="c">#[17,79]</span>
    <span class="k">global</span> <span class="n">NSDEG</span><span class="c">#(17)</span>
    <span class="k">global</span> <span class="n">AA</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">BB</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">SCR</span><span class="p">,</span><span class="n">SCR1</span>
    <span class="c">#COMMON/MIXC/</span>
    <span class="k">global</span> <span class="n">PRSH</span><span class="c">#(6,3,17,17)</span>
    <span class="k">global</span> <span class="n">ESH</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUG</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RAD</span><span class="c">#[6,3,17,17]</span>
    <span class="k">global</span> <span class="n">PRSHBT</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">IZ</span><span class="c">#[6,3]</span>
    <span class="k">global</span> <span class="n">INIOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">ISHLMX</span><span class="c">#(6,3)</span>
    <span class="k">global</span> <span class="n">AMZ</span><span class="c">#[6,3]</span>
    <span class="c">#COMMON/UPD/</span>
    <span class="k">global</span> <span class="n">NOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUGR</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RADR</span><span class="c">#(6,3,17,17)</span>
    <span class="c">#COMMON/CALCAS/</span>
    <span class="k">global</span> <span class="n">IONSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ0</span><span class="c">#(10,28)</span>
    <span class="c">#COMMON/CALCAS1/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28] </span>
    <span class="c">#DIMENSION </span>
    <span class="n">TEMP</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">)]</span>
    <span class="n">TEMP1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">289</span><span class="p">)]</span>
    <span class="c">#</span>
    <span class="c"># CALCULATE CASCADE IN GAS KGAS AND MOLECULAR COMPONENT LGAS</span>
    <span class="c"># WITH INTIAL ENERGY DEPOSIT ELECEN AND SHELL VACANCY CREATED AT ISHELL</span>
    <span class="c">#</span>
    <span class="n">ISTART</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">ISTARTF</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">API</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
    <span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.00</span><span class="o">*</span><span class="n">API</span>
    <span class="k">def</span> <span class="nf">GOTO100</span><span class="p">():</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELECEN</span>
        <span class="n">INIT</span><span class="o">=</span><span class="mi">1</span>
        <span class="c"># SET STARTING ARRAY NOCC EQUAL TO INIOCC</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">INIOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTART</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTARTF</span>
        <span class="c"># STORE INITIAL PHOTELECTRON AND ANGLE</span>
        <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECEN</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
        <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ELECN</span>
        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>  
        <span class="c"># USE PHOTOELECTRON ANGULAR DISTRIBUTION</span>
        <span class="n">APE</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">BPE</span><span class="o">=</span><span class="n">BB</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">ANGGEN</span><span class="p">(</span><span class="n">APE</span><span class="p">,</span><span class="n">BPE</span><span class="p">,</span><span class="n">THET</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">THET</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">THET</span><span class="o">=</span><span class="n">THET</span><span class="o">+</span><span class="n">API</span>
        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
        <span class="n">DRCOS</span><span class="p">(</span><span class="n">DRX0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">DRY0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">DRZ0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">THET</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span>
        <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRXX</span>
        <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRYY</span>
        <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRZZ</span>
        <span class="c"># LOOP AROUND CASCADE</span>
        <span class="k">def</span> <span class="nf">GOTO4</span><span class="p">():</span>
            <span class="c"># CHECK FOR ELECTRON SHAKEOFF</span>
            <span class="n">IDUM</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">INIT</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
            <span class="n">INSUM</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
            <span class="n">SHAKE</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ELECN</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ESHK</span><span class="p">,</span><span class="n">IDUM</span><span class="p">,</span><span class="n">INSUM</span><span class="p">,</span><span class="n">JVAC</span><span class="p">)</span>
            <span class="c">#  CALCULATE ENERGY OF ELECTRON</span>
            <span class="k">if</span><span class="p">(</span><span class="n">JVAC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#  ELECTRON + SHAKEOFF</span>
                <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECN</span>
                <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                <span class="c"># MAXIMUM ION CHARGE STATE =28</span>
                <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">' 2ND GEN IONS LIMITED TO 28 IN THIS VERSION IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span> 
                    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                <span class="c"># endif</span>
                <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESHK</span>
                <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="n">GOTO100</span><span class="p">()</span>
                <span class="c"># RANDOM EMISSION DIRECTION</span>
                <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">GOTO2</span><span class="p">():</span>
                <span class="n">UPDATE</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span>
                <span class="n">INIT</span><span class="o">=</span><span class="mi">2</span>
                <span class="c"># CHOOSE FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">TSUM</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                <span class="k">if</span><span class="p">(</span><span class="n">TSUM</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="k">return</span>  
                <span class="c"># NORMALISE TO 1.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                <span class="c"># CREATE CUMULATIVE SUM ARRAY</span>
                <span class="n">TEMP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">TEMP1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c"># FIND FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="p">:</span>
                        <span class="c"># STORE PHOTON ENERGY AND UPDATE NOCC</span>
                        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">' EPHOTON='</span><span class="p">,</span><span class="s">'</span><span class="si">%.3</span><span class="s">f'</span> <span class="o">%</span> <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]],</span><span class="s">' NVAC='</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="s">' IN CALC2'</span><span class="p">)</span>
                        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                            <span class="n">GOTO100</span><span class="p">()</span>
                        <span class="c"># RANDOM EMISSION DIRECTION</span>
                        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                        <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                        <span class="n">DRX</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRY</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRZ</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                        <span class="c"># FIND LOWEST VACANCY</span>
                        <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                            <span class="k">return</span>    
                        <span class="c"># endif</span>
                        <span class="n">GOTO2</span><span class="p">()</span>
                    <span class="c"># endif</span>
            <span class="n">GOTO2</span><span class="p">()</span> 
            <span class="n">counter116</span>
            <span class="k">while</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                <span class="n">counter116</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">R2</span><span class="o">=</span><span class="n">R1</span><span class="o">-</span><span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">R2</span> <span class="o">&lt;</span> <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">((</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">17</span><span class="p">)])</span> <span class="p">:</span>
                            <span class="c"># AUGER OR COSTER KRONIG  </span>
                            <span class="c"># STORE EJECTED ELECTRON AND UPDATE NOCC</span>
                            <span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ETEMP</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="c"># DO NOT ALLOW NEGATIVE ENERGY TRANSITIONS</span>
                                <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">while</span><span class="p">(</span><span class="n">counter117</span><span class="p">):</span>
                                    <span class="n">counter117</span><span class="o">=</span><span class="mi">0</span>
                                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]):</span>
                                        <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span> <span class="c">#34598</span>
                                <span class="k">break</span>
                            <span class="c"># endif</span>
                            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                                <span class="k">print</span><span class="p">(</span><span class="s">' 2ND GEN IONS LIMITED TO 28 IN THIS VERSION IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span>
                                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                            <span class="c"># endif</span>
                            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ETEMP</span>
                            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ETEMP</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="n">GOTO100</span><span class="p">()</span>
                            <span class="c"># RANDOM EMISSION DIRECTION</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="c"># FIND LOWEST VACANCY</span>
                            <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                                <span class="k">return</span>
                            <span class="c"># endif</span>
                            <span class="n">GOTO4</span><span class="p">()</span>
                        <span class="c"># endif </span>
        <span class="n">GOTO4</span><span class="p">()</span>
    <span class="n">GOTO100</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' ERROR IN CASCADE 2'</span><span class="p">)</span> 
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span> 
    <span class="c"># end</span>
<span class="k">def</span> <span class="nf">CALC3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ELECEN</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">L1</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8(A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8(I-N)</span>

    <span class="c">#CHARACTER*6 </span>
    <span class="c"># SCR="",</span>
    <span class="c"># SCR1=""</span>
    <span class="c">#COMMON/GENCAS/</span>
    <span class="k">global</span> <span class="n">ELEV</span><span class="c">#[17,79]</span>
    <span class="k">global</span> <span class="n">NSDEG</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">AA</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">BB</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">SCR</span><span class="p">,</span><span class="n">SCR1</span>
    <span class="c">#COMMON/MIXC/</span>
    <span class="k">global</span> <span class="n">PRSH</span><span class="c">#(6,3,17,17)</span>
    <span class="k">global</span> <span class="n">ESH</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUG</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RAD</span><span class="c">#[6,3,17,17]</span>
    <span class="k">global</span> <span class="n">PRSHBT</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">IZ</span><span class="c">#[6,3]</span>
    <span class="k">global</span> <span class="n">INIOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">ISHLMX</span><span class="c">#(6,3)</span>
    <span class="k">global</span> <span class="n">AMZ</span><span class="c">#[6,3]</span>
    <span class="c">#COMMON/UPD/</span>
    <span class="k">global</span> <span class="n">NOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUGR</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RADR</span><span class="c">#(6,3,17,17)</span>
    <span class="c">#COMMON/CALCAS2/</span>
    <span class="k">global</span> <span class="n">IONSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ0</span><span class="c">#(10,28)</span>
    <span class="c">#COMMON/CALCAS3/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]</span>
    <span class="n">TEMP</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">18</span><span class="p">)]</span>
    <span class="n">TEMP1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">289</span><span class="p">)]</span>
    <span class="c">#</span>
    <span class="c"># CALCULATE CASCADE IN GAS KGAS AND MOLECULAR COMPONENT LGAS</span>
    <span class="c"># WITH INTIAL ENERGY DEPOSIT ELECEN AND SHELL VACANCY CREATED AT ISHELL</span>
    <span class="c">#</span>
    <span class="n">ISTART</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">ISTARTF</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">API</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
    <span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.00</span><span class="o">*</span><span class="n">API</span>
    <span class="k">def</span> <span class="nf">GOTO100</span><span class="p">():</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELECEN</span>
        <span class="n">INIT</span><span class="o">=</span><span class="mi">1</span>
        <span class="c"># SET STARTING ARRAY NOCC EQUAL TO INIOCC</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">INIOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTART</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTARTF</span>
        <span class="c"># STORE PHOTOELECTRON ENERGY AND ANGLE</span>
        <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECEN</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
        <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ELECN</span>
        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>  
        <span class="c"># USE PHOTOELECTRON ANGULAR DISTRIBUTION</span>
        <span class="n">APE</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">BPE</span><span class="o">=</span><span class="n">BB</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">ANGGEN</span><span class="p">(</span><span class="n">APE</span><span class="p">,</span><span class="n">BPE</span><span class="p">,</span><span class="n">THET</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">THET</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">THET</span><span class="o">=</span><span class="n">THET</span><span class="o">+</span><span class="n">API</span>
        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
        <span class="n">DRCOS</span><span class="p">(</span><span class="n">DRX0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">DRY0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">DRZ0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">THET</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span>
        <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRXX</span>
        <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRYY</span>
        <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRZZ</span>
        <span class="c"># LOOP AROUND CASCADE</span>
        <span class="k">def</span> <span class="nf">GOTO4</span><span class="p">():</span>
            <span class="c"># CHECK FOR ELECTRON SHAKEOFF</span>
            <span class="n">IDUM</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">INIT</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
            <span class="n">INSUM</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
            <span class="n">SHAKE</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ELECN</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ESHK</span><span class="p">,</span><span class="n">IDUM</span><span class="p">,</span><span class="n">INSUM</span><span class="p">,</span><span class="n">JVAC</span><span class="p">)</span>
            <span class="c">#  CALCULATE ENERGY OF ELECTRON</span>
            <span class="k">if</span><span class="p">(</span><span class="n">JVAC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">GOTO2</span><span class="p">()</span>
            <span class="c">#  ELECTRON + SHAKEOFF</span>
            <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECN</span>
            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="c"># MAXIMUM ION CHARGE STATE =28</span>
            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' 3RD GEN ION CHARGE LIMITED TO 28  IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span> 
                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="c"># endif</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESHK</span>
            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">GOTO100</span><span class="p">()</span>
            <span class="c"># RANDOM EMISSION ANGLE</span>
            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">GOTO2</span><span class="p">():</span>
                <span class="n">UPDATE</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span>
                <span class="n">INIT</span><span class="o">=</span><span class="mi">2</span>
                <span class="c"># CHOOSE FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">TSUM</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                <span class="k">if</span><span class="p">(</span><span class="n">TSUM</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="k">return</span>  
                <span class="c"># NORMALISE TO 1.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                <span class="c"># CREATE CUMULATIVE SUM ARRAY</span>
                <span class="n">TEMP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">TEMP1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c"># FIND FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="p">:</span>
                        <span class="c"># STORE PHOTON ENERGY AND UPDATE NOCC</span>
                        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                            <span class="n">GOTO100</span><span class="p">()</span>
                        <span class="c"># RANDOM EMISSION DIRECTION</span>
                        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                        <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                        <span class="n">DRX</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRY</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRZ</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                        <span class="c"># FIND LOWEST VACANCY</span>
                        <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                            <span class="k">return</span>    
                        <span class="c"># endif</span>
                        <span class="n">GOTO2</span><span class="p">()</span>
                    <span class="c"># endif </span>
            <span class="n">GOTO2</span><span class="p">()</span>  
            <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">while</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                <span class="n">counter116</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">R2</span><span class="o">=</span><span class="n">R1</span><span class="o">-</span><span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">R2</span> <span class="o">&lt;</span> <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">((</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">17</span><span class="p">)])</span> <span class="p">:</span>
                            <span class="c"># AUGER OR COSTER KRONIG  </span>
                            <span class="c"># STORE EJECTED ELECTRON AND UPDATE NOCC</span>
                            <span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ETEMP</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="c"># DO NOT ALLOW NEGATIVE ENERGY TRANSITIONS</span>
                                <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">while</span><span class="p">(</span><span class="n">counter117</span><span class="p">):</span>
                                    <span class="n">counter117</span><span class="o">=</span><span class="mi">0</span>
                                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]):</span>
                                        <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">break</span>
                                <span class="c"># endif</span>
                            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                                <span class="k">print</span><span class="p">(</span><span class="s">' 3RD GEN ION CHARGE LIMITED TO 28  IONSUM='</span><span class="p">,</span> <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span>
                                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                            <span class="c"># endif</span>
                            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ETEMP</span>
                            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ETEMP</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="n">GOTO100</span><span class="p">()</span>
                            <span class="c"># RANDOM EMISSION DIRECTION</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="c"># FIND LOWEST VACANCY</span>
                            <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                                <span class="k">return</span>
                            <span class="c"># endif</span>
                            <span class="n">GOTO4</span><span class="p">()</span> 
                        <span class="c"># endif</span>
        <span class="n">GOTO4</span><span class="p">()</span>
    <span class="n">GOTO100</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' ERROR IN CASCADE 3'</span><span class="p">)</span> 
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span> 
    <span class="c"># end</span>

<span class="k">def</span> <span class="nf">CALC4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ELECEN</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">L1</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8(A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8(I-N)</span>
    <span class="c"># SCR=""\nSCR1=""</span>
    <span class="c"># COMMON/GENCAS/ELEV[17,79],NSDEG(17),AA[17],BB[17],SCR,SCR1</span>
    <span class="c"># COMMON/MIXC/PRSH(6,3,17,17),ESH(6,3,17),AUG(6,3,17,17,17),RAD[6,3,17,17],PRSHBT(6,3,17),IZ[6,3],INIOCC(6,3,17),ISHLMX(6,3),AMZ[6,3]</span>
    <span class="c"># COMMON/UPD/NOCC(6,3,17),AUGR(6,3,17,17,17),RADR(6,3,17,17)</span>
    <span class="c"># COMMON/CALCAS3/IONSUM0(10),IFLSUM0(10),ESTORE0(10,28),EPHOTON0(10,28),DRXE0(10,28),DRYE0(10,28),DRZE0(10,28),DRX0(10,28),DRY0(10,28),DRZ0(10,28)</span>
    <span class="c"># COMMON/CALCAS4/IONSUM(10),IFLSUM(10),ESTORE(10,28),EPHOTON(10,28),DRXE(10,28),DRYE(10,28),DRZE(10,28),DRX(10,28),DRY(10,28),DRZ[10,28]</span>
    <span class="c"># DIMENSION TEMP[17],TEMP1(289)</span>

    <span class="c">#COMMON/GENCAS/</span>
    <span class="k">global</span> <span class="n">ELEV</span><span class="c">#[17,79]</span>
    <span class="k">global</span> <span class="n">NSDEG</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">AA</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">BB</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">SCR</span><span class="p">,</span><span class="n">SCR1</span>
    <span class="c">#COMMON/MIXC/</span>
    <span class="k">global</span> <span class="n">PRSH</span><span class="c">#(6,3,17,17)</span>
    <span class="k">global</span> <span class="n">ESH</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUG</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RAD</span><span class="c">#[6,3,17,17]</span>
    <span class="k">global</span> <span class="n">PRSHBT</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">IZ</span><span class="c">#[6,3]</span>
    <span class="k">global</span> <span class="n">INIOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">ISHLMX</span><span class="c">#(6,3)</span>
    <span class="k">global</span> <span class="n">AMZ</span><span class="c">#[6,3]</span>
    <span class="c">#COMMON/UPD/</span>
    <span class="k">global</span> <span class="n">NOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUGR</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RADR</span><span class="c">#(6,3,17,17)</span>
    <span class="c">#COMMON/CALCAS3/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]</span>
    <span class="c"># COMMON/CALCAS4/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10]</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10]</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28]</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28]</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28]</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28]</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28]</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28]</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28]</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]</span>
    <span class="c">#DIMENSION</span>
    <span class="n">TEMP</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">)]</span>
    <span class="n">TEMP1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">289</span><span class="p">)]</span>
    <span class="c">#</span>
    <span class="c"># CALCULATE CASCADE IN GAS KGAS AND MOLECULAR COMPONENT LGAS</span>
    <span class="c"># WITH INTIAL ENERGY DEPOSIT ELECEN AND SHELL VACANCY CREATED AT ISHELL</span>
    <span class="c">#</span>
    <span class="n">ISTART</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">ISTARTF</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">API</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
    <span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.00</span><span class="o">*</span><span class="n">API</span>
    <span class="k">def</span> <span class="nf">GOTO100</span><span class="p">():</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELECEN</span>
        <span class="n">INIT</span><span class="o">=</span><span class="mi">1</span>
        <span class="c"># SET STARTING ARRAY NOCC EQUAL TO INIOCC</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">INIOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTART</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTARTF</span>
        <span class="c"># STORE PHOTOELECTRON ENERGY AND ANGLE</span>
        <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECEN</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
        <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ELECN</span>
        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>  
        <span class="c"># USE PHOTOELECTRON ANGULAR DISTRIBUTION</span>
        <span class="n">APE</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">BPE</span><span class="o">=</span><span class="n">BB</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">ANGGEN</span><span class="p">(</span><span class="n">APE</span><span class="p">,</span><span class="n">BPE</span><span class="p">,</span><span class="n">THET</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">THET</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">THET</span><span class="o">=</span><span class="n">THET</span><span class="o">+</span><span class="n">API</span>
        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
        <span class="n">DRCOS</span><span class="p">(</span><span class="n">DRX0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">),</span><span class="n">DRY0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">),</span><span class="n">DRZ0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">),</span><span class="n">THET</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span>
        <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRXX</span>
        <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRYY</span>
        <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRZZ</span>
        <span class="c"># LOOP AROUND CASCADE</span>
        <span class="k">def</span> <span class="nf">GOTO4</span><span class="p">():</span>
            <span class="c"># CHECK FOR ELECTRON SHAKEOFF</span>
            <span class="n">IDUM</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">INIT</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
            <span class="n">INSUM</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
            <span class="n">SHAKE</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ELECN</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ESHK</span><span class="p">,</span><span class="n">IDUM</span><span class="p">,</span><span class="n">INSUM</span><span class="p">,</span><span class="n">JVAC</span><span class="p">)</span>
            <span class="c">#  CALCULATE ENERGY OF ELECTRON</span>
            <span class="k">if</span><span class="p">(</span><span class="n">JVAC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">GOTO2</span><span class="p">()</span>
            <span class="c">#  ELECTRON + SHAKEOFF</span>
            <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECN</span>
            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="c"># MAXIMUM ION CHARGE STATE =28</span>
            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' 4TH GEN ION CHARGE LIMITED TO 28 IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span> 
                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="c"># endif</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESHK</span>
            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">GOTO100</span><span class="p">()</span>
            <span class="c"># RANDOM EMISSION ANGLE</span>
            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">GOTO2</span><span class="p">():</span>
                <span class="n">UPDATE</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span>
                <span class="n">INIT</span><span class="o">=</span><span class="mi">2</span>
                <span class="c"># CHOOSE FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">TSUM</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                <span class="k">if</span><span class="p">(</span><span class="n">TSUM</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="k">return</span>  
                <span class="c"># NORMALISE TO 1.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                <span class="c"># CREATE CUMULATIVE SUM ARRAY</span>
                <span class="n">TEMP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">TEMP1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c"># FIND FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="p">:</span>
                        <span class="c"># STORE PHOTON ENERGY AND UPDATE NOCC</span>
                        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                            <span class="n">GOTO100</span><span class="p">()</span>
                        <span class="c"># RANDOM EMISSION DIRECTION</span>
                        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                        <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                        <span class="n">DRX</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRY</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRZ</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                        <span class="c"># FIND LOWEST VACANCY</span>
                        <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                            <span class="k">return</span>    
                        <span class="c"># endif</span>
                        <span class="n">GOTO2</span><span class="p">()</span>
                    <span class="c"># endif </span>
            <span class="n">GOTO2</span><span class="p">()</span>
            <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">while</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                <span class="n">R2</span><span class="o">=</span><span class="n">R1</span><span class="o">-</span><span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">R2</span> <span class="o">&lt;</span> <span class="n">TEMP1</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="p">((</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">17</span><span class="p">)))</span> <span class="p">:</span>
                            <span class="c"># AUGER OR COSTER KRONIG  </span>
                            <span class="c"># STORE EJECTED ELECTRON AND UPDATE NOCC</span>
                            <span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ETEMP</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="c"># DO NOT ALLOW NEGATIVE ENERGY TRANSITIONS</span>
                                <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">while</span><span class="p">(</span><span class="n">counter117</span><span class="p">):</span>
                                    <span class="n">counter117</span><span class="o">=</span><span class="mi">0</span>
                                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]):</span>
                                        <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">break</span>
                            <span class="c"># endif</span>
                            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                                <span class="k">print</span><span class="p">(</span><span class="s">' 4TH GEN ION CHARGE LIMITED TO 28 IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span>
                                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                            <span class="c"># endif</span>
                            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ETEMP</span>
                            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ETEMP</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="n">GOTO100</span><span class="p">()</span>
                            <span class="c"># RANDOM EMISSION DIRECTION</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="c"># FIND LOWEST VACANCY</span>
                            <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                                <span class="k">return</span>
                            <span class="c"># endif</span>
                            <span class="n">GOTO4</span><span class="p">()</span> 
                        <span class="c"># endif</span>
        <span class="n">GOTO4</span><span class="p">()</span>
    <span class="n">GOTO100</span><span class="p">()</span>            
    <span class="k">print</span><span class="p">(</span><span class="s">' ERROR IN CASCADE 4'</span><span class="p">)</span> 
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span> 
    <span class="c"># end</span>

<span class="k">def</span> <span class="nf">CALC5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ELECEN</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">L1</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8(A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8(I-N)</span>
    <span class="c"># SCR=""\nSCR1=""</span>
    <span class="c">#COMMON/GENCAS/</span>
    <span class="k">global</span> <span class="n">ELEV</span><span class="c">#[17,79]</span>
    <span class="k">global</span> <span class="n">NSDEG</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">AA</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">BB</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">SCR</span><span class="p">,</span><span class="n">SCR1</span>
    <span class="c">#COMMON/MIXC/</span>
    <span class="k">global</span> <span class="n">PRSH</span><span class="c">#(6,3,17,17)</span>
    <span class="k">global</span> <span class="n">ESH</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUG</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RAD</span><span class="c">#[6,3,17,17]</span>
    <span class="k">global</span> <span class="n">PRSHBT</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">IZ</span><span class="c">#[6,3]</span>
    <span class="k">global</span> <span class="n">INIOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">ISHLMX</span><span class="c">#(6,3)</span>
    <span class="k">global</span> <span class="n">AMZ</span><span class="c">#[6,3]</span>
    <span class="c">#COMMON/UPD/</span>
    <span class="k">global</span> <span class="n">NOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUGR</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RADR</span><span class="c">#(6,3,17,17)</span>
    <span class="c">#COMMON/CALCAS4/</span>
    <span class="k">global</span> <span class="n">IONSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ0</span><span class="c">#(10,28)</span>
    <span class="c">#COMMON/CALCAS5/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]    </span>
    <span class="c">#DIMENSION </span>
    <span class="n">TEMP</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">)]</span>
    <span class="n">TEMP1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">289</span><span class="p">)]</span>
    <span class="c">#</span>
    <span class="c"># CALCULATE CASCADE IN GAS KGAS AND MOLECULAR COMPONENT LGAS</span>
    <span class="c"># WITH INTIAL ENERGY DEPOSIT ELECEN AND SHELL VACANCY CREATED AT ISHELL</span>
    <span class="c">#</span>
    <span class="n">ISTART</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">ISTARTF</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">API</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
    <span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.00</span><span class="o">*</span><span class="n">API</span>
    <span class="k">def</span> <span class="nf">GOTO100</span><span class="p">():</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELECEN</span>
        <span class="n">INIT</span><span class="o">=</span><span class="mi">1</span>
        <span class="c"># SET STARTING ARRAY NOCC EQUAL TO INIOCC</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">INIOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTART</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">ISTARTF</span>
        <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECEN</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
        <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ELECN</span>
        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>  
        <span class="c"># USE PHOTOELECTRON ANGULAR DISTRIBUTION</span>
        <span class="n">APE</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">BPE</span><span class="o">=</span><span class="n">BB</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
        <span class="n">ANGGEN</span><span class="p">(</span><span class="n">APE</span><span class="p">,</span><span class="n">BPE</span><span class="p">,</span><span class="n">THET</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">THET</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">THET</span><span class="o">=</span><span class="n">THET</span><span class="o">+</span><span class="n">API</span>
        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
        <span class="n">DRCOS</span><span class="p">(</span><span class="n">DRX0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">DRY0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">DRZ0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">],</span><span class="n">THET</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span>
        <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRXX</span>
        <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRYY</span>
        <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">DRZZ</span>
        <span class="c"># LOOP AROUND CASCADE</span>
        <span class="k">def</span> <span class="nf">GOTO4</span><span class="p">():</span>
            <span class="c"># CHECK FOR ELECTRON SHAKEOFF</span>
            <span class="n">IDUM</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">INIT</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
            <span class="n">INSUM</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
            <span class="n">SHAKE</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ELECN</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ESHK</span><span class="p">,</span><span class="n">IDUM</span><span class="p">,</span><span class="n">INSUM</span><span class="p">,</span><span class="n">JVAC</span><span class="p">)</span>
            <span class="c">#  CALCULATE ENERGY OF ELECTRON</span>
            <span class="k">if</span><span class="p">(</span><span class="n">JVAC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">GOTO2</span><span class="p">()</span>
            <span class="c">#  ELECTRON + SHAKEOFF</span>
            <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECN</span>
            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="c"># MAXIMUM ION CHARGE STATE =28</span>
            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' 5TH GEN ION CHARGE LIMITED TO 28  IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span>
                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span> 
            <span class="c"># endif</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESHK</span>
            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">GOTO100</span><span class="p">()</span>
            <span class="c"># RANDOM EMISSION ANGLE</span>
            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">GOTO2</span><span class="p">():</span>
                <span class="n">UPDATE</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span>
                <span class="n">INIT</span><span class="o">=</span><span class="mi">2</span>
                <span class="c"># CHOOSE FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">TSUM</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                <span class="k">if</span><span class="p">(</span><span class="n">TSUM</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="k">return</span>  
                <span class="c"># NORMALISE TO 1.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                <span class="c"># CREATE CUMULATIVE SUM ARRAY</span>
                <span class="n">TEMP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">TEMP1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c"># FIND FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="p">:</span>
                        <span class="c"># STORE PHOTON ENERGY AND UPDATE NOCC</span>
                        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                            <span class="n">GOTO100</span><span class="p">()</span>
                        <span class="c"># RANDOM EMISSION DIRECTION</span>
                        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                        <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                        <span class="n">DRX</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRY</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRZ</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                        <span class="c"># FIND LOWEST VACANCY</span>
                        <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                            <span class="k">return</span>    
                        <span class="c"># endif</span>
                        <span class="n">GOTO2</span><span class="p">()</span>
                    <span class="c"># endif </span>
            <span class="n">GOTO2</span><span class="p">()</span>
            <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">while</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                <span class="n">counter116</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">R2</span><span class="o">=</span><span class="n">R1</span><span class="o">-</span><span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">counter116</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">R2</span> <span class="o">&lt;</span> <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">((</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">17</span><span class="p">)])</span> <span class="p">:</span>
                            <span class="c"># AUGER OR COSTER KRONIG  </span>
                            <span class="c"># STORE EJECTED ELECTRON AND UPDATE NOCC</span>
                            <span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">][</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ETEMP</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="c"># DO NOT ALLOW NEGATIVE ENERGY TRANSITIONS</span>
                                <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">while</span><span class="p">(</span><span class="n">counter117</span><span class="p">):</span>
                                    <span class="n">counter117</span><span class="o">=</span><span class="mi">0</span>
                                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="mi">17</span><span class="p">]):</span>
                                        <span class="n">counter117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="n">counter116</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">break</span>
                            <span class="c"># endif</span>
                            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                                <span class="k">print</span><span class="p">(</span><span class="s">' 5TH GEN ION CHARGE LIMITED TO 28  IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">])</span>
                                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                            <span class="c"># endif</span>
                            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ETEMP</span>
                            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ETEMP</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="n">GOTO100</span><span class="p">()</span>
                            <span class="c"># RANDOM EMISSION DIRECTION</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="c"># FIND LOWEST VACANCY</span>
                            <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                                <span class="k">return</span>
                            <span class="c"># endif</span>
                            <span class="n">GOTO4</span><span class="p">()</span> 
                        <span class="c"># endif</span>
        <span class="n">GOTO4</span><span class="p">()</span>
    <span class="n">GOTO100</span><span class="p">()</span>    
    <span class="k">print</span><span class="p">(</span><span class="s">' ERROR IN CASCADE 5'</span><span class="p">)</span> 
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span> 
  <span class="c"># end</span>
</code></pre>