<h2 id='csstfne'>CSSTFNE</h2>
<p>Stores event data for N-th generation fluorescence.</p>
<h3 id='arguments'>Arguments</h3>
<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NVAC</td>
<td></td>
</tr>
<tr>
<td>L1</td>
<td></td>
</tr>
<tr>
<td>DIST1</td>
<td></td>
</tr>
</tbody></table>
<h3 id='pseudo-code'>Pseudo-Code</h3><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">CSSTF1E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">):</span>           
    <span class="c"># IMPLICIT #real*8 (A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8 (I-N)</span>
    <span class="c"># COMMON/CALCASE/IONSUM0(10),IFLSUM0(10),ESTORE0(10,28),EPHOTON0(10,28),DRXE0(10,28),DRYE0(10,28),DRZE0(10,28),DRX0(10,28),DRY0(10,28),DRZ0(10,28)</span>
    <span class="c"># COMMON/CALCAS1E/IONSUM(10),IFLSUM(10),ESTORE(10,28),EPHOTON(10,28),DRXE(10,28),DRYE(10,28),DRZE(10,28),DRX(10,28),DRY(10,28),DRZ[10,28]</span>
    <span class="c"># COMMON/GENE1/IONF1(10),ESTF1(10,28),X1(10,28),Y1(10,28),Z1(10,28),DRXS(10,28),DRYS(10,28),DRZS(10,28),T1(10,28)</span>
    <span class="c">#COMMON/CALCASE/</span>
    <span class="k">global</span> <span class="n">IONSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ0</span><span class="c">#(10,28)</span>
    <span class="c">#COMMON/CALCAS1E/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]</span>
    <span class="c">#COMMON/GENE1/</span>
    <span class="k">global</span> <span class="n">IONF1</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTF1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">X1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T1</span><span class="c">#(10,28)</span>


    <span class="c"># COMMON/GEN111/X11(10,28),Y11(10,28),Z11(10,28),T11(10,28)</span>
    <span class="c"># COMMON/GEN101/X01(10),Y01(10),Z01(10),T01(10)</span>
    <span class="c">#    COMMON/GEN111/</span>
    <span class="k">global</span> <span class="n">X11</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y11</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z11</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T11</span><span class="c">#(10,28)</span>
    <span class="c">#    COMMON/GEN101/</span>
    <span class="k">global</span> <span class="n">X01</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">Y01</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">Z01</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">T01</span><span class="c">#(10)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">L1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c"># ZERO COUNTER</span>
        <span class="n">IONF1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">28</span><span class="p">):</span>
            <span class="n">ESTF1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">return</span>
    <span class="c"># endif</span>
    <span class="c"># STORE EVENT DATA FOR FIRST GENERATION FLUORESCENCE</span>
    <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' WARNING FIRST GENERATION CONVERTED FLUORESCENCE HAS AN EVENT WITH'</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">],</span><span class="s">' IONS.</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">' COMPTON BRANCH NO='</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
    <span class="c"># endif</span>
    <span class="c"># VEL IN METRES/PICOSECOND</span>
    <span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">IONF1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]):</span>
        <span class="n">ESTF1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">X1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">X01</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Y1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Y01</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Z1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Z01</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">T1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">T01</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">/</span><span class="n">VV</span>
        <span class="n">X11</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">X1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Y11</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Y1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Z11</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Z1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">T11</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">T1</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRXS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRYS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRZS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
    <span class="k">return</span>
  <span class="c"># end</span>
<span class="k">def</span> <span class="nf">CSSTF2E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">):</span>               
    <span class="c"># IMPLICIT #real*8 (A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8 (I-N)</span>
    <span class="c"># COMMON/CALCAS1E/IONSUM0(10),IFLSUM0(10),ESTORE0(10,28),EPHOTON0(10,28),DRXE0(10,28),DRYE0(10,28),DRZE0(10,28),DRX0(10,28),DRY0(10,28),DRZ0(10,28)</span>
    <span class="c"># COMMON/CALCAS2E/IONSUM(10),IFLSUM(10),ESTORE(10,28),EPHOTON(10,28),DRXE(10,28),DRYE(10,28),DRZE(10,28),DRX(10,28),DRY(10,28),DRZ[10,28]</span>
    <span class="c"># COMMON/GENE2/IONF2(10),ESTF2(10,28),X2(10,28),Y2(10,28),Z2(10,28),DRXS(10,28),DRYS(10,28),DRZS(10,28),T2(10,28)</span>
    <span class="c">#COMMON/CALCASE/</span>
    <span class="k">global</span> <span class="n">IONSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ0</span><span class="c">#(10,28)</span>
    <span class="c">#COMMON/CALCAS1E/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]</span>
    <span class="c">#COMMON/GENE1/</span>
    <span class="k">global</span> <span class="n">IONF1</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTF1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">X1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T1</span><span class="c">#(10,28)</span>


    <span class="c"># COMMON/GEN121/X21(10,28),Y21(10,28),Z21(10,28),T21(10,28)</span>
    <span class="c"># COMMON/GEN111/X11(10,28),Y11(10,28),Z11(10,28),T11(10,28)</span>
    <span class="c"># #   COMMON/GEN121/</span>
    <span class="k">global</span> <span class="n">X21</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y21</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z21</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T21</span><span class="c">#(10,28)</span>
    <span class="c">#    COMMON/GEN111/</span>
    <span class="k">global</span> <span class="n">X11</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y11</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z11</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T11</span><span class="c">#(10,28)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">L1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c"># ZERO COUNTER</span>
        <span class="n">IONF2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">28</span><span class="p">):</span>
            <span class="n">ESTF2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">return</span>
    <span class="c"># endif</span>
    <span class="c"># STORE EVENT DATA FOR SECOND GENERATION FLUORESCENCE</span>
    <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' WARNING SECOND GENERATION CONVERTED FLUORESCENCE HAS AN  EVENT WITH'</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">],</span><span class="s">' IONS.</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">' COMPTON BRANCH NO='</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
    <span class="c"># endif</span>
    <span class="c"># VEL IN METRES/PICOSECOND</span>
    <span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span>
    <span class="n">IONF2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]):</span>
        <span class="n">ESTF2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">X2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">X11</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Y2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Y11</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Z2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Z11</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">T2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">T11</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">/</span><span class="n">VV</span>
        <span class="n">X21</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">X2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Y21</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Y2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Z21</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Z2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">T21</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">T2</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRXS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRYS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRZS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
    <span class="k">return</span>
    <span class="c"># end</span>
<span class="k">def</span> <span class="nf">CSSTF3E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8 (A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8 (I-N)</span>
    <span class="c"># COMMON/CALCAS2E/IONSUM0(10),IFLSUM0(10),ESTORE0(10,28),EPHOTON0(10,28),DRXE0(10,28),DRYE0(10,28),DRZE0(10,28),DRX0(10,28),DRY0(10,28),DRZ0(10,28)</span>
    <span class="c"># COMMON/CALCAS3E/IONSUM(10),IFLSUM(10),ESTORE(10,28),EPHOTON(10,28),DRXE(10,28),DRYE(10,28),DRZE(10,28),DRX(10,28),DRY(10,28),DRZ[10,28]</span>
    <span class="c"># COMMON/GENE3/IONF3(10),ESTF3(10,15),X3(10,15),Y3(10,15),Z3(10,15),DRXS(10,15),DRYS(10,15),DRZS(10,15),T3(10,15)</span>
    <span class="c">#COMMON/CALCASE/</span>
    <span class="k">global</span> <span class="n">IONSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ0</span><span class="c">#(10,28)</span>
    <span class="c">#COMMON/CALCAS1E/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]</span>
    <span class="c">#COMMON/GENE1/</span>
    <span class="k">global</span> <span class="n">IONF1</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTF1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">X1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T1</span><span class="c">#(10,28)</span>


    <span class="c"># COMMON/GEN131/X31(10,28),Y31(10,28),Z31(10,28),T31(10,28)</span>
    <span class="c"># COMMON/GEN121/X21(10,28),Y21(10,28),Z21(10,28),T21(10,28)</span>
    <span class="c">#</span>
    <span class="k">if</span><span class="p">(</span><span class="n">L1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c"># ZERO COUNTER</span>
        <span class="n">IONF3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">):</span>
            <span class="n">ESTF3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">return</span>
    <span class="c"># endif</span>
    <span class="c"># STORE EVENT DATA FOR THIRD GENERATION FLUORESCENCE</span>
    <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' WARNING THIRD GENERATION CONVERTED FLUORESCENCE HAS AN  EVENT WITH'</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">],</span><span class="s">' IONS.'</span><span class="p">,</span><span class="s">'</span><span class="se">\n</span><span class="s"> COMPTON BRANCH NO='</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
    <span class="c"># endif</span>
    <span class="c"># VEL IN METRES/PICOSECOND</span>
    <span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span>
    <span class="n">IONF3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]):</span>
        <span class="n">ESTF3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">X3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">X21</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Z3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Y21</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Z3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Z21</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">T3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">T21</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">/</span><span class="n">VV</span>
        <span class="n">X31</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">X3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Y31</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Z3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Z31</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Z3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">T31</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">T3</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRXS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRYS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRZS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
    <span class="k">return</span>
    <span class="c"># end</span>
<span class="k">def</span> <span class="nf">CSSTF4E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8 (A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8 (I-N)</span>
    <span class="c"># COMMON/CALCAS3E/IONSUM0(10),IFLSUM0(10),ESTORE0(10,28),EPHOTON0(10,28),DRXE0(10,28),DRYE0(10,28),DRZE0(10,28),DRX0(10,28),DRY0(10,28),DRZ0(10,28)</span>
    <span class="c"># COMMON/CALCAS4E/IONSUM(10),IFLSUM(10),ESTORE(10,28),EPHOTON(10,28),DRXE(10,28),DRYE(10,28),DRZE(10,28),DRX(10,28),DRY(10,28),DRZ[10,28]</span>
    <span class="c"># COMMON/GENE4/IONF4(10),ESTF4(10,12),X4(10,12),Y4(10,12),Z4(10,12),DRXS(10,12),DRYS(10,12),DRZS(10,12),T4(10,12)</span>
    <span class="c">#COMMON/CALCASE/</span>
    <span class="k">global</span> <span class="n">IONSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ0</span><span class="c">#(10,28)</span>
    <span class="c">#COMMON/CALCAS1E/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]</span>
    <span class="c">#COMMON/GENE1/</span>
    <span class="k">global</span> <span class="n">IONF1</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTF1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">X1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T1</span><span class="c">#(10,28)</span>


    <span class="c"># COMMON/GEN131/X31(10,28),Y31(10,28),Z31(10,28),T31(10,28)</span>
    <span class="c"># COMMON/GEN141/X41(10,28),Y41(10,28),Z41(10,28),T41(10,28)</span>
    <span class="c">#</span>
    <span class="c"># #   COMMON/GEN131/</span>
    <span class="k">global</span> <span class="n">X31</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y31</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z31</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T31</span><span class="c">#(10,28)</span>
    <span class="c">#    COMMON/GEN121/</span>
    <span class="k">global</span> <span class="n">X21</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y21</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z21</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T21</span><span class="c">#(10,28)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">L1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c"># ZERO COUNTER</span>
        <span class="n">IONF4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">):</span>
            <span class="n">ESTF4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">return</span>
    <span class="c"># endif</span>
    <span class="c"># STORE EVENT DATA FOR FOURTH GENERATION FLUORESCENCE</span>
    <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' WARNING FOURTH GENERATION CONVERTED FLUORESCENCE HAS AN  EVENT WITH'</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">],</span><span class="s">' IONS.'</span><span class="p">,</span><span class="s">'</span><span class="se">\n</span><span class="s"> COMPTON BRANCH NO='</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
    <span class="c"># endif</span>
    <span class="c"># VEL IN METRES/PICOSECOND</span>
    <span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span>
    <span class="n">IONF4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="n">DO</span> <span class="mi">1</span> <span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
        <span class="n">ESTF4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">X4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">X31</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Y4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Y31</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Z4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Z31</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">T4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">T31</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">/</span><span class="n">VV</span>
        <span class="n">X41</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">X4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Y41</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Y4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Z41</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Z4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">T41</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">T4</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRXS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRYS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRZS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
    <span class="k">return</span>
    <span class="c"># end</span>
<span class="k">def</span> <span class="nf">CSSTF5E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8 (A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8 (I-N)</span>
    <span class="c"># COMMON/CALCAS4E/IONSUM0(10),IFLSUM0(10),ESTORE0(10,28),EPHOTON0(10,28),DRXE0(10,28),DRYE0(10,28),DRZE0(10,28),DRX0(10,28),DRY0(10,28),DRZ0(10,28)</span>
    <span class="c"># COMMON/CALCAS5E/IONSUM(10),IFLSUM(10),ESTORE(10,28),EPHOTON(10,28),DRXE(10,28),DRYE(10,28),DRZE(10,28),DRX(10,28),DRY(10,28),DRZ[10,28]</span>
    <span class="c"># COMMON/GENE5/IONF5(10),ESTF5(10,5),X5(10,5),Y5(10,5),Z5(10,5),DRXS(10,5),DRYS(10,5),DRZS(10,5),T5(10,5)</span>
    <span class="c">#COMMON/CALCASE/</span>
    <span class="k">global</span> <span class="n">IONSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM0</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY0</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ0</span><span class="c">#(10,28)</span>
    <span class="c">#COMMON/CALCAS1E/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]</span>
    <span class="c">#COMMON/GENE1/</span>
    <span class="k">global</span> <span class="n">IONF1</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTF1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">X1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z1</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZS</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T1</span><span class="c">#(10,28)</span>

    <span class="c"># COMMON/GEN141/X41(10,28),Y41(10,28),Z41(10,28),T41(10,28)</span>
    <span class="c"># COMMON/GEN151/X51(10,28),Y51(10,28),Z51(10,28),T51(10,28)</span>
    <span class="c">#   COMMON/GEN131/</span>
    <span class="k">global</span> <span class="n">X31</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y31</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z31</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T31</span><span class="c">#(10,28)  </span>
<span class="c">#    COMMON/GEN141/</span>
    <span class="k">global</span> <span class="n">X41</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Y41</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">Z41</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">T41</span><span class="c">#(10,28)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">L1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c"># ZERO COUNTER</span>
        <span class="n">IONF5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">ESTF5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">return</span>
    <span class="c"># endif</span>
    <span class="c"># STORE EVENT DATA FOR FIFTH GENERATION FLUORESCENCE</span>
    <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">' WARNING FifTH GENERATION CONVERTED FLUORESCENCE HAS AN  EVENT WITH'</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">],</span><span class="s">' IONS.'</span><span class="p">,</span><span class="s">'</span><span class="se">\n</span><span class="s"> COMPTON BRANCH NO='</span><span class="p">,</span><span class="n">NVAC</span><span class="p">,</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
    <span class="c"># endif</span>
    <span class="c"># VEL IN METRES/PICOSECOND</span>
    <span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span>
    <span class="n">IONF5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]):</span>
        <span class="n">ESTF5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">X5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">X41</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Y5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Y41</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">Z5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">Z41</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span>
        <span class="n">T5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">T41</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">+</span><span class="n">DIST1</span><span class="o">/</span><span class="n">VV</span>
        <span class="n">X51</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">X5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Y51</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Y5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">Z51</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">Z5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">T51</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">L1</span><span class="p">]</span><span class="o">=</span><span class="n">T5</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRXS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRYS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
        <span class="n">DRZS</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
    <span class="k">return</span>
    <span class="c"># end</span>
</code></pre><pre class="highlight fortran tab-fortran"><code><span class="w">      </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">CSSTF1E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">)</span><span class="w">           
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">H</span><span class="p">,</span><span class="n">O</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">INTEGER</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">N</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCASE</span><span class="p">/</span><span class="n">IONSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRX0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRY0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCAS1E</span><span class="p">/</span><span class="n">IONSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRX</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GENE1</span><span class="p">/</span><span class="n">IONF1</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTF1</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">X1</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y1</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z1</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRXS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T1</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN111</span><span class="p">/</span><span class="n">X11</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y11</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z11</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T11</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN101</span><span class="p">/</span><span class="n">X01</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">Y01</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">Z01</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">T01</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">L1</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ZERO</span><span class="w"> </span><span class="n">COUNTER</span><span class="w">
       </span><span class="n">IONF1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">28</span><span class="w">
   </span><span class="mi">11</span><span class="w">  </span><span class="n">ESTF1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
       </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">FIRST</span><span class="w"> </span><span class="n">GENERATION</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="ow">.GT.</span><span class="mi">28</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span><span class="w"> </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">),</span><span class="n">NVAC</span><span class="w">
  </span><span class="mi">99</span><span class="w">   </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' WARNING FIRST GENERATION CONVERTED FLUORESCENCE HAS AN
     / EVENT WITH'</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="s1">' IONS.'</span><span class="p">,</span><span class="l">/</span><span class="p">,</span><span class="s1">' COMPTON BRANCH NO='</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="l">/</span><span class="p">)</span><span class="w">
       </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">VEL</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">METRES</span><span class="p">/</span><span class="n">PICOSECOND</span><span class="w">
      </span><span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458D-4</span><span class="w">
      </span><span class="n">IONF1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="n">ESTF1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">X1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">X01</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Y1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Y01</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Z1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Z01</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">T1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">T01</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="p">/</span><span class="n">VV</span><span class="w">
      </span><span class="n">X11</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">X1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Y11</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Y1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Z11</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Z1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">T11</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">T1</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRXS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRXE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRYS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRYE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRZS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRZE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
    </span><span class="mi">1</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">END</span><span class="w">
      </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">CSSTF2E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">)</span><span class="w">               
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">H</span><span class="p">,</span><span class="n">O</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">INTEGER</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">N</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCAS1E</span><span class="p">/</span><span class="n">IONSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRX0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRY0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCAS2E</span><span class="p">/</span><span class="n">IONSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRX</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GENE2</span><span class="p">/</span><span class="n">IONF2</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTF2</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">X2</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y2</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z2</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRXS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T2</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN121</span><span class="p">/</span><span class="n">X21</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y21</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z21</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T21</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN111</span><span class="p">/</span><span class="n">X11</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y11</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z11</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T11</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">L1</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ZERO</span><span class="w"> </span><span class="n">COUNTER</span><span class="w">
       </span><span class="n">IONF2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">28</span><span class="w">
   </span><span class="mi">11</span><span class="w">  </span><span class="n">ESTF2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
       </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">SECOND</span><span class="w"> </span><span class="n">GENERATION</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="ow">.GT.</span><span class="mi">28</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span><span class="w"> </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">),</span><span class="n">NVAC</span><span class="w">
  </span><span class="mi">99</span><span class="w">   </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' WARNING SECOND GENERATION CONVERTED FLUORESCENCE HAS AN 
     / EVENT WITH'</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="s1">' IONS.'</span><span class="p">,</span><span class="l">/</span><span class="p">,</span><span class="s1">' COMPTON BRANCH NO='</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="l">/</span><span class="p">)</span><span class="w">
       </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">VEL</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">METRES</span><span class="p">/</span><span class="n">PICOSECOND</span><span class="w">
      </span><span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458D-4</span><span class="w">
      </span><span class="n">IONF2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="n">ESTF2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">X2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">X11</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Y2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Y11</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Z2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Z11</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">T2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">T11</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="p">/</span><span class="n">VV</span><span class="w">
      </span><span class="n">X21</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">X2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Y21</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Y2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Z21</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Z2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">T21</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">T2</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRXS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRXE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRYS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRYE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRZS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRZE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
    </span><span class="mi">1</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">END</span><span class="w">
      </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">CSSTF3E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">H</span><span class="p">,</span><span class="n">O</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">INTEGER</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">N</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCAS2E</span><span class="p">/</span><span class="n">IONSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRX0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRY0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCAS3E</span><span class="p">/</span><span class="n">IONSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRX</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GENE3</span><span class="p">/</span><span class="n">IONF3</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTF3</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">X3</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">Y3</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">Z3</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRXS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">DRYS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">DRZS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="n">T3</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN131</span><span class="p">/</span><span class="n">X31</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y31</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z31</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T31</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN121</span><span class="p">/</span><span class="n">X21</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y21</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z21</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T21</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">L1</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ZERO</span><span class="w"> </span><span class="n">COUNTER</span><span class="w">
       </span><span class="n">IONF3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="w">
   </span><span class="mi">11</span><span class="w">  </span><span class="n">ESTF3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
       </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">THIRD</span><span class="w"> </span><span class="n">GENERATION</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="ow">.GT.</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span><span class="w"> </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">),</span><span class="n">NVAC</span><span class="w">
  </span><span class="mi">99</span><span class="w">   </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' WARNING THIRD GENERATION CONVERTED FLUORESCENCE HAS AN 
     / EVENT WITH'</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="s1">' IONS.'</span><span class="p">,</span><span class="l">/</span><span class="p">,</span><span class="s1">' COMPTON BRANCH NO='</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="l">/</span><span class="p">)</span><span class="w">
       </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">VEL</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">METRES</span><span class="p">/</span><span class="n">PICOSECOND</span><span class="w">
      </span><span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458D-4</span><span class="w">
      </span><span class="n">IONF3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="n">ESTF3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">X3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">X21</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Y3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Y21</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Z3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Z21</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">T3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">T21</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="p">/</span><span class="n">VV</span><span class="w">
      </span><span class="n">X31</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">X3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Y31</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Y3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Z31</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Z3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">T31</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">T3</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRXS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRXE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRYS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRYE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRZS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRZE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
    </span><span class="mi">1</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">END</span><span class="w">
      </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">CSSTF4E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">H</span><span class="p">,</span><span class="n">O</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">INTEGER</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">N</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCAS3E</span><span class="p">/</span><span class="n">IONSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRX0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRY0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCAS4E</span><span class="p">/</span><span class="n">IONSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRX</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GENE4</span><span class="p">/</span><span class="n">IONF4</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTF4</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">X4</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">Y4</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">Z4</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRXS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">DRYS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">DRZS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">T4</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN131</span><span class="p">/</span><span class="n">X31</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y31</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z31</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T31</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN141</span><span class="p">/</span><span class="n">X41</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y41</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z41</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T41</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">L1</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ZERO</span><span class="w"> </span><span class="n">COUNTER</span><span class="w">
       </span><span class="n">IONF4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="w">
   </span><span class="mi">11</span><span class="w">  </span><span class="n">ESTF4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
       </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">FOURTH</span><span class="w"> </span><span class="n">GENERATION</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="ow">.GT.</span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span><span class="w"> </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">),</span><span class="n">NVAC</span><span class="w">
  </span><span class="mi">99</span><span class="w">   </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' WARNING FOURTH GENERATION CONVERTED FLUORESCENCE HAS AN 
     / EVENT WITH'</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="s1">' IONS.'</span><span class="p">,</span><span class="l">/</span><span class="p">,</span><span class="s1">' COMPTON BRANCH NO='</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="l">/</span><span class="p">)</span><span class="w">
       </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">VEL</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">METRES</span><span class="p">/</span><span class="n">PICOSECOND</span><span class="w">
      </span><span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458D-4</span><span class="w">
      </span><span class="n">IONF4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="n">ESTF4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">X4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">X31</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Y4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Y31</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Z4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Z31</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">T4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">T31</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="p">/</span><span class="n">VV</span><span class="w">
      </span><span class="n">X41</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">X4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Y41</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Y4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Z41</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Z4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">T41</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">T4</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRXS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRXE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRYS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRYE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRZS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRZE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
    </span><span class="mi">1</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">END</span><span class="w">
      </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">CSSTF5E</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">DIST1</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">H</span><span class="p">,</span><span class="n">O</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">INTEGER</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">N</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCAS4E</span><span class="p">/</span><span class="n">IONSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM0</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRX0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRY0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ0</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCAS5E</span><span class="p">/</span><span class="n">IONSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EPHOTON</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRXE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRX</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZ</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GENE5</span><span class="p">/</span><span class="n">IONF5</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTF5</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">X5</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">Y5</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">Z5</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRXS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">DRYS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">DRZS</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">T5</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN141</span><span class="p">/</span><span class="n">X41</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y41</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z41</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T41</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GEN151</span><span class="p">/</span><span class="n">X51</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Y51</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">Z51</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">T51</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">L1</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ZERO</span><span class="w"> </span><span class="n">COUNTER</span><span class="w">
       </span><span class="n">IONF5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="w">
   </span><span class="mi">11</span><span class="w">  </span><span class="n">ESTF5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
       </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">FIFTH</span><span class="w"> </span><span class="n">GENERATION</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="ow">.GT.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span><span class="w"> </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">),</span><span class="n">NVAC</span><span class="w">
  </span><span class="mi">99</span><span class="w">   </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' WARNING FIFTH GENERATION CONVERTED FLUORESCENCE HAS AN 
     / EVENT WITH'</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="s1">' IONS.'</span><span class="p">,</span><span class="l">/</span><span class="p">,</span><span class="s1">' COMPTON BRANCH NO='</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="l">/</span><span class="p">)</span><span class="w">
       </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">VEL</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">METRES</span><span class="p">/</span><span class="n">PICOSECOND</span><span class="w">
      </span><span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458D-4</span><span class="w">
      </span><span class="n">IONF5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
      </span><span class="n">ESTF5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">X5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">X41</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRX0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Y5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Y41</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRY0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">Z5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">Z41</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="o">*</span><span class="n">DRZ0</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="w">
      </span><span class="n">T5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">T41</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">+</span><span class="n">DIST1</span><span class="p">/</span><span class="n">VV</span><span class="w">
      </span><span class="n">X51</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">X5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Y51</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Y5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">Z51</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">Z5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">T51</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">L1</span><span class="p">)</span><span class="o">=</span><span class="n">T5</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRXS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRXE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRYS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRYE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="n">DRZS</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">DRZE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
    </span><span class="mi">1</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">END</span><span class="w">
</span></code></pre>