<h2 id='calcb'>CALCB()</h2>
<ul>
<li>Calculate cascade in gas <code>KGAS</code> and molecular component <code>LGAS</code> with initial energy deposit elecen and shell vacancy created at <code>ISHELL</code>.</li>
</ul>
<h3 id='arguments'>Arguments</h3>
<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NVAC</td>
<td></td>
</tr>
<tr>
<td>KGAS</td>
<td></td>
</tr>
<tr>
<td>LGAS</td>
<td></td>
</tr>
<tr>
<td>ELECEN</td>
<td></td>
</tr>
<tr>
<td>ISHELL</td>
<td></td>
</tr>
</tbody></table>
<h3 id='pseudo-code'>Pseudo-Code</h3>
<table><thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>DRX</td>
<td></td>
</tr>
<tr>
<td>DRY</td>
<td>Initial Photon Direction</td>
</tr>
<tr>
<td>DRZ</td>
<td></td>
</tr>
</tbody></table>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">numpy</span>
<span class="k">def</span> <span class="nf">CALCB</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ELECEN</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">):</span>
    <span class="c"># IMPLICIT #real*8(A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8(I-N)</span>
    <span class="c"># CHARACTER*6 SCR(17),SCR1(17)</span>
    <span class="c"># COMMON/PRIM4/MSUM1,MCOMP1,MRAYL1,MPAIR1,MPHOT1,MVAC1</span>
    <span class="c"># COMMON/GENCAS/ELEV[17,79],NSDEG(17),AA[17],BB[17],SCR,SCR1</span>
    <span class="c"># COMMON/MIXC/PRSH(6,3,17,17),ESH(6,3,17),AUG(6,3,17,17,17),RAD[6,3,17,17],PRSHBT(6,3,17),IZ[6,3],INIOCC(6,3,17),ISHLMX(6,3),AMZ[6,3]</span>
    <span class="c"># COMMON/UPD/NOCC(6,3,17),AUGR(6,3,17,17,17),RADR(6,3,17,17)</span>
    <span class="c"># COMMON/CALCASB/IONSUM(10),IFLSUM(10),ESTORE(10,28),EPHOTON(10,28),DRXE(10,28),DRYE(10,28),DRZE(10,28),DRX(10,28),DRY(10,28),DRZ[10,28]</span>
    <span class="c">#COMMON/PRIM4/</span>
    <span class="k">global</span> <span class="n">MSUM1</span><span class="p">,</span><span class="n">MCOMP1</span><span class="p">,</span><span class="n">MRAYL1</span><span class="p">,</span><span class="n">MPAIR1</span><span class="p">,</span><span class="n">MPHOT1</span><span class="p">,</span><span class="n">MVAC1</span>
    <span class="c">#COMMON/GENCAS/</span>
    <span class="k">global</span> <span class="n">ELEV</span><span class="c">#[17,79]</span>
    <span class="k">global</span> <span class="n">NSDEG</span><span class="c">#(17)</span>
    <span class="k">global</span> <span class="n">AA</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">BB</span><span class="c">#[17]</span>
    <span class="k">global</span> <span class="n">SCR</span><span class="p">,</span><span class="n">SCR1</span>
    <span class="c">#COMMON/MIXC/</span>
    <span class="k">global</span> <span class="n">PRSH</span><span class="c">#(6,3,17,17)</span>
    <span class="k">global</span> <span class="n">ESH</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUG</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RAD</span><span class="c">#[6,3,17,17]</span>
    <span class="k">global</span> <span class="n">PRSHBT</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">IZ</span><span class="c">#[6,3]</span>
    <span class="k">global</span> <span class="n">INIOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">ISHLMX</span><span class="c">#(6,3)</span>
    <span class="k">global</span> <span class="n">AMZ</span><span class="c">#[6,3]</span>
    <span class="c">#COMMON/UPD/</span>
    <span class="k">global</span> <span class="n">NOCC</span><span class="c">#(6,3,17)</span>
    <span class="k">global</span> <span class="n">AUGR</span><span class="c">#(6,3,17,17,17)</span>
    <span class="k">global</span> <span class="n">RADR</span><span class="c">#(6,3,17,17)</span>
    <span class="c">#COMMON/CALCASB/</span>
    <span class="k">global</span> <span class="n">IONSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">IFLSUM</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">ESTORE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">EPHOTON</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRXE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRYE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZE</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRX</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRY</span><span class="c">#(10,28)</span>
    <span class="k">global</span> <span class="n">DRZ</span><span class="c">#[10,28]</span>

    <span class="c">#DIMENSION </span>
    <span class="n">TEMP</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">17</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">TEMP1</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">289</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="c">#</span>
    <span class="c"># CALCULATE CASCADE IN GAS KGAS AND MOLECULAR COMPONENT LGAS</span>
    <span class="c"># WITH INTIAL ENERGY DEPOSIT ELECEN AND SHELL VACANCY CREATED AT ISHELL</span>
    <span class="c">#</span>
    <span class="c"># INITIAL PHOTON DIRECTION  DRX, DRY AND DRZ</span>
    <span class="n">DRXINIT</span><span class="o">=</span><span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">DRYINIT</span><span class="o">=</span><span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">DRZINIT</span><span class="o">=</span><span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ISHELLST</span><span class="o">=</span><span class="n">ISHELL</span>
    <span class="k">def</span> <span class="nf">GOTO100</span><span class="p">():</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELECEN</span>
        <span class="n">ISHELL</span><span class="o">=</span><span class="n">ISHELLST</span>
        <span class="n">API</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
        <span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.00</span><span class="o">*</span><span class="n">API</span>
        <span class="n">ISECOND</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">IFIRST</span><span class="o">=</span><span class="mi">0</span>
        <span class="c"># SET STARTING ARRAY NOCC EQUAL TO INIOCC</span>
        <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">INIOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="c"># PHOTONS</span>
        <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="c"># STORE INITIAL PHOTOELECTRON ENERGY AND ANGLE</span>
        <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">ELECEN</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
        <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>  
        <span class="c">#    ENTRY FOR COMPTON ELECTRON.....</span>
        <span class="k">if</span><span class="p">(</span><span class="n">NVAC</span> <span class="o">&lt;=</span> <span class="n">MCOMP1</span><span class="p">):</span>
            <span class="c">#    IF COMPTON EVENT ELECTRON ANGLE FROM COMPTON (ALREADY STORED)</span>
            <span class="k">pass</span>
            <span class="c"># endif</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># USE PHOTOELCTRON ANGULAR DISTRIBUTION</span>
            <span class="n">APE</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
            <span class="n">BPE</span><span class="o">=</span><span class="n">BB</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">]</span>
            <span class="n">ANGGEN</span><span class="p">(</span><span class="n">APE</span><span class="p">,</span><span class="n">BPE</span><span class="p">,</span><span class="n">THET</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">THET</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">THET</span><span class="o">=</span><span class="n">THET</span><span class="o">+</span><span class="n">API</span>
            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
            <span class="c"># INITIAL PHOTON DIRECTION  DRXINIT, DRYINIT AND DRZINIT</span>
            <span class="n">DRCOS</span><span class="p">(</span><span class="n">DRXINIT</span><span class="p">,</span><span class="n">DRYINIT</span><span class="p">,</span><span class="n">DRZINIT</span><span class="p">,</span><span class="n">THET</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span>
            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">DRXX</span>
            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">DRYY</span>
            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">DRZZ</span>
        <span class="k">def</span> <span class="nf">GOTO4</span><span class="p">():</span>
            <span class="c"># CHECK FOR ELECTRON SHAKEOFF</span>
            <span class="n">ICON</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">IFIRST</span><span class="o">=</span><span class="n">IFIRST</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">IFIRST</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span>
            <span class="n">SHAKE</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ELECN</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ESHK</span><span class="p">,</span><span class="n">ICON</span><span class="p">,</span><span class="n">IFIRST</span><span class="p">,</span><span class="n">JVAC</span><span class="p">)</span>
            <span class="c">#  CALCULATE ENERGY OF ELECTRON</span>
            <span class="k">if</span><span class="p">(</span><span class="n">JVAC</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">GOTO2</span><span class="p">()</span>
            <span class="k">if</span><span class="p">(</span><span class="n">IFIRST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c"># INITIAL ELECTRON + SHAKEOFF</span>
                <span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                <span class="c"># PRIMARY ELECTRON</span>
                <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELECN</span>
            <span class="c"># endif</span>
            <span class="k">if</span><span class="p">(</span><span class="n">IFIRST</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
            <span class="c"># endif</span>
            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="c"># MAXIMUM ION CHARGE STATE =28</span>
            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="p">:</span>
                <span class="c">#WRITE(6,99) IONSUM[NVAC]   #error</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' WARNING ION CHARGE LIMITED TO 28+ IN THIS VERSION'</span><span class="p">)</span> 
                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="c"># endif</span>
            <span class="c"># SHAKE ELECTRON</span>
            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ESHK</span>
            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">JVAC</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="n">GOTO100</span><span class="p">()</span>
            <span class="c"># RANDOM EMISSION DIRECTION</span>
            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">GOTO2</span><span class="p">():</span> 
                <span class="n">UPDATE</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span>
                <span class="c">#  CHOOSE FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">TSUM</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span>
                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                <span class="k">if</span><span class="p">(</span><span class="n">TSUM</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="k">return</span>  
                <span class="c"># NORMALISE TO 1.0</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">/</span><span class="n">TSUM</span>
                <span class="c"># CREATE CUMULATIVE SUM ARRAY</span>
                <span class="n">TEMP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">RADR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">TEMP1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)]</span><span class="o">=</span><span class="n">AUGR</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">][</span><span class="n">I</span><span class="p">][(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c"># FIND FLUORESCENCE OR AUGER TRANSITION</span>
                <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]):</span>
                        <span class="c"># STORE PHOTON ENERGY AND ANGLE : UPDATE NOCC</span>
                        <span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span>
                        <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">EPHOTON</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]])</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                            <span class="n">GOTO100</span><span class="p">()</span>
                        <span class="c"># RANDOM EMISSION DIRECTION</span>
                        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
                        <span class="c"># CALC DIRECTION COSINES OF FLUORESCENCE</span>
                        <span class="n">DRX</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRY</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                        <span class="n">DRZ</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IFLSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                        <span class="c">#   </span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                        <span class="c"># FIND LOWEST VACANCY</span>
                        <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                            <span class="k">return</span>    
                        <span class="c"># endif</span>
                        <span class="n">GOTO2</span><span class="p">()</span>
                    <span class="c"># endif </span>
            <span class="n">GOTO2</span><span class="p">()</span>
            <span class="n">flag116</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">while</span><span class="p">(</span><span class="n">flag116</span><span class="p">):</span>
                <span class="n">flag116</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">R2</span><span class="o">=</span><span class="n">R1</span><span class="o">-</span><span class="n">TEMP</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">flag116</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">R2</span> <span class="o">&lt;</span> <span class="n">TEMP1</span><span class="p">[</span><span class="n">I</span><span class="o">+</span><span class="p">((</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">17</span><span class="p">)])</span> <span class="p">:</span>
                            <span class="c"># AUGER OR COSTER KRONIG  </span>
                            <span class="c"># STORE EJECTED ELECTRON AND UPDATE NOCC</span>
                            <span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">[</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">I</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]]</span><span class="o">+</span><span class="n">ELEV</span><span class="p">[</span><span class="n">J</span><span class="p">,</span><span class="n">IZ</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ETEMP</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="c"># DO NOT ALLOW NEGATIVE ENERGY TRANSITIONS</span>
                                <span class="n">flag117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">while</span> <span class="p">(</span><span class="n">flag117</span><span class="p">):</span>
                                    <span class="n">flag117</span><span class="o">=</span><span class="mi">0</span>
                                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="n">TEMP</span><span class="p">(</span><span class="mi">17</span><span class="p">)):</span>
                                        <span class="n">flag117</span><span class="o">=</span><span class="mi">1</span>
                                <span class="n">flag116</span><span class="o">=</span><span class="mi">1</span>
                                <span class="k">break</span>
                            <span class="c"># endif</span>
                            <span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">28</span><span class="p">):</span> 
                                <span class="k">print</span><span class="p">(</span><span class="s">' IONSUM LIMITED TO 28 IN THIS VERSION IONSUM='</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">],</span><span class="s">' IN CALCB'</span><span class="p">)</span>
                                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                            <span class="c"># endif</span>
                            <span class="n">ESTORE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">ETEMP</span>
                            <span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">ETEMP</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ELEFT</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                                <span class="n">GOTO100</span><span class="p">()</span>
                            <span class="c"># RANDOM EMISSION DIRECTION</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THET</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span>
                            <span class="n">DRXE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRYE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span>
                            <span class="n">DRZE</span><span class="p">[</span><span class="n">NVAC</span><span class="p">][</span><span class="n">IONSUM</span><span class="p">[</span><span class="n">NVAC</span><span class="p">]]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">ISHELL</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">I</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">=</span><span class="n">NOCC</span><span class="p">[</span><span class="n">KGAS</span><span class="p">][</span><span class="n">LGAS</span><span class="p">][</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                            <span class="c"># FIND LOWEST VACANCY</span>
                            <span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">ILAST</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                                <span class="c"># NO MORE TRANSITIONS POSSIBLE</span>
                                <span class="k">return</span>
                            <span class="c"># endif</span>
                            <span class="n">GOTO4</span><span class="p">()</span>
        <span class="n">GOTO4</span><span class="p">()</span>             <span class="c"># endif</span>
    <span class="n">GOTO100</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' ERROR IN CASCADE 0 def CALCB'</span><span class="p">)</span> 
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span> 
    <span class="c"># end</span>
</code></pre><pre class="highlight fortran tab-fortran"><code><span class="w">      </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">CALCB</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ELECEN</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">H</span><span class="p">,</span><span class="n">O</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">INTEGER</span><span class="o">*</span><span class="mi">8</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">N</span><span class="p">)</span><span class="w">
      </span><span class="kt">CHARACTER</span><span class="o">*</span><span class="mi">6</span><span class="w"> </span><span class="n">SCR</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span><span class="n">SCR1</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">PRIM4</span><span class="p">/</span><span class="n">MSUM1</span><span class="p">,</span><span class="n">MCOMP1</span><span class="p">,</span><span class="n">MRAYL1</span><span class="p">,</span><span class="n">MPAIR1</span><span class="p">,</span><span class="n">MPHOT1</span><span class="p">,</span><span class="n">MVAC1</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">GENCAS</span><span class="p">/</span><span class="n">ELEV</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">79</span><span class="p">),</span><span class="n">NSDEG</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span><span class="n">AA</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span><span class="n">BB</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span><span class="n">SCR</span><span class="p">,</span><span class="n">SCR1</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">MIXC</span><span class="p">/</span><span class="n">PRSH</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span><span class="n">ESH</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span><span class="n">AUG</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">RAD</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span><span class="n">PRSHBT</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span><span class="n">IZ</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">INIOCC</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span><span class="n">ISHLMX</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">AMZ</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">UPD</span><span class="p">/</span><span class="n">NOCC</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span><span class="n">AUGR</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span><span class="n">RADR</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">CALCASB</span><span class="p">/</span><span class="n">IONSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">IFLSUM</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">ESTORE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">EPHOTON</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRXE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRYE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRZE</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRX</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="n">DRY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">DRZ</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w">
      </span><span class="k">DIMENSION</span><span class="w"> </span><span class="n">TEMP</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span><span class="n">TEMP1</span><span class="p">(</span><span class="mi">289</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">CASCADE</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">GAS</span><span class="w"> </span><span class="n">KGAS</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">MOLECULAR</span><span class="w"> </span><span class="n">COMPONENT</span><span class="w"> </span><span class="n">LGAS</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">WITH</span><span class="w"> </span><span class="n">INTIAL</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">DEPOSIT</span><span class="w"> </span><span class="n">ELECEN</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">SHELL</span><span class="w"> </span><span class="n">VACANCY</span><span class="w"> </span><span class="n">CREATED</span><span class="w"> </span><span class="n">AT</span><span class="w"> </span><span class="n">ISHELL</span><span class="w">
</span><span class="n">C</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">INITIAL</span><span class="w"> </span><span class="n">PHOTON</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w">  </span><span class="n">DRX</span><span class="p">,</span><span class="w"> </span><span class="n">DRY</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">DRZ</span><span class="w">
      </span><span class="n">DRXINIT</span><span class="o">=</span><span class="n">DRXE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">DRYINIT</span><span class="o">=</span><span class="n">DRYE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">DRZINIT</span><span class="o">=</span><span class="n">DRZE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">ISHELLST</span><span class="o">=</span><span class="n">ISHELL</span><span class="w">
  </span><span class="mi">100</span><span class="w"> </span><span class="n">ELEFT</span><span class="o">=</span><span class="n">ELECEN</span><span class="w">
      </span><span class="n">ISHELL</span><span class="o">=</span><span class="n">ISHELLST</span><span class="w">
      </span><span class="n">API</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">-1.0D0</span><span class="p">)</span><span class="w">
      </span><span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">API</span><span class="w">
      </span><span class="n">ISECOND</span><span class="o">=</span><span class="mi">1</span><span class="w">
      </span><span class="n">IFIRST</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">SET</span><span class="w"> </span><span class="n">STARTING</span><span class="w"> </span><span class="n">ARRAY</span><span class="w"> </span><span class="n">NOCC</span><span class="w"> </span><span class="n">EQUAL</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">INIOCC</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">INIOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="w">
    </span><span class="mi">1</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">PHOTONS</span><span class="w">
      </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span><span class="w">
      </span><span class="n">IFLSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">INITIAL</span><span class="w"> </span><span class="n">PHOTOELECTRON</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">ANGLE</span><span class="w">
      </span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">ELECEN</span><span class="o">-</span><span class="n">ELEV</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">))</span><span class="w">
      </span><span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span><span class="o">=</span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span><span class="mi">-1</span><span class="w">  
</span><span class="n">C</span><span class="w">    </span><span class="k">ENTRY</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">COMPTON</span><span class="w"> </span><span class="n">ELECTRON</span><span class="err">.....</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">NVAC</span><span class="ow">.LE.</span><span class="n">MCOMP1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="n">COMPTON</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">ANGLE</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">COMPTON</span><span class="w"> </span><span class="p">(</span><span class="n">ALREADY</span><span class="w"> </span><span class="n">STORED</span><span class="p">)</span><span class="w">
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">4</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="k">USE</span><span class="w"> </span><span class="n">PHOTOELCTRON</span><span class="w"> </span><span class="n">ANGULAR</span><span class="w"> </span><span class="n">DISTRIBUTION</span><span class="w">
      </span><span class="n">APE</span><span class="o">=</span><span class="n">AA</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">)</span><span class="w">
      </span><span class="n">BPE</span><span class="o">=</span><span class="n">BB</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">)</span><span class="w">
      </span><span class="k">CALL</span><span class="w"> </span><span class="n">ANGGEN</span><span class="p">(</span><span class="n">APE</span><span class="p">,</span><span class="n">BPE</span><span class="p">,</span><span class="n">THET</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">THET</span><span class="ow">.LT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="n">THET</span><span class="o">=</span><span class="n">THET</span><span class="o">+</span><span class="n">API</span><span class="w">
      </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">INITIAL</span><span class="w"> </span><span class="n">PHOTON</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w">  </span><span class="n">DRXINIT</span><span class="p">,</span><span class="w"> </span><span class="n">DRYINIT</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">DRZINIT</span><span class="w">
      </span><span class="k">CALL</span><span class="w"> </span><span class="n">DRCOS</span><span class="p">(</span><span class="n">DRXINIT</span><span class="p">,</span><span class="n">DRYINIT</span><span class="p">,</span><span class="n">DRZINIT</span><span class="p">,</span><span class="n">THET</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span><span class="w">
      </span><span class="n">DRXE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">DRXX</span><span class="w">
      </span><span class="n">DRYE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">DRYY</span><span class="w">
      </span><span class="n">DRZE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">DRZZ</span><span class="w">
    </span><span class="mi">4</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CHECK</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">SHAKEOFF</span><span class="w">
      </span><span class="n">ICON</span><span class="o">=</span><span class="mi">1</span><span class="w">
      </span><span class="n">IFIRST</span><span class="o">=</span><span class="n">IFIRST</span><span class="mi">+1</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IFIRST</span><span class="ow">.GT.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">ELECN</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="w">
      </span><span class="k">CALL</span><span class="w"> </span><span class="n">SHAKE</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ELECN</span><span class="p">,</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ESHK</span><span class="p">,</span><span class="n">ICON</span><span class="p">,</span><span class="n">IFIRST</span><span class="p">,</span><span class="n">JVAC</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">  </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">JVAC</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">2</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IFIRST</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">INITIAL</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SHAKEOFF</span><span class="w">
       </span><span class="n">ELECN</span><span class="o">=</span><span class="n">ELECN</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">(</span><span class="n">JVAC</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">))</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">PRIMARY</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w">
       </span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">ELECN</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IFIRST</span><span class="ow">.NE.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="w">
     </span><span class="p">/</span><span class="n">ELEV</span><span class="p">(</span><span class="n">JVAC</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">))</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
      </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="mi">+1</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">MAXIMUM</span><span class="w"> </span><span class="n">ION</span><span class="w"> </span><span class="n">CHARGE</span><span class="w"> </span><span class="n">STATE</span><span class="w"> </span><span class="o">=</span><span class="mi">28</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="ow">.GT.</span><span class="mi">28</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span><span class="w"> </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w"> 
   </span><span class="mi">99</span><span class="w">  </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' WARNING ION CHARGE LIMITED TO 28+ IN THIS VERSION'</span><span class="p">)</span><span class="w"> 
       </span><span class="k">STOP</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">SHAKE</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w">
      </span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">ESHK</span><span class="w">
      </span><span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">ESHK</span><span class="o">-</span><span class="n">ELEV</span><span class="p">(</span><span class="n">JVAC</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">))</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">ELEFT</span><span class="ow">.LT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">100</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RANDOM</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w">
      </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="n">THET</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span><span class="w">
      </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span><span class="w">
      </span><span class="n">DRXE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span><span class="w">
      </span><span class="n">DRYE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span><span class="w">
      </span><span class="n">DRZE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="w">
    </span><span class="mi">2</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">                                     
      </span><span class="k">CALL</span><span class="w"> </span><span class="n">UPDATE</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">  </span><span class="n">CHOOSE</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">AUGER</span><span class="w"> </span><span class="n">TRANSITION</span><span class="w">
      </span><span class="n">TSUM</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">RADR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="n">TSUM</span><span class="o">=</span><span class="n">TSUM</span><span class="o">+</span><span class="n">AUGR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w">
   </span><span class="mi">10</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">NO</span><span class="w"> </span><span class="n">MORE</span><span class="w"> </span><span class="n">TRANSITIONS</span><span class="w"> </span><span class="n">POSSIBLE</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">TSUM</span><span class="ow">.EQ.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w">  
</span><span class="n">C</span><span class="w"> </span><span class="n">NORMALISE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mf">1.0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="n">RADR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">RADR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">I</span><span class="p">)/</span><span class="n">TSUM</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="n">AUGR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">AUGR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">)/</span><span class="n">TSUM</span><span class="w">
   </span><span class="mi">11</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CREATE</span><span class="w"> </span><span class="n">CUMULATIVE</span><span class="w"> </span><span class="nb">SUM</span><span class="w"> </span><span class="n">ARRAY</span><span class="w">
      </span><span class="n">TEMP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">RADR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="n">TEMP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">RADR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">+</span><span class="n">TEMP</span><span class="p">(</span><span class="n">I</span><span class="mi">-1</span><span class="p">)</span><span class="w">
   </span><span class="mi">12</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="n">TEMP1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="n">AUGR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="n">TEMP1</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">AUGR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">(</span><span class="n">I</span><span class="mi">-1</span><span class="p">)</span><span class="w">
   </span><span class="mi">13</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">16</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="n">TEMP1</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">))</span><span class="o">=</span><span class="n">AUGR</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">I</span><span class="p">,(</span><span class="n">J</span><span class="mi">+1</span><span class="p">))</span><span class="o">+</span><span class="n">TEMP1</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="p">(</span><span class="n">J</span><span class="o">*</span><span class="mi">17</span><span class="p">)</span><span class="mi">-1</span><span class="p">)</span><span class="w">
   </span><span class="mi">14</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FIND</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">AUGER</span><span class="w"> </span><span class="n">TRANSITION</span><span class="w">
      </span><span class="n">R1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">R1</span><span class="ow">.LT.</span><span class="n">TEMP</span><span class="p">(</span><span class="n">I</span><span class="p">))</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">PHOTON</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">ANGLE</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">NOCC</span><span class="w">
       </span><span class="n">IFLSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="n">IFLSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="mi">+1</span><span class="w">
       </span><span class="n">EPHOTON</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IFLSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">ELEV</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">))</span><span class="o">-</span><span class="w">
     </span><span class="p">/</span><span class="n">ELEV</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">))</span><span class="w">
       </span><span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">DABS</span><span class="p">(</span><span class="n">EPHOTON</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IFLSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)))</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">ELEFT</span><span class="ow">.LT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">100</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RANDOM</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w">
       </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">THET</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span><span class="w">
       </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALC</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w"> </span><span class="n">COSINES</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
       </span><span class="n">DRX</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IFLSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span><span class="w">
       </span><span class="n">DRY</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IFLSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span><span class="w">
       </span><span class="n">DRZ</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IFLSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w">   
       </span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span><span class="o">=</span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span><span class="mi">+1</span><span class="w">
       </span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="mi">-1</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FIND</span><span class="w"> </span><span class="n">LOWEST</span><span class="w"> </span><span class="n">VACANCY</span><span class="w">
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">ILAST</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">NO</span><span class="w"> </span><span class="n">MORE</span><span class="w"> </span><span class="n">TRANSITIONS</span><span class="w"> </span><span class="n">POSSIBLE</span><span class="w">
        </span><span class="k">RETURN</span><span class="w">    
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">2</span><span class="w">  
      </span><span class="k">ENDIF</span><span class="w"> 
   </span><span class="mi">16</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
  </span><span class="mi">116</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="n">R2</span><span class="o">=</span><span class="n">R1</span><span class="o">-</span><span class="n">TEMP</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">R2</span><span class="ow">.LT.</span><span class="n">TEMP1</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="p">((</span><span class="n">J</span><span class="mi">-1</span><span class="p">)</span><span class="o">*</span><span class="mi">17</span><span class="p">)))</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">AUGER</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">COSTER</span><span class="w"> </span><span class="n">KRONIG</span><span class="w">  
</span><span class="n">C</span><span class="w"> </span><span class="n">STORE</span><span class="w"> </span><span class="n">EJECTED</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">NOCC</span><span class="w">
       </span><span class="n">ETEMP</span><span class="o">=</span><span class="n">ELEV</span><span class="p">(</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">))</span><span class="o">-</span><span class="p">(</span><span class="n">ELEV</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">))</span><span class="o">+</span><span class="w">
     </span><span class="p">/</span><span class="n">ELEV</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">)</span><span class="mi">+1</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="w">
     </span><span class="p">/(</span><span class="n">ELEV</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">))</span><span class="o">+</span><span class="n">ELEV</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">IZ</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">)</span><span class="mi">+1</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">ETEMP</span><span class="ow">.LT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="nb">NOT</span><span class="w"> </span><span class="n">ALLOW</span><span class="w"> </span><span class="n">NEGATIVE</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">TRANSITIONS</span><span class="w">
  </span><span class="mi">117</span><span class="w">   </span><span class="n">R1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">R1</span><span class="ow">.LT.</span><span class="n">TEMP</span><span class="p">(</span><span class="mi">17</span><span class="p">))</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">117</span><span class="w">
        </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">116</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="o">=</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="mi">+1</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="ow">.GT.</span><span class="mi">28</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> 
        </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">887</span><span class="p">)</span><span class="w"> </span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">)</span><span class="w">
  </span><span class="mi">887</span><span class="w">   </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' IONSUM LIMITED TO 28 IN THIS VERSION IONSUM='</span><span class="p">,</span><span class="l">I3</span><span class="p">,</span><span class="w">
     </span><span class="l">/</span><span class="s1">' IN CALCB'</span><span class="p">)</span><span class="w">
        </span><span class="k">STOP</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="n">ESTORE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">ETEMP</span><span class="w">
       </span><span class="n">ELEFT</span><span class="o">=</span><span class="n">ELEFT</span><span class="o">-</span><span class="n">DABS</span><span class="p">(</span><span class="n">ETEMP</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">ELEFT</span><span class="ow">.LT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">100</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RANDOM</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w">
       </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">THET</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span><span class="w">
       </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">PHI</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R3</span><span class="w">
       </span><span class="n">DRXE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span><span class="w">
       </span><span class="n">DRYE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHI</span><span class="p">)</span><span class="w">
       </span><span class="n">DRZE</span><span class="p">(</span><span class="n">NVAC</span><span class="p">,</span><span class="n">IONSUM</span><span class="p">(</span><span class="n">NVAC</span><span class="p">))</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THET</span><span class="p">)</span><span class="w">
       </span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span><span class="o">=</span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">)</span><span class="mi">+1</span><span class="w">
       </span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="mi">-1</span><span class="w">
       </span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">=</span><span class="n">NOCC</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="mi">-1</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FIND</span><span class="w"> </span><span class="n">LOWEST</span><span class="w"> </span><span class="n">VACANCY</span><span class="w">
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">VACANCY</span><span class="p">(</span><span class="n">KGAS</span><span class="p">,</span><span class="n">LGAS</span><span class="p">,</span><span class="n">ISHELL</span><span class="p">,</span><span class="n">ILAST</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">ILAST</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">NO</span><span class="w"> </span><span class="n">MORE</span><span class="w"> </span><span class="n">TRANSITIONS</span><span class="w"> </span><span class="n">POSSIBLE</span><span class="w">
        </span><span class="k">RETURN</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">4</span><span class="w"> 
      </span><span class="k">ENDIF</span><span class="w">
   </span><span class="mi">27</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">88</span><span class="p">)</span><span class="w"> 
   </span><span class="mi">88</span><span class="w"> </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' ERROR IN CASCADE 0 SUBROUTINE CALCB'</span><span class="p">)</span><span class="w"> 
      </span><span class="k">STOP</span><span class="w"> 
      </span><span class="k">END</span><span class="w">

</span></code></pre>