<h2 id='mipcalc'>MIPCALC()</h2>
<ul>
<li>Calculates dE/dX and distance between primary clusters </li>
<li>Calculates primary electron energy and vacancy for input to thermalisation.</li>
<li>Adds excitation clusters with positive Penning fractions.</li>
<li>For Bremsstrahlung finds average energy loss over 10,000 events.</li>
<li>Calculates average elastic energy loss over <code>NE</code> events using anisotropic scattering.</li>
</ul>
<h3 id='arguments'>Arguments</h3>
<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>NONE</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<pre class="highlight fortran tab-fortran"><code><span class="w">      </span><span class="k">SUBROUTINE</span><span class="w"> </span><span class="n">MIPCALC</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">H</span><span class="p">,</span><span class="n">O</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="w">
      </span><span class="k">IMPLICIT</span><span class="w"> </span><span class="kt">INTEGER</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">N</span><span class="p">)</span><span class="w">                                         
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">INPT</span><span class="p">/</span><span class="n">NGAS</span><span class="p">,</span><span class="n">NSTEP</span><span class="p">,</span><span class="n">NANISO</span><span class="p">,</span><span class="n">EFINAL</span><span class="p">,</span><span class="n">ESTEP</span><span class="p">,</span><span class="n">AKT</span><span class="p">,</span><span class="n">ARY</span><span class="p">,</span><span class="n">TEMPC</span><span class="p">,</span><span class="n">TORR</span><span class="p">,</span><span class="n">IPEN</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">SETP</span><span class="p">/</span><span class="n">TMAX</span><span class="p">,</span><span class="n">SMALL</span><span class="p">,</span><span class="n">API</span><span class="p">,</span><span class="n">ESTART</span><span class="p">,</span><span class="n">THETA</span><span class="p">,</span><span class="n">PHI</span><span class="p">,</span><span class="n">TCFMAX</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">TCFMAX1</span><span class="p">,</span><span class="w">
     </span><span class="p">/</span><span class="n">RSTART</span><span class="p">,</span><span class="n">EFIELD</span><span class="p">,</span><span class="n">ETHRM</span><span class="p">,</span><span class="n">ECUT</span><span class="p">,</span><span class="n">NEVENT</span><span class="p">,</span><span class="n">IMIP</span><span class="p">,</span><span class="n">IWRITE</span><span class="w">  
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">SET2</span><span class="p">/</span><span class="n">DRXINIT</span><span class="p">,</span><span class="n">DRYINIT</span><span class="p">,</span><span class="n">DRZINIT</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">LARGE</span><span class="p">/</span><span class="n">CF</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span><span class="n">EIN</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">TCF</span><span class="p">(</span><span class="mi">20000</span><span class="p">),</span><span class="n">IARRY</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">RGAS</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">IPN</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">WPL</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">IZBR</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">IPLAST</span><span class="p">,</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">512</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">ANIS</span><span class="p">/</span><span class="n">PSCT</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span><span class="n">ANGCT</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="mi">512</span><span class="p">),</span><span class="nb">INDEX</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">NISO</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">RLTVY</span><span class="p">/</span><span class="n">BET</span><span class="p">(</span><span class="mi">20000</span><span class="p">),</span><span class="n">GAM</span><span class="p">(</span><span class="mi">20000</span><span class="p">),</span><span class="n">VC</span><span class="p">,</span><span class="n">EMS</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">MIPCLC</span><span class="p">/</span><span class="n">ANPRELA</span><span class="p">,</span><span class="n">ANPRATT</span><span class="p">,</span><span class="n">ANPREXC</span><span class="p">,</span><span class="n">ANPRION</span><span class="p">,</span><span class="n">ANPREXCI</span><span class="p">,</span><span class="n">ANPRBRM</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">DEDX</span><span class="p">/</span><span class="n">ELOSS</span><span class="p">,</span><span class="n">ELOSEX</span><span class="p">,</span><span class="n">ELOSION</span><span class="p">,</span><span class="n">ESUM</span><span class="p">,</span><span class="n">BETAGAM</span><span class="p">,</span><span class="n">TCFHIGH</span><span class="p">,</span><span class="n">VELC</span><span class="p">,</span><span class="w">
     </span><span class="p">/</span><span class="n">EMAXDEL</span><span class="p">,</span><span class="n">ELOSIONC</span><span class="p">,</span><span class="n">CUTIONFRC</span><span class="p">,</span><span class="n">ELOSEXI</span><span class="p">,</span><span class="n">ELOSBREM</span><span class="p">,</span><span class="n">NREJECT</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">COMP</span><span class="p">/</span><span class="n">LCMP</span><span class="p">,</span><span class="n">LCFLG</span><span class="p">,</span><span class="n">LRAY</span><span class="p">,</span><span class="n">LRFLG</span><span class="p">,</span><span class="n">LPAP</span><span class="p">,</span><span class="n">LPFLG</span><span class="p">,</span><span class="n">LBRM</span><span class="p">,</span><span class="n">LBFLG</span><span class="p">,</span><span class="n">LPEFLG</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">MIPOUT</span><span class="p">/</span><span class="n">ENM</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">XS</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">YS</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">ZS</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">DIRX</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">DIRY</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">DIRZ</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">TS</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">IEVENT</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">IONFL</span><span class="p">/</span><span class="n">NC0</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">EC0</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">NG1</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">EG1</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">NG2</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="w">
     </span><span class="p">/</span><span class="n">EG2</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">WKLM</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">DSTFL</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span><span class="w">
      </span><span class="k">COMMON</span><span class="p">/</span><span class="n">IONMOD</span><span class="p">/</span><span class="n">ESPLIT</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">IONMODEL</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span><span class="w"> 
      </span><span class="k">DIMENSION</span><span class="w"> </span><span class="n">CFTEMP</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">PSTEMP</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span><span class="n">ANTEMP</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">DE</span><span class="p">/</span><span class="n">DX</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">DISTANCE</span><span class="w"> </span><span class="n">BETWEEN</span><span class="w"> </span><span class="n">PRIMARY</span><span class="w"> </span><span class="n">CLUSTERS</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">ALSO</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">PRIMARY</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">VACANCY</span><span class="w"> </span><span class="n">FOR</span><span class="w"> </span><span class="n">INPUT</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">THERMALISATION</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ALSO</span><span class="w"> </span><span class="n">ADDS</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w"> </span><span class="n">CLUSTERS</span><span class="w"> </span><span class="n">WHICH</span><span class="w"> </span><span class="n">HAVE</span><span class="w"> </span><span class="n">PENNING</span><span class="w"> </span><span class="n">FRACTIONS</span><span class="w"> </span><span class="n">GT</span><span class="w"> </span><span class="mf">0.0</span><span class="w">
</span><span class="n">C</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="k">USE</span><span class="w"> </span><span class="n">VELOCITY</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">METRES</span><span class="p">/</span><span class="n">PICOSECOND</span><span class="w">
      </span><span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458D-4</span><span class="w"> 
</span><span class="n">C</span><span class="w"> </span><span class="n">MAXIMUM</span><span class="w"> </span><span class="n">DELTA</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">ALLOWED</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="n">OUTPUT</span><span class="w"> </span><span class="n">SECTION</span><span class="o">=</span><span class="w"> </span><span class="n">EMAXDEL</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">NOTE</span><span class="w"> </span><span class="n">NO</span><span class="w"> </span><span class="n">LIMIT</span><span class="w"> </span><span class="n">ON</span><span class="w"> </span><span class="n">GLOBAL</span><span class="w"> </span><span class="n">DE</span><span class="p">/</span><span class="n">DX</span><span class="w"> </span><span class="n">CALCULATION</span><span class="w">
</span><span class="n">C</span><span class="w">
      </span><span class="n">EMAXDEL</span><span class="o">=</span><span class="n">ECUT</span><span class="w">      
      </span><span class="n">NREJECT</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NCUT</span><span class="o">=</span><span class="mi">0</span><span class="w">
      </span><span class="n">NCUTT</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="n">C</span><span class="w">
      </span><span class="n">IEVMAX</span><span class="o">=</span><span class="mi">100000</span><span class="w">  
      </span><span class="n">NPMAX</span><span class="o">=</span><span class="mi">0</span><span class="w">    
      </span><span class="n">API</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">-1.0D0</span><span class="p">)</span><span class="w">
      </span><span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">API</span><span class="w">
      </span><span class="n">ANPRELA</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ANPRATT</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ANPREXC</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ANPREXCI</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ANPRION</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ANPRBRM</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ELOSS</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ELOSEX</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ELOSEXI</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ELOSION</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ELOSIONC</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="n">ELOSBREM</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IPLAST</span><span class="w">
      </span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">CF</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="n">PSTEMP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">PSCT</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="n">ANTEMP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">=</span><span class="n">ANGCT</span><span class="p">(</span><span class="mi">20000</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="n">TCFF</span><span class="o">=</span><span class="n">TCF</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span><span class="w">
      </span><span class="n">BETA</span><span class="o">=</span><span class="n">BET</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span><span class="w">
      </span><span class="n">GAMM</span><span class="o">=</span><span class="n">GAM</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span><span class="w">
    </span><span class="mi">1</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="n">VEL</span><span class="o">=</span><span class="n">BETA</span><span class="o">*</span><span class="n">VC</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IPLAST</span><span class="w">
      </span><span class="n">IA</span><span class="o">=</span><span class="n">IARRY</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">4.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.5</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">9.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.10</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">14.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="err">.</span><span class="w">
     </span><span class="p">/</span><span class="mf">15.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.19</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">20.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.24</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">25.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.29</span><span class="ow">.OR.</span><span class="w">
     </span><span class="p">/</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">BREMSSTRAHLUNG</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">SUPERELASTIC</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">J</span><span class="ow">.NE.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="mi">-1</span><span class="p">))</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">J</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CHECK</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="n">BREMSSTRAHLUNG</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">LBRM</span><span class="ow">.EQ.</span><span class="mf">1.</span><span class="n">AND</span><span class="err">.</span><span class="n">IZBR</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="ow">.NE.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">BREMSSTRAHLUNG</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FIND</span><span class="w"> </span><span class="n">AVERAGE</span><span class="w"> </span><span class="n">BREMSSTRAHLUNG</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">LOSS</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="n">EVENTS</span><span class="w">
        </span><span class="n">IATOMNO</span><span class="o">=</span><span class="n">IZBR</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
        </span><span class="n">E</span><span class="o">=</span><span class="n">ESTART</span><span class="w">
        </span><span class="n">ESUMBR</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
        </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">997</span><span class="p">)</span><span class="w"> </span><span class="n">E</span><span class="w">
  </span><span class="mi">997</span><span class="w">   </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' ENERGY='</span><span class="p">,</span><span class="l">D12.4</span><span class="p">)</span><span class="w">
        </span><span class="k">DO</span><span class="w"> </span><span class="mi">111</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="w">
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">BREMS</span><span class="p">(</span><span class="n">IATOMNO</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">DCX2</span><span class="p">,</span><span class="n">DCY2</span><span class="p">,</span><span class="n">DCZ2</span><span class="p">,</span><span class="n">EOUT</span><span class="p">,</span><span class="n">EDCX</span><span class="p">,</span><span class="n">EDCY</span><span class="p">,</span><span class="n">EDCZ</span><span class="p">,</span><span class="w">
     </span><span class="p">/</span><span class="n">EGAMMA</span><span class="p">,</span><span class="n">GDCX</span><span class="p">,</span><span class="n">GDCY</span><span class="p">,</span><span class="n">GDCZ</span><span class="p">)</span><span class="w">
        </span><span class="n">ESUMBR</span><span class="o">=</span><span class="n">ESUMBR</span><span class="o">+</span><span class="n">EGAMMA</span><span class="w">
  </span><span class="mi">111</span><span class="w">   </span><span class="k">CONTINUE</span><span class="w">
        </span><span class="n">ELBRM</span><span class="o">=</span><span class="n">ESUMBR</span><span class="p">/</span><span class="mf">10000.0</span><span class="w">
        </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">998</span><span class="p">)</span><span class="w"> </span><span class="n">ELBRM</span><span class="w">
  </span><span class="mi">998</span><span class="w">   </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' ELBRM='</span><span class="p">,</span><span class="l">D12.4</span><span class="p">)</span><span class="w">
        </span><span class="n">ANPRBRM</span><span class="o">=</span><span class="n">ANPRBRM</span><span class="o">+</span><span class="n">CFT</span><span class="p">/</span><span class="n">VEL</span><span class="w">
        </span><span class="n">ELOSBREM</span><span class="o">=</span><span class="n">ELOSBREM</span><span class="o">+</span><span class="n">CFT</span><span class="o">*</span><span class="n">ELBRM</span><span class="p">/</span><span class="n">VEL</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">LBRM</span><span class="ow">.EQ.</span><span class="mf">1.</span><span class="n">AND</span><span class="err">.</span><span class="n">IZBR</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="ow">.NE.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">SUPERELASTIC</span><span class="w">
        </span><span class="n">ANPREXC</span><span class="o">=</span><span class="n">ANPREXC</span><span class="o">+</span><span class="n">CFT</span><span class="p">/</span><span class="n">VEL</span><span class="w">
        </span><span class="n">ELOSEX</span><span class="o">=</span><span class="n">ELOSEX</span><span class="o">+</span><span class="n">CFT</span><span class="o">*</span><span class="n">EIN</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="n">RGAS</span><span class="p">(</span><span class="n">J</span><span class="p">)/</span><span class="n">VEL</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">IPEN</span><span class="ow">.EQ.</span><span class="mf">1.</span><span class="n">AND</span><span class="err">.</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="ow">.GT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">PENNING</span><span class="w"> </span><span class="nb">TRANSFER</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">IONISATION</span><span class="w">
         </span><span class="n">ANPREXCI</span><span class="o">=</span><span class="n">ANPREXCI</span><span class="o">+</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="n">CFT</span><span class="p">/</span><span class="n">VEL</span><span class="w">
         </span><span class="n">ELOSEXI</span><span class="o">=</span><span class="n">ELOSEXI</span><span class="o">+</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="n">CFT</span><span class="o">*</span><span class="n">EIN</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="n">RGAS</span><span class="p">(</span><span class="n">J</span><span class="p">)/</span><span class="n">VEL</span><span class="w">
        </span><span class="k">ENDIF</span><span class="w">
    </span><span class="mi">5</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">1.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.6</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">11.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.16</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">21.</span><span class="n">OR</span><span class="err">.</span><span class="w">
     </span><span class="p">/</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mi">26</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ELASTIC</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">LOSS</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">J</span><span class="ow">.NE.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="mi">-1</span><span class="p">))</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">J</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
       </span><span class="n">ANPRELA</span><span class="o">=</span><span class="n">ANPRELA</span><span class="o">+</span><span class="n">CFT</span><span class="p">/</span><span class="n">VEL</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">ELASTIC</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">LOSS</span><span class="w"> </span><span class="n">AVERAGED</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="n">NE</span><span class="w"> </span><span class="n">EVENTS</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="k">USE</span><span class="w"> </span><span class="n">ANISOTROPIC</span><span class="w"> </span><span class="n">SCATTERING</span><span class="w">
       </span><span class="n">NE</span><span class="o">=</span><span class="mi">10000</span><span class="w">
       </span><span class="n">ELAS</span><span class="o">=</span><span class="mf">0.0D0</span><span class="w">
       </span><span class="n">RFAC</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">+</span><span class="n">GAMM</span><span class="o">*</span><span class="p">(</span><span class="n">RGAS</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="mf">-1.0D0</span><span class="p">)</span><span class="w">
       </span><span class="n">RFAC</span><span class="o">=</span><span class="p">(</span><span class="n">RFAC</span><span class="mf">-1.0D0</span><span class="p">)/(</span><span class="n">RFAC</span><span class="o">*</span><span class="n">RFAC</span><span class="p">)</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NE</span><span class="w">
       </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">R31</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">R3</span><span class="o">*</span><span class="n">ANTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">R31</span><span class="ow">.GT.</span><span class="n">PSTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">))</span><span class="w"> </span><span class="n">F3</span><span class="o">=-</span><span class="n">F3</span><span class="w">
       </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">EPSI</span><span class="o">=</span><span class="n">PSTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">-</span><span class="p">(</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">EPSI</span><span class="p">)/(</span><span class="mf">1.0D0</span><span class="o">+</span><span class="n">EPSI</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="p">)))</span><span class="w">
       </span><span class="k">ELSE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ISOTROPIC</span><span class="w"> </span><span class="n">SCATTERING</span><span class="w">
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="n">ELAS</span><span class="o">=</span><span class="n">ELAS</span><span class="o">+</span><span class="p">(</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">F3</span><span class="p">)</span><span class="w">
   </span><span class="mi">66</span><span class="w">  </span><span class="k">CONTINUE</span><span class="w">
       </span><span class="n">ELOSS</span><span class="o">=</span><span class="n">CFT</span><span class="o">*</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">RFAC</span><span class="o">*</span><span class="n">EFINAL</span><span class="o">*</span><span class="n">ELAS</span><span class="p">/</span><span class="n">VEL</span><span class="w">
       </span><span class="n">ELOSS</span><span class="o">=</span><span class="n">ELOSS</span><span class="p">/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NE</span><span class="p">)</span><span class="w">
      </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">3.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.8</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">13.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.18</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">23.</span><span class="n">OR</span><span class="err">.</span><span class="w">
     </span><span class="p">/</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mi">28</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ATTACHMENT</span><span class="w">
      </span><span class="n">ANPRATT</span><span class="o">=</span><span class="n">ANPRATT</span><span class="o">+</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="mi">-1</span><span class="p">))/</span><span class="n">VEL</span><span class="w">
      </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">2.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.7</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">12.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.17</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">22.</span><span class="n">OR</span><span class="err">.</span><span class="w">
     </span><span class="p">/</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mi">27</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">IONISATION</span><span class="w">
      </span><span class="n">ANPRION</span><span class="o">=</span><span class="n">ANPRION</span><span class="o">+</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="mi">-1</span><span class="p">))/</span><span class="n">VEL</span><span class="w">
      </span><span class="k">ELSE</span><span class="w"> 
       </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">99</span><span class="p">)</span><span class="w">
   </span><span class="mi">99</span><span class="w">  </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' WARNING NO COLLISION TYPE IN SUBROUTINE MIPCALC'</span><span class="p">)</span><span class="w">    
      </span><span class="k">ENDIF</span><span class="w">
    </span><span class="mi">2</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">LOSS</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">IONISATION</span><span class="w"> </span><span class="n">AVERAGED</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="n">NEV</span><span class="w"> </span><span class="n">EVENTS</span><span class="w">
      </span><span class="n">NEV</span><span class="o">=</span><span class="mi">10000000</span><span class="w">
      </span><span class="n">ETEMP</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
      </span><span class="n">ETEMPC</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">IPLAST</span><span class="w">
      </span><span class="n">IA</span><span class="o">=</span><span class="n">IARRY</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">2.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.7</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">12.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.17</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">22.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="w">
     </span><span class="p">/</span><span class="n">EQ</span><span class="mf">.27</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">EFINAL</span><span class="ow">.LT.</span><span class="n">EIN</span><span class="p">(</span><span class="n">J</span><span class="p">))</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span><span class="n">C</span><span class="w">  </span><span class="n">NEV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">IONISATION</span><span class="w"> </span><span class="n">EVENTS</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">AVERAGE</span><span class="w">
       </span><span class="k">DO</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NEV</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">IONMODEL</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="ow">.GT.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="p">,</span><span class="n">ESEC</span><span class="p">,</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">IONISATION</span><span class="w"> </span><span class="n">COLLISION</span><span class="w"> </span><span class="n">USING</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FIVE</span><span class="w"> </span><span class="n">DIFFERENT</span><span class="w"> </span><span class="n">POSSIBLE</span><span class="w"> </span><span class="n">MODELS</span><span class="w">
         </span><span class="k">CALL</span><span class="w"> </span><span class="n">IONSPLIT</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">ESTART</span><span class="p">,</span><span class="n">EIN</span><span class="p">(</span><span class="n">J</span><span class="p">),</span><span class="n">ETEMP1</span><span class="p">)</span><span class="w">
         </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w">  </span><span class="mi">644</span><span class="w">
        </span><span class="k">ENDIF</span><span class="w">
       </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">ETEMP1</span><span class="o">=</span><span class="n">WPL</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="nb">TAN</span><span class="p">(</span><span class="n">R9</span><span class="o">*</span><span class="nb">ATAN</span><span class="p">((</span><span class="n">ESTART</span><span class="o">-</span><span class="n">EIN</span><span class="p">(</span><span class="n">J</span><span class="p">))/(</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">WPL</span><span class="p">(</span><span class="n">J</span><span class="p">))))</span><span class="w"> 
       </span><span class="n">ETEMP1</span><span class="o">=</span><span class="n">WPL</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ETEMP1</span><span class="p">/</span><span class="n">WPL</span><span class="p">(</span><span class="n">J</span><span class="p">))</span><span class="o">**</span><span class="mf">0.9524</span><span class="w">
  </span><span class="mi">644</span><span class="w">  </span><span class="k">CONTINUE</span><span class="w">    
       </span><span class="n">ETEMP</span><span class="o">=</span><span class="n">ETEMP</span><span class="o">+</span><span class="n">ETEMP1</span><span class="o">+</span><span class="n">EIN</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="n">RGAS</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
       </span><span class="n">NCUTT</span><span class="o">=</span><span class="n">NCUTT</span><span class="mi">+1</span><span class="w">
       </span><span class="k">IF</span><span class="p">((</span><span class="n">ETEMP1</span><span class="o">+</span><span class="n">EIN</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="n">RGAS</span><span class="p">(</span><span class="n">J</span><span class="p">))</span><span class="ow">.LT.</span><span class="n">EMAXDEL</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">ETEMPC</span><span class="o">=</span><span class="n">ETEMPC</span><span class="o">+</span><span class="n">ETEMP1</span><span class="o">+</span><span class="n">EIN</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">*</span><span class="n">RGAS</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
        </span><span class="n">NCUT</span><span class="o">=</span><span class="n">NCUT</span><span class="mi">+1</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
    </span><span class="mi">4</span><span class="w">  </span><span class="k">CONTINUE</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">J</span><span class="ow">.NE.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="mi">-1</span><span class="p">))</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">J</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="w">
       </span><span class="n">ETEMP</span><span class="o">=</span><span class="n">CFT</span><span class="o">*</span><span class="n">ETEMP</span><span class="p">/</span><span class="n">VEL</span><span class="w">
       </span><span class="n">ETEMPC</span><span class="o">=</span><span class="n">CFT</span><span class="o">*</span><span class="n">ETEMPC</span><span class="p">/</span><span class="n">VEL</span><span class="w">
       </span><span class="n">ETEMP</span><span class="o">=</span><span class="n">ETEMP</span><span class="p">/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NEV</span><span class="p">)</span><span class="w">
       </span><span class="n">ETEMPC</span><span class="o">=</span><span class="n">ETEMPC</span><span class="p">/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NEV</span><span class="p">)</span><span class="w">
       </span><span class="n">ELOSION</span><span class="o">=</span><span class="n">ELOSION</span><span class="o">+</span><span class="n">ETEMP</span><span class="w">
       </span><span class="n">ELOSIONC</span><span class="o">=</span><span class="n">ELOSIONC</span><span class="o">+</span><span class="n">ETEMPC</span><span class="w">
       </span><span class="k">ELSE</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
    </span><span class="mi">3</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="n">BETAGAM</span><span class="o">=</span><span class="n">BETA</span><span class="o">*</span><span class="n">GAMM</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CONVERT</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">EV</span><span class="p">/</span><span class="n">CM</span><span class="w">
      </span><span class="n">ELOSS</span><span class="o">=</span><span class="n">ELOSS</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ELOSEX</span><span class="o">=</span><span class="n">ELOSEX</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ELOSEXI</span><span class="o">=</span><span class="n">ELOSEXI</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ELOSION</span><span class="o">=</span><span class="n">ELOSION</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ELOSIONC</span><span class="o">=</span><span class="n">ELOSIONC</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ELOSBREM</span><span class="o">=</span><span class="n">ELOSBREM</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CONVERT</span><span class="w"> </span><span class="n">COLLISIONS</span><span class="p">/</span><span class="n">CM</span><span class="w">
      </span><span class="n">ANPRELA</span><span class="o">=</span><span class="n">ANPRELA</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ANPRATT</span><span class="o">=</span><span class="n">ANPRATT</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ANPREXC</span><span class="o">=</span><span class="n">ANPREXC</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ANPREXCI</span><span class="o">=</span><span class="n">ANPREXCI</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ANPRION</span><span class="o">=</span><span class="n">ANPRION</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ANPRBRM</span><span class="o">=</span><span class="n">ANPRBRM</span><span class="o">*</span><span class="mf">1.D10</span><span class="w">
      </span><span class="n">ESUM</span><span class="o">=</span><span class="n">ELOSS</span><span class="o">+</span><span class="n">ELOSEX</span><span class="o">+</span><span class="n">ELOSION</span><span class="o">+</span><span class="n">ELOSBREM</span><span class="w">
      </span><span class="n">VELC</span><span class="o">=</span><span class="n">VEL</span><span class="o">*</span><span class="mf">100.</span><span class="w">
      </span><span class="n">TCFHIGH</span><span class="o">=</span><span class="n">TCF</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span><span class="o">*</span><span class="mf">1.D12</span><span class="w">
      </span><span class="n">CUTIONFRC</span><span class="o">=</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NCUT</span><span class="p">)/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NCUTT</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w"> 
</span><span class="n">C</span><span class="w">  </span><span class="n">LOAD</span><span class="w"> </span><span class="n">EVENT</span><span class="w"> </span><span class="n">ARRAYS</span><span class="w"> </span><span class="n">WITH</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w"> </span><span class="n">COSINES</span><span class="w">
</span><span class="n">C</span><span class="w">  </span><span class="n">ADDS</span><span class="w"> </span><span class="n">ELECTRONS</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">PENNING</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="n">ALLOWED</span><span class="w">
      </span><span class="k">DO</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NEVENT</span><span class="w"> 
      </span><span class="k">IF</span><span class="p">(</span><span class="n">K</span><span class="ow">.GT.</span><span class="n">IEVMAX</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
      </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">999</span><span class="p">)</span><span class="w"> </span><span class="n">IEVMAX</span><span class="w">
  </span><span class="mi">999</span><span class="w"> </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' WARNING MAXIMUM NUMBER OF EVENTS='</span><span class="p">,</span><span class="l">I6</span><span class="p">,</span><span class="s1">' PROGRAM STOPPED'</span><span class="p">)</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
      </span><span class="n">NP</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span><span class="n">C</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">DETERMINE</span><span class="w"> </span><span class="n">COLLISION</span><span class="w"> </span><span class="k">TYPE</span><span class="w">   
</span><span class="n">C</span><span class="w">
   </span><span class="mi">10</span><span class="w"> </span><span class="n">R1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
      </span><span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="w">
   </span><span class="mi">11</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="mi">+1</span><span class="w"> 
      </span><span class="k">IF</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.LT.</span><span class="n">R1</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">11</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FIND</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">INTERACTION</span><span class="w">
      </span><span class="n">IA</span><span class="o">=</span><span class="n">IARRY</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
      </span><span class="k">IF</span><span class="p">(</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">2.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.7</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">12.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.17</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">22.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="w">
     </span><span class="p">/</span><span class="n">EQ</span><span class="mf">.27</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w">  </span><span class="n">IONISATION</span><span class="w">
</span><span class="n">C</span><span class="o">-----------------------------------------------------------------</span><span class="w">
   </span><span class="mi">12</span><span class="w">  </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">ESEC</span><span class="o">=</span><span class="n">WPL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="nb">TAN</span><span class="p">(</span><span class="n">R9</span><span class="o">*</span><span class="nb">ATAN</span><span class="p">((</span><span class="n">ESTART</span><span class="o">-</span><span class="n">EIN</span><span class="p">(</span><span class="n">I</span><span class="p">))/(</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">WPL</span><span class="p">(</span><span class="n">I</span><span class="p">))))</span><span class="w"> 
       </span><span class="n">ESEC</span><span class="o">=</span><span class="n">WPL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ESEC</span><span class="p">/</span><span class="n">WPL</span><span class="p">(</span><span class="n">I</span><span class="p">))</span><span class="o">**</span><span class="mf">0.9524</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">ESEC</span><span class="ow">.GT.</span><span class="n">EMAXDEL</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">NREJECT</span><span class="o">=</span><span class="n">NREJECT</span><span class="mi">+1</span><span class="w">
        </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">12</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">PRIMARY</span><span class="w"> </span><span class="n">SCATTERING</span><span class="w"> </span><span class="n">ANGLE</span><span class="w"> 
</span><span class="n">C</span><span class="w"> </span><span class="n">ANISOTROPIC</span><span class="w"> </span><span class="n">SCATTERING</span><span class="w">
       </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">R31</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">R3</span><span class="o">*</span><span class="n">ANTEMP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">R31</span><span class="ow">.GT.</span><span class="n">PSTEMP</span><span class="p">(</span><span class="n">I</span><span class="p">))</span><span class="w"> </span><span class="n">F3</span><span class="o">=-</span><span class="n">F3</span><span class="w">
       </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">EPSI</span><span class="o">=</span><span class="n">PSTEMP</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> 
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0</span><span class="o">-</span><span class="p">(</span><span class="mf">2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0</span><span class="o">-</span><span class="n">EPSI</span><span class="p">)/(</span><span class="mf">1.0D0</span><span class="o">+</span><span class="n">EPSI</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0D0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="p">)))</span><span class="w">
       </span><span class="k">ELSE</span><span class="w"> 
</span><span class="n">C</span><span class="w"> </span><span class="n">ISOTROPIC</span><span class="w"> </span><span class="n">SCATTERING</span><span class="w">
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="n">THETAP</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="n">F3</span><span class="p">)</span><span class="w">
       </span><span class="n">F5P</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETAP</span><span class="p">)</span><span class="w">
       </span><span class="n">GAMSEC</span><span class="o">=</span><span class="p">(</span><span class="n">EMS</span><span class="o">+</span><span class="n">ESEC</span><span class="p">)/</span><span class="n">EMS</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w"> </span><span class="n">RECOIL</span><span class="w"> </span><span class="n">ANGLE</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">FREE</span><span class="w"> </span><span class="n">KINEMATICS</span><span class="w">
       </span><span class="n">F5S</span><span class="o">=</span><span class="n">F5P</span><span class="o">*</span><span class="n">DSQRT</span><span class="p">(</span><span class="n">ESTART</span><span class="p">/</span><span class="n">ESEC</span><span class="p">)</span><span class="o">*</span><span class="n">GAMM</span><span class="p">/</span><span class="n">GAMSEC</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">F5S</span><span class="ow">.GT.</span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="n">F5S</span><span class="o">=</span><span class="mf">1.0</span><span class="w">
       </span><span class="n">THETAS</span><span class="o">=</span><span class="n">DASIN</span><span class="p">(</span><span class="n">F5S</span><span class="p">)</span><span class="w">
       </span><span class="n">R1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R1</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">NEW</span><span class="w"> </span><span class="n">DIRECTION</span><span class="w"> </span><span class="n">COSINES</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">INITIAL</span><span class="w"> </span><span class="n">VALUES</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">SCAT</span><span class="err">.</span><span class="w"> </span><span class="n">ANGLES</span><span class="w">
       </span><span class="k">CALL</span><span class="w"> </span><span class="n">DRCOS</span><span class="p">(</span><span class="n">DRXINIT</span><span class="p">,</span><span class="n">DRYINIT</span><span class="p">,</span><span class="n">DRZINIT</span><span class="p">,</span><span class="n">THETAS</span><span class="p">,</span><span class="n">PHIS</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">LOAD</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="k">DATA</span><span class="w">  
       </span><span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="mi">+1</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="n">NPMAX</span><span class="p">)</span><span class="w"> </span><span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">991</span><span class="p">)</span><span class="w">
  </span><span class="mi">991</span><span class="w">  </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' EVENT WITH N0 OF PRIMARIES GT 20 IN MIPCALC STOPPED PROG
     /RAM'</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">STOP</span><span class="w">
       </span><span class="n">ENM</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">ESEC</span><span class="w">
       </span><span class="n">DIRX</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">DRXX</span><span class="w"> 
       </span><span class="n">DIRY</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">DRYY</span><span class="w"> 
       </span><span class="n">DIRZ</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">DRZZ</span><span class="w">
       </span><span class="n">XS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
       </span><span class="n">YS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
       </span><span class="n">ZS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
       </span><span class="n">TS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
       </span><span class="n">IEVENT</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="n">NP</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">CALCULATE</span><span class="w"> </span><span class="n">POSSIBLE</span><span class="w"> </span><span class="n">SHELL</span><span class="w"> </span><span class="n">EMISSIONS</span><span class="p">:</span><span class="w"> </span><span class="n">AUGER</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
       </span><span class="n">IFLTST</span><span class="o">=</span><span class="mi">0</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">WKLM</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.GT.</span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
        </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">R9</span><span class="ow">.LT.</span><span class="n">WKLM</span><span class="p">(</span><span class="n">I</span><span class="p">))</span><span class="w"> </span><span class="n">IFLTST</span><span class="o">=</span><span class="mi">1</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">IFLTST</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">AUGER</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">WITHOUT</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
        </span><span class="n">NAUG</span><span class="o">=</span><span class="n">NC0</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">EAVAUG</span><span class="o">=</span><span class="n">EC0</span><span class="p">(</span><span class="n">I</span><span class="p">)/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NAUG</span><span class="p">)</span><span class="w">
        </span><span class="k">DO</span><span class="w"> </span><span class="mi">700</span><span class="w"> </span><span class="n">JFL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NC0</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="mi">+1</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="n">NPMAX</span><span class="p">)</span><span class="w"> </span><span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">991</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">STOP</span><span class="w">
        </span><span class="n">ENM</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">EAVAUG</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RANDOM</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">ANGLE</span><span class="w">
        </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">F3</span><span class="o">=</span><span class="mf">1.0D0-2.0D0</span><span class="o">*</span><span class="n">R3</span><span class="w">
        </span><span class="n">THETAS</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="n">F3</span><span class="p">)</span><span class="w">
        </span><span class="n">F6</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span><span class="w">
        </span><span class="n">F5</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span><span class="w">
        </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span><span class="w">
        </span><span class="n">F8</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">F9</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">DIRX</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DIRY</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DIRZ</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F6</span><span class="w">
        </span><span class="n">XS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
        </span><span class="n">YS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
        </span><span class="n">ZS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
        </span><span class="n">TS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
  </span><span class="mi">700</span><span class="w">   </span><span class="k">CONTINUE</span><span class="w">
        </span><span class="n">IEVENT</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="n">NP</span><span class="w">
       </span><span class="k">ELSE</span><span class="w"> 
</span><span class="n">C</span><span class="w"> </span><span class="n">AUGER</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">AND</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NG2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">702</span><span class="w">
        </span><span class="n">NAUG</span><span class="o">=</span><span class="n">NG2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">EAVAUG</span><span class="o">=</span><span class="n">EG2</span><span class="p">(</span><span class="n">I</span><span class="p">)/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NAUG</span><span class="p">)</span><span class="w">
        </span><span class="k">DO</span><span class="w"> </span><span class="mi">701</span><span class="w"> </span><span class="n">JFL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NG2</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="mi">+1</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="n">NPMAX</span><span class="p">)</span><span class="w"> </span><span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">991</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">STOP</span><span class="w">
        </span><span class="n">ENM</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">EAVAUG</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RANDOM</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">ANGLE</span><span class="w">
        </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">THETAS</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span><span class="w">
        </span><span class="n">F6</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span><span class="w">
        </span><span class="n">F5</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span><span class="w">
        </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span><span class="w">
        </span><span class="n">F8</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">F9</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">DIRX</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DIRY</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DIRZ</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F6</span><span class="w">
        </span><span class="n">XS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
        </span><span class="n">YS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
        </span><span class="n">ZS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
        </span><span class="n">TS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">0.0</span><span class="w">
  </span><span class="mi">701</span><span class="w">   </span><span class="k">CONTINUE</span><span class="w">
        </span><span class="n">IEVENT</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="n">NP</span><span class="w">
  </span><span class="mi">702</span><span class="w">   </span><span class="k">IF</span><span class="p">(</span><span class="n">NG1</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">704</span><span class="w">
        </span><span class="n">NAUG</span><span class="o">=</span><span class="n">NG1</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">EAVAUG</span><span class="o">=</span><span class="n">EG1</span><span class="p">(</span><span class="n">I</span><span class="p">)/</span><span class="n">DFLOAT</span><span class="p">(</span><span class="n">NAUG</span><span class="p">)</span><span class="w">
        </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FLUORESCENCE</span><span class="w"> </span><span class="n">ABSORPTION</span><span class="w"> </span><span class="n">DISTANCE</span><span class="w">
        </span><span class="n">DFL</span><span class="o">=-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">DSTFL</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="k">DO</span><span class="w"> </span><span class="mi">703</span><span class="w"> </span><span class="n">JFL</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NG1</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="mi">+1</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="n">NPMAX</span><span class="p">)</span><span class="w"> </span><span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">991</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">STOP</span><span class="w">
        </span><span class="n">ENM</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">EAVAUG</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RANDOM</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">ANGLE</span><span class="w">
        </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">THETAS</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span><span class="w">
        </span><span class="n">F6</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span><span class="w">
        </span><span class="n">F5</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span><span class="w">
        </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span><span class="w">
        </span><span class="n">F8</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">F9</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">DIRX</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DIRY</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DIRZ</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F6</span><span class="w">
        </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">THEFL</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span><span class="w"> 
        </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">PHIFL</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span><span class="w">
        </span><span class="n">XS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">DFL</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THEFL</span><span class="p">)</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHIFL</span><span class="p">)</span><span class="w">
        </span><span class="n">YS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">DFL</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THEFL</span><span class="p">)</span><span class="o">*</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHIFL</span><span class="p">)</span><span class="w">
        </span><span class="n">ZS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">DFL</span><span class="o">*</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THEFL</span><span class="p">)</span><span class="w">  
        </span><span class="n">TS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">DFL</span><span class="p">/</span><span class="n">VV</span><span class="w">
  </span><span class="mi">703</span><span class="w">   </span><span class="k">CONTINUE</span><span class="w">
        </span><span class="n">IEVENT</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="n">NP</span><span class="w">
  </span><span class="mi">704</span><span class="w">   </span><span class="k">CONTINUE</span><span class="w">   
       </span><span class="k">ENDIF</span><span class="w">
      </span><span class="k">ELSE</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">4.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.9</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">14.</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.14</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mf">19.</span><span class="w">
     </span><span class="p">/</span><span class="n">OR</span><span class="ow">.IA.</span><span class="n">EQ</span><span class="mf">.24</span><span class="ow">.OR.</span><span class="n">IA</span><span class="ow">.EQ.</span><span class="mi">29</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">EXCITATION</span><span class="w">
</span><span class="n">C</span><span class="o">----------------------------------------------------------------</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="ow">.EQ.</span><span class="mf">0.0</span><span class="ow">.OR.</span><span class="n">IPEN</span><span class="ow">.EQ.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">POSSIBLE</span><span class="w"> </span><span class="n">PENNING</span><span class="w"> </span><span class="nb">TRANSFER</span><span class="w">
       </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
       </span><span class="k">IF</span><span class="p">(</span><span class="n">R9</span><span class="ow">.LT.</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">I</span><span class="p">))</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">PENNING</span><span class="w"> </span><span class="nb">TRANSFER</span><span class="w">
        </span><span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="mi">+1</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="n">NPMAX</span><span class="p">)</span><span class="w"> </span><span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">991</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">NP</span><span class="ow">.GT.</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">STOP</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">FINITE</span><span class="w"> </span><span class="n">PENNING</span><span class="w"> </span><span class="n">FIXED</span><span class="w"> </span><span class="n">ELECTRON</span><span class="w"> </span><span class="n">ENERGY</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mf">4.0</span><span class="n">EV</span><span class="w">
        </span><span class="n">ENM</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="mf">4.0</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">RANDOM</span><span class="w"> </span><span class="n">EMISSION</span><span class="w"> </span><span class="n">ANGLE</span><span class="w">
        </span><span class="n">R3</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">THETAS</span><span class="o">=</span><span class="n">DACOS</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span><span class="w">
        </span><span class="n">F6</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span><span class="w">
        </span><span class="n">F5</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span><span class="w">
        </span><span class="n">R4</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span><span class="w">
        </span><span class="n">F8</span><span class="o">=</span><span class="n">DSIN</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">F9</span><span class="o">=</span><span class="n">DCOS</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span><span class="w">
        </span><span class="n">DIRX</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DIRY</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span><span class="w">
        </span><span class="n">DIRZ</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=</span><span class="n">F6</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">PENNING</span><span class="w"> </span><span class="nb">TRANSFER</span><span class="w"> </span><span class="n">DISTANCE</span><span class="w">
        </span><span class="n">ASIGN</span><span class="o">=</span><span class="mf">1.0D0</span><span class="w">
        </span><span class="n">R1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">R1</span><span class="ow">.LT.</span><span class="mf">0.5</span><span class="p">)</span><span class="n">ASIGN</span><span class="o">=-</span><span class="n">ASIGN</span><span class="w">
        </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">XS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="mf">1.D-6</span><span class="o">*</span><span class="n">ASIGN</span><span class="w">
        </span><span class="n">R1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">R1</span><span class="ow">.LT.</span><span class="mf">0.5</span><span class="p">)</span><span class="n">ASIGN</span><span class="o">=-</span><span class="n">ASIGN</span><span class="w">
        </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">YS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="mf">1.D-6</span><span class="o">*</span><span class="n">ASIGN</span><span class="w">
        </span><span class="n">R1</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="k">IF</span><span class="p">(</span><span class="n">R1</span><span class="ow">.LT.</span><span class="mf">0.5</span><span class="p">)</span><span class="n">ASIGN</span><span class="o">=-</span><span class="n">ASIGN</span><span class="w">
        </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">ZS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="mf">1.D-6</span><span class="o">*</span><span class="n">ASIGN</span><span class="w">
        </span><span class="n">R9</span><span class="o">=</span><span class="n">drand48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span><span class="w">
        </span><span class="n">TS</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">NP</span><span class="p">)</span><span class="o">=-</span><span class="n">DLOG</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">I</span><span class="p">)</span><span class="w">
        </span><span class="n">IEVENT</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">=</span><span class="n">NP</span><span class="w">
       </span><span class="k">ELSE</span><span class="w">
        </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">10</span><span class="w">
       </span><span class="k">ENDIF</span><span class="w">  
      </span><span class="k">ELSE</span><span class="w">
</span><span class="n">C</span><span class="w"> </span><span class="n">ELASTIC</span><span class="w">
</span><span class="n">C</span><span class="o">-----------------------------------------------------------------</span><span class="w">
       </span><span class="k">GO</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="mi">10</span><span class="w">
      </span><span class="k">ENDIF</span><span class="w">
  </span><span class="mi">100</span><span class="w"> </span><span class="k">CONTINUE</span><span class="w">
      </span><span class="k">WRITE</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">888</span><span class="p">)</span><span class="w"> </span><span class="n">NPMAX</span><span class="w">
  </span><span class="mi">888</span><span class="w"> </span><span class="k">FORMAT</span><span class="p">(</span><span class="s1">' NPMAX='</span><span class="p">,</span><span class="l">I3</span><span class="p">)</span><span class="w">
      </span><span class="k">RETURN</span><span class="w">
      </span><span class="k">END</span><span class="w">
</span></code></pre><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">MIPCALC</span><span class="p">():</span>
    <span class="c"># IMPLICIT #real*8 (A-H,O-Z)</span>
    <span class="c"># IMPLICIT #integer*8 (I-N)                                         </span>
    <span class="c">#/INPT/</span>
    <span class="k">global</span> <span class="n">NGAS</span><span class="p">,</span><span class="n">NSTEP</span><span class="p">,</span><span class="n">NANISO</span><span class="p">,</span><span class="n">EFINAL</span><span class="p">,</span><span class="n">ESTEP</span><span class="p">,</span><span class="n">AKT</span><span class="p">,</span><span class="n">ARY</span><span class="p">,</span><span class="n">TEMPC</span><span class="p">,</span><span class="n">TORR</span><span class="p">,</span><span class="n">IPEN</span>
    <span class="c">#/SETP/</span>
    <span class="k">global</span> <span class="n">TMAX</span><span class="p">,</span><span class="n">SMALL</span><span class="p">,</span><span class="n">API</span><span class="p">,</span><span class="n">ESTART</span><span class="p">,</span><span class="n">THETA</span><span class="p">,</span><span class="n">PHI</span>
    <span class="k">global</span> <span class="n">TCFMAX</span><span class="c">#(10)</span>
    <span class="k">global</span> <span class="n">TCFMAX1</span><span class="p">,</span><span class="n">RSTART</span><span class="p">,</span><span class="n">EFIELD</span><span class="p">,</span><span class="n">ETHRM</span><span class="p">,</span><span class="n">ECUT</span><span class="p">,</span><span class="n">NEVENT</span><span class="p">,</span><span class="n">IMIP</span><span class="p">,</span><span class="n">IWRITE</span>  
    <span class="c">#/SET2/</span>
    <span class="k">global</span> <span class="n">DRXINIT</span><span class="p">,</span><span class="n">DRYINIT</span><span class="p">,</span><span class="n">DRZINIT</span>
    <span class="c">#/LARGE/</span>
    <span class="k">global</span> <span class="n">CF</span><span class="c">#(20000,512)</span>
    <span class="k">global</span> <span class="n">EIN</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">TCF</span><span class="c">#(20000)</span>
    <span class="k">global</span> <span class="n">IARRY</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">RGAS</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">IPN</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">WPL</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">IZBR</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">IPLAST</span>
    <span class="k">global</span> <span class="n">PENFRA</span><span class="c">#[3][512]</span>
    <span class="c">#/ANIS/</span>
    <span class="k">global</span> <span class="n">PSCT</span><span class="c">#(20000,512)</span>
    <span class="k">global</span> <span class="n">ANGCT</span><span class="c">#(20000,512)</span>
    <span class="k">global</span> <span class="n">INDEX</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">NISO</span>
    <span class="c">#/RLTVY/</span>
    <span class="k">global</span> <span class="n">BET</span><span class="c">#[2000]</span>
    <span class="k">global</span> <span class="n">GAM</span><span class="c">#(20000)</span>
    <span class="k">global</span> <span class="n">VC</span><span class="p">,</span><span class="n">EMS</span>
    <span class="c">#/MIPCLC/</span>
    <span class="k">global</span> <span class="n">ANPRELA</span><span class="p">,</span><span class="n">ANPRATT</span><span class="p">,</span><span class="n">ANPREXC</span><span class="p">,</span><span class="n">ANPRION</span><span class="p">,</span><span class="n">ANPREXCI</span><span class="p">,</span><span class="n">ANPRBRM</span>
    <span class="c">#/DEDX/</span>
    <span class="k">global</span> <span class="n">ELOSS</span><span class="p">,</span><span class="n">ELOSEX</span><span class="p">,</span><span class="n">ELOSION</span><span class="p">,</span><span class="n">ESUM</span><span class="p">,</span><span class="n">BETAGAM</span><span class="p">,</span><span class="n">TCFHIGH</span><span class="p">,</span><span class="n">VELC</span><span class="p">,</span><span class="n">EMAXDEL</span><span class="p">,</span><span class="n">ELOSIONC</span><span class="p">,</span><span class="n">CUTIONFRC</span><span class="p">,</span><span class="n">ELOSEXI</span><span class="p">,</span><span class="n">ELOSBREM</span><span class="p">,</span><span class="n">NREJECT</span>
    <span class="c">#/COMP/</span>
    <span class="k">global</span> <span class="n">LCMP</span><span class="p">,</span><span class="n">LCFLG</span><span class="p">,</span><span class="n">LRAY</span><span class="p">,</span><span class="n">LRFLG</span><span class="p">,</span><span class="n">LPAP</span><span class="p">,</span><span class="n">LPFLG</span><span class="p">,</span><span class="n">LBRM</span><span class="p">,</span><span class="n">LBFLG</span><span class="p">,</span><span class="n">LPEFLG</span>
    <span class="c">#/MIPOUT/</span>
    <span class="k">global</span> <span class="n">ENM</span><span class="c">#(100000,20)</span>
    <span class="k">global</span> <span class="n">XS</span><span class="c">#(100000,20)</span>
    <span class="k">global</span> <span class="n">YS</span><span class="c">#(100000,20)</span>
    <span class="k">global</span> <span class="n">ZS</span><span class="c">#(100000,20)</span>
    <span class="k">global</span> <span class="n">DIRX</span><span class="c">#(100000,20)</span>
    <span class="k">global</span> <span class="n">DIRY</span><span class="c">#(100000,20)</span>
    <span class="k">global</span> <span class="n">DIRZ</span><span class="c">#[100000,20]</span>
    <span class="k">global</span> <span class="n">TS</span><span class="c">#(100000,20)</span>
    <span class="k">global</span> <span class="n">IEVENT</span><span class="c">#(100000)</span>
    <span class="c">#/IONFL/</span>
    <span class="k">global</span> <span class="n">NC0</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">EC0</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">NG1</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">EG1</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">NG2</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">EG2</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">WKLM</span><span class="c">#(512)</span>
    <span class="k">global</span> <span class="n">DSTFL</span><span class="c">#(512)</span>
    <span class="c">#/IONMOD/</span>
    <span class="k">global</span> <span class="n">ESPLIT</span><span class="c">#(512,20)</span>
    <span class="k">global</span> <span class="n">IONMODEL</span><span class="c">#(512) </span>
    <span class="k">def</span> <span class="nf">get_globals</span><span class="p">():</span>
        <span class="n">NGAS</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">NGAS</span>
        <span class="n">NSTEP</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">NSTEP</span>
        <span class="n">NANISO</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">NANISO</span>
        <span class="n">EFINAL</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">EFINAL</span>
        <span class="n">ESTEP</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ESTEP</span>
        <span class="n">AKT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">AKT</span>
        <span class="n">ARY</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ARY</span>
        <span class="n">TEMPC</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">TEMPC</span>
        <span class="n">TORR</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">TORR</span>
        <span class="n">IPEN</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">IPEN</span>
        <span class="n">TMAX</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">TMAX</span>
        <span class="n">SMALL</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">SMALL</span>
        <span class="n">API</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">API</span>
        <span class="n">ESTART</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ESTART</span>
        <span class="n">THETA</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">THETA</span>
        <span class="n">PHI</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">PHI</span>
        <span class="n">TCFMAX</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">TCFMAX</span>
        <span class="n">TCFMAX1</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">TCFMAX1</span>
        <span class="n">RSTART</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">RSTART</span>
        <span class="n">EFIELD</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">EFIELD</span>
        <span class="n">ETHRM</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ETHRM</span>
        <span class="n">ECUT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ECUT</span>
        <span class="n">NEVENT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">NEVENT</span>
        <span class="n">IMIP</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">IMIP</span>
        <span class="n">IWRITE</span>  <span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">IWRITE</span>  
        <span class="n">DRXINIT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">DRXINIT</span>
        <span class="n">DRYINIT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">DRYINIT</span>
        <span class="n">DRZINIT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">DRZINIT</span>
        <span class="n">CF</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">CF</span>
        <span class="n">EIN</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">EIN</span>
        <span class="n">TCF</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">TCF</span>
        <span class="n">IARRY</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">IARRY</span>
        <span class="n">RGAS</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">RGAS</span>
        <span class="n">IPN</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">IPN</span>
        <span class="n">WPL</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">WPL</span>
        <span class="n">IZBR</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">IZBR</span>
        <span class="n">IPLAST</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">IPLAST</span>
        <span class="n">PENFRA</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">PENFRA</span>
        <span class="n">PSCT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">PSCT</span>
        <span class="n">ANGCT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ANGCT</span>
        <span class="n">INDEX</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">INDEX</span>
        <span class="n">NISO</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">NISO</span>
        <span class="n">BET</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">BET</span>
        <span class="n">GAM</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">GAM</span>
        <span class="n">VC</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">VC</span>
        <span class="n">EMS</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">EMS</span>
        <span class="n">ANPRELA</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ANPRELA</span>
        <span class="n">ANPRATT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ANPRATT</span>
        <span class="n">ANPREXC</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ANPREXC</span>
        <span class="n">ANPRION</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ANPRION</span>
        <span class="n">ANPREXCI</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ANPREXCI</span>
        <span class="n">ANPRBRM</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ANPRBRM</span>
        <span class="n">ELOSS</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ELOSS</span>
        <span class="n">ELOSEX</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ELOSEX</span>
        <span class="n">ELOSION</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ELOSION</span>
        <span class="n">ESUM</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ESUM</span>
        <span class="n">BETAGAM</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">BETAGAM</span>
        <span class="n">TCFHIGH</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">TCFHIGH</span>
        <span class="n">VELC</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">VELC</span>
        <span class="n">EMAXDEL</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">EMAXDEL</span>
        <span class="n">ELOSIONC</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ELOSIONC</span>
        <span class="n">CUTIONFRC</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">CUTIONFRC</span>
        <span class="n">ELOSEXI</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ELOSEXI</span>
        <span class="n">ELOSBREM</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ELOSBREM</span>
        <span class="n">NREJECT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">NREJECT</span>
        <span class="n">LCMP</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">LCMP</span>
        <span class="n">LCFLG</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">LCFLG</span>
        <span class="n">LRAY</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">LRAY</span>
        <span class="n">LRFLG</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">LRFLG</span>
        <span class="n">LPAP</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">LPAP</span>
        <span class="n">LPFLG</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">LPFLG</span>
        <span class="n">LBRM</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">LBRM</span>
        <span class="n">LBFLG</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">LBFLG</span>
        <span class="n">LPEFLG</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">LPEFLG</span>
        <span class="n">ENM</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ENM</span>
        <span class="n">XS</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">XS</span>
        <span class="n">YS</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">YS</span>
        <span class="n">ZS</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ZS</span>
        <span class="n">DIRX</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">DIRX</span>
        <span class="n">DIRY</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">DIRY</span>
        <span class="n">DIRZ</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">DIRZ</span>
        <span class="n">TS</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">TS</span>
        <span class="n">IEVENT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">IEVENT</span>
        <span class="n">NC0</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">NC0</span>
        <span class="n">EC0</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">EC0</span>
        <span class="n">NG1</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">NG1</span>
        <span class="n">EG1</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">EG1</span>
        <span class="n">NG2</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">NG2</span>
        <span class="n">EG2</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">EG2</span>
        <span class="n">WKLM</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">WKLM</span>
        <span class="n">DSTFL</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">DSTFL</span>
        <span class="n">ESPLIT</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">ESPLIT</span>
        <span class="n">IONMODEL</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">IONMODEL</span>
    <span class="n">get_globals</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">update_globals</span><span class="p">():</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">NGAS</span><span class="o">=</span><span class="n">NGAS</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">NSTEP</span><span class="o">=</span><span class="n">NSTEP</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">NANISO</span><span class="o">=</span><span class="n">NANISO</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">EFINAL</span><span class="o">=</span><span class="n">EFINAL</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ESTEP</span><span class="o">=</span><span class="n">ESTEP</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">AKT</span><span class="o">=</span><span class="n">AKT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ARY</span><span class="o">=</span><span class="n">ARY</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">TEMPC</span><span class="o">=</span><span class="n">TEMPC</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">TORR</span><span class="o">=</span><span class="n">TORR</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">IPEN</span><span class="o">=</span><span class="n">IPEN</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">TMAX</span><span class="o">=</span><span class="n">TMAX</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">SMALL</span><span class="o">=</span><span class="n">SMALL</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">API</span><span class="o">=</span><span class="n">API</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ESTART</span><span class="o">=</span><span class="n">ESTART</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">THETA</span><span class="o">=</span><span class="n">THETA</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">PHI</span><span class="o">=</span><span class="n">PHI</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">TCFMAX</span><span class="o">=</span><span class="n">TCFMAX</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">TCFMAX1</span><span class="o">=</span><span class="n">TCFMAX1</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">RSTART</span><span class="o">=</span><span class="n">RSTART</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">EFIELD</span><span class="o">=</span><span class="n">EFIELD</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ETHRM</span><span class="o">=</span><span class="n">ETHRM</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ECUT</span><span class="o">=</span><span class="n">ECUT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">NEVENT</span><span class="o">=</span><span class="n">NEVENT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">IMIP</span><span class="o">=</span><span class="n">IMIP</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">IWRITE</span>  <span class="o">=</span><span class="n">IWRITE</span>  
        <span class="n">conf</span><span class="o">.</span><span class="n">DRXINIT</span><span class="o">=</span><span class="n">DRXINIT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">DRYINIT</span><span class="o">=</span><span class="n">DRYINIT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">DRZINIT</span><span class="o">=</span><span class="n">DRZINIT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">CF</span><span class="o">=</span><span class="n">CF</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">EIN</span><span class="o">=</span><span class="n">EIN</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">TCF</span><span class="o">=</span><span class="n">TCF</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">IARRY</span><span class="o">=</span><span class="n">IARRY</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">RGAS</span><span class="o">=</span><span class="n">RGAS</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">IPN</span><span class="o">=</span><span class="n">IPN</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">WPL</span><span class="o">=</span><span class="n">WPL</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">IZBR</span><span class="o">=</span><span class="n">IZBR</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">IPLAST</span><span class="o">=</span><span class="n">IPLAST</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">PENFRA</span><span class="o">=</span><span class="n">PENFRA</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">PSCT</span><span class="o">=</span><span class="n">PSCT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ANGCT</span><span class="o">=</span><span class="n">ANGCT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">INDEX</span><span class="o">=</span><span class="n">INDEX</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">NISO</span><span class="o">=</span><span class="n">NISO</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">BET</span><span class="o">=</span><span class="n">BET</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">GAM</span><span class="o">=</span><span class="n">GAM</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">VC</span><span class="o">=</span><span class="n">VC</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">EMS</span><span class="o">=</span><span class="n">EMS</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ANPRELA</span><span class="o">=</span><span class="n">ANPRELA</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ANPRATT</span><span class="o">=</span><span class="n">ANPRATT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ANPREXC</span><span class="o">=</span><span class="n">ANPREXC</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ANPRION</span><span class="o">=</span><span class="n">ANPRION</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ANPREXCI</span><span class="o">=</span><span class="n">ANPREXCI</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ANPRBRM</span><span class="o">=</span><span class="n">ANPRBRM</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ELOSS</span><span class="o">=</span><span class="n">ELOSS</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ELOSEX</span><span class="o">=</span><span class="n">ELOSEX</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ELOSION</span><span class="o">=</span><span class="n">ELOSION</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ESUM</span><span class="o">=</span><span class="n">ESUM</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">BETAGAM</span><span class="o">=</span><span class="n">BETAGAM</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">TCFHIGH</span><span class="o">=</span><span class="n">TCFHIGH</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">VELC</span><span class="o">=</span><span class="n">VELC</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">EMAXDEL</span><span class="o">=</span><span class="n">EMAXDEL</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ELOSIONC</span><span class="o">=</span><span class="n">ELOSIONC</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">CUTIONFRC</span><span class="o">=</span><span class="n">CUTIONFRC</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ELOSEXI</span><span class="o">=</span><span class="n">ELOSEXI</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ELOSBREM</span><span class="o">=</span><span class="n">ELOSBREM</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">NREJECT</span><span class="o">=</span><span class="n">NREJECT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">LCMP</span><span class="o">=</span><span class="n">LCMP</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">LCFLG</span><span class="o">=</span><span class="n">LCFLG</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">LRAY</span><span class="o">=</span><span class="n">LRAY</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">LRFLG</span><span class="o">=</span><span class="n">LRFLG</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">LPAP</span><span class="o">=</span><span class="n">LPAP</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">LPFLG</span><span class="o">=</span><span class="n">LPFLG</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">LBRM</span><span class="o">=</span><span class="n">LBRM</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">LBFLG</span><span class="o">=</span><span class="n">LBFLG</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">LPEFLG</span><span class="o">=</span><span class="n">LPEFLG</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ENM</span><span class="o">=</span><span class="n">ENM</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">XS</span><span class="o">=</span><span class="n">XS</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">YS</span><span class="o">=</span><span class="n">YS</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ZS</span><span class="o">=</span><span class="n">ZS</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">DIRX</span><span class="o">=</span><span class="n">DIRX</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">DIRY</span><span class="o">=</span><span class="n">DIRY</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">DIRZ</span><span class="o">=</span><span class="n">DIRZ</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">TS</span><span class="o">=</span><span class="n">TS</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">IEVENT</span><span class="o">=</span><span class="n">IEVENT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">NC0</span><span class="o">=</span><span class="n">NC0</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">EC0</span><span class="o">=</span><span class="n">EC0</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">NG1</span><span class="o">=</span><span class="n">NG1</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">EG1</span><span class="o">=</span><span class="n">EG1</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">NG2</span><span class="o">=</span><span class="n">NG2</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">EG2</span><span class="o">=</span><span class="n">EG2</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">WKLM</span><span class="o">=</span><span class="n">WKLM</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">DSTFL</span><span class="o">=</span><span class="n">DSTFL</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">ESPLIT</span><span class="o">=</span><span class="n">ESPLIT</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">IONMODEL</span><span class="o">=</span><span class="n">IONMODEL</span>
    <span class="n">CFTEMP</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">512</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="c">#[0 for x in range(512)]</span>
    <span class="n">PSTEMP</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">512</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="c">#[0 for x in range(512)]</span>
    <span class="n">ANTEMP</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">512</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="c">#[0 for x in range(512)]</span>
    <span class="c"># CALCULATE DE/DX AND DISTANCE BETWEEN PRIMARY CLUSTERS AND ALSO</span>
    <span class="c"># PRIMARY ELECTRON ENERGY AND VACANCY FOR INPUT TO THERMALISATION</span>
    <span class="c"># ALSO ADDS EXCITATION CLUSTERS WHICH HAVE PENNING FRACTIONS GT 0.0</span>
    <span class="c">#</span>
    <span class="c"># USE VELOCITY IN METRES/PICOSECOND</span>
    <span class="n">VV</span><span class="o">=</span><span class="mf">2.99792458</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span> <span class="p">)</span>
    <span class="c"># MAXIMUM DELTA ELECTRON ENERGY ALLOWED IN EVENT OUTPUT SECTION= EMAXDEL</span>
    <span class="c"># NOTE NO LIMIT ON GLOBAL DE/DX CALCULATION</span>
    <span class="c">#</span>
    <span class="n">EMAXDEL</span><span class="o">=</span><span class="n">ECUT</span>      
    <span class="n">NREJECT</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">NCUT</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">NCUTT</span><span class="o">=</span><span class="mi">0</span>
    <span class="c">#</span>
    <span class="n">IEVMAX</span><span class="o">=</span><span class="mi">100000</span>   
    <span class="n">NPMAX</span><span class="o">=</span><span class="mi">0</span>    
    <span class="n">API</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
    <span class="n">TWOPI</span><span class="o">=</span><span class="mf">2.00</span><span class="o">*</span><span class="n">API</span>
    <span class="n">ANPRELA</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ANPRATT</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ANPREXC</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ANPREXCI</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ANPRION</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ANPRBRM</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ELOSS</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ELOSEX</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ELOSEXI</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ELOSION</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ELOSIONC</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="n">ELOSBREM</span><span class="o">=</span><span class="mf">0.00</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">IPLAST</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">CFTEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">CF</span><span class="p">[</span><span class="mi">20000</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="n">PSTEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">PSCT</span><span class="p">[</span><span class="mi">20000</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="n">ANTEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">=</span><span class="n">ANGCT</span><span class="p">[</span><span class="mi">20000</span><span class="p">][</span><span class="n">I</span><span class="p">]</span>
        <span class="n">TCFF</span><span class="o">=</span><span class="n">TCF</span><span class="p">[</span><span class="mi">20000</span><span class="p">]</span>
        <span class="n">BETA</span><span class="o">=</span><span class="n">BET</span><span class="p">[</span><span class="mi">2000</span><span class="p">]</span>
        <span class="n">GAMM</span><span class="o">=</span><span class="n">GAM</span><span class="p">[</span><span class="mi">20000</span><span class="p">]</span>
    <span class="n">VEL</span><span class="o">=</span><span class="n">BETA</span><span class="o">*</span><span class="n">VC</span>
    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">IPLAST</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">IA</span><span class="o">=</span><span class="n">IARRY</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">IA</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">14</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">15</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">19</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">20</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">24</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">25</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">29</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">30</span><span class="p">):</span>
            <span class="c"># BREMSSTRAHLUNG EXCITATION OR SUPERELASTIC</span>
            <span class="k">if</span><span class="p">(</span><span class="n">J</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span><span class="p">(</span><span class="n">J</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
            <span class="c"># CHECK IF BREMSSTRAHLUNG</span>
            <span class="k">if</span><span class="p">(</span><span class="n">LBRM</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">IZBR</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="c"># BREMSSTRAHLUNG</span>
                <span class="c"># FIND AVERAGE BREMSSTRAHLUNG ENERGY LOSS OVER 10000 EVENTS</span>
                <span class="n">IATOMNO</span><span class="o">=</span><span class="n">IZBR</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
                <span class="n">E</span><span class="o">=</span><span class="n">ESTART</span>
                <span class="n">ESUMBR</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' ENERGY='</span><span class="p">,</span><span class="s">'</span><span class="si">%.4</span><span class="s">f'</span> <span class="o">%</span> <span class="n">E</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">BREMS</span><span class="p">(</span><span class="n">IATOMNO</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">DCX2</span><span class="p">,</span><span class="n">DCY2</span><span class="p">,</span><span class="n">DCZ2</span><span class="p">,</span><span class="n">EOUT</span><span class="p">,</span><span class="n">EDCX</span><span class="p">,</span><span class="n">EDCY</span><span class="p">,</span><span class="n">EDCZ</span><span class="p">,</span><span class="n">EGAMMA</span><span class="p">,</span><span class="n">GDCX</span><span class="p">,</span><span class="n">GDCY</span><span class="p">,</span><span class="n">GDCZ</span><span class="p">)</span>
                    <span class="n">ESUMBR</span><span class="o">=</span><span class="n">ESUMBR</span><span class="o">+</span><span class="n">EGAMMA</span>
                <span class="n">ELBRM</span><span class="o">=</span><span class="n">ESUMBR</span><span class="o">/</span><span class="mf">10000.0</span>
                <span class="k">print</span><span class="p">(</span><span class="s">' ELBRM='</span><span class="p">,</span><span class="s">'</span><span class="si">%.4</span><span class="s">f'</span> <span class="o">%</span> <span class="n">ELBRM</span><span class="p">)</span>
                <span class="n">ANPRBRM</span><span class="o">=</span><span class="n">ANPRBRM</span><span class="o">+</span><span class="n">CFT</span><span class="o">/</span><span class="n">VEL</span>
                <span class="n">ELOSBREM</span><span class="o">=</span><span class="n">ELOSBREM</span><span class="o">+</span><span class="n">CFT</span><span class="o">*</span><span class="n">ELBRM</span><span class="o">/</span><span class="n">VEL</span>
            <span class="c"># endif</span>
            <span class="k">if</span><span class="p">(</span><span class="n">LBRM</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">IZBR</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># EXCITATION OR SUPERELASTIC</span>
                <span class="n">ANPREXC</span><span class="o">=</span><span class="n">ANPREXC</span><span class="o">+</span><span class="n">CFT</span><span class="o">/</span><span class="n">VEL</span>
                <span class="n">ELOSEX</span><span class="o">=</span><span class="n">ELOSEX</span><span class="o">+</span><span class="n">CFT</span><span class="o">*</span><span class="n">EIN</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">*</span><span class="n">RGAS</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">/</span><span class="n">VEL</span>
                <span class="k">if</span><span class="p">(</span><span class="n">IPEN</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">PENFRA</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                    <span class="c"># PENNING TRANSFER OF EXCITATION TO IONISATION</span>
                     <span class="n">ANPREXCI</span><span class="o">=</span><span class="n">ANPREXCI</span><span class="o">+</span><span class="n">PENFRA</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="p">]</span><span class="o">*</span><span class="n">CFT</span><span class="o">/</span><span class="n">VEL</span>
                     <span class="n">ELOSEXI</span><span class="o">=</span><span class="n">ELOSEXI</span><span class="o">+</span><span class="n">PENFRA</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="p">]</span><span class="o">*</span><span class="n">CFT</span><span class="o">*</span><span class="n">EIN</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">*</span><span class="n">RGAS</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">/</span><span class="n">VEL</span>
            <span class="c"># endif</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">IA</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">11</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">16</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">21</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">26</span><span class="p">)</span> <span class="p">:</span>
            <span class="c"># ELASTIC ENERGY LOSS</span>
            <span class="k">if</span><span class="p">(</span><span class="n">J</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span><span class="p">(</span><span class="n">J</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
            <span class="n">ANPRELA</span><span class="o">=</span><span class="n">ANPRELA</span><span class="o">+</span><span class="n">CFT</span><span class="o">/</span><span class="n">VEL</span>
            <span class="c"># CALCULATE ELASTIC ENERGY LOSS AVERAGED OVER NE EVENTS</span>
            <span class="c"># USE ANISOTROPIC SCATTERING</span>
            <span class="n">NE</span><span class="o">=</span><span class="mi">10000</span>
            <span class="n">ELAS</span><span class="o">=</span><span class="mf">0.00</span>
            <span class="n">RFAC</span><span class="o">=</span><span class="mf">1.00</span><span class="o">+</span><span class="n">GAMM</span><span class="o">*</span><span class="p">(</span><span class="n">RGAS</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span>
            <span class="n">RFAC</span><span class="o">=</span><span class="p">(</span><span class="n">RFAC</span><span class="o">-</span><span class="mf">1.00</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">RFAC</span><span class="o">*</span><span class="n">RFAC</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">NE</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">INDEX</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">R31</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">F3</span><span class="o">=</span><span class="mf">1.00</span><span class="o">-</span><span class="n">R3</span><span class="o">*</span><span class="n">ANTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R31</span> <span class="o">&gt;</span> <span class="n">PSTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]):</span>
                        <span class="n">F3</span><span class="o">=-</span><span class="n">F3</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">INDEX</span><span class="p">[</span><span class="n">J</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">EPSI</span><span class="o">=</span><span class="n">PSTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
                    <span class="n">F3</span><span class="o">=</span><span class="mf">1.00</span><span class="o">-</span><span class="p">(</span><span class="mf">2.00</span><span class="o">*</span><span class="n">R3</span><span class="o">*</span><span class="p">(</span><span class="mf">1.00</span><span class="o">-</span><span class="n">EPSI</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.00</span><span class="o">+</span><span class="n">EPSI</span><span class="o">*</span><span class="p">(</span><span class="mf">1.00</span><span class="o">-</span><span class="mf">2.00</span><span class="o">*</span><span class="n">R3</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># ISOTROPIC SCATTERING</span>
                    <span class="n">F3</span><span class="o">=</span><span class="mf">1.00</span><span class="o">-</span><span class="mf">2.00</span><span class="o">*</span><span class="n">R3</span>
                <span class="c"># endif</span>
                <span class="n">ELAS</span><span class="o">=</span><span class="n">ELAS</span><span class="o">+</span><span class="p">(</span><span class="mf">1.00</span><span class="o">-</span><span class="n">F3</span><span class="p">)</span>
            <span class="n">ELOSS</span><span class="o">=</span><span class="n">CFT</span><span class="o">*</span><span class="mf">2.00</span><span class="o">*</span><span class="n">RFAC</span><span class="o">*</span><span class="n">EFINAL</span><span class="o">*</span><span class="n">ELAS</span><span class="o">/</span><span class="n">VEL</span>
            <span class="n">ELOSS</span><span class="o">=</span><span class="n">ELOSS</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">NE</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">IA</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">13</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">18</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">23</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">28</span><span class="p">):</span>
            <span class="c"># ATTACHMENT</span>
            <span class="n">ANPRATT</span><span class="o">=</span><span class="n">ANPRATT</span><span class="o">+</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">VEL</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">IA</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">17</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">22</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">27</span><span class="p">):</span>
            <span class="c"># IONISATION</span>
            <span class="n">ANPRION</span><span class="o">=</span><span class="n">ANPRION</span><span class="o">+</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">VEL</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">print</span><span class="p">(</span><span class="s">' WARNING NO COLLISION TYPE IN FUNCTION MIPCALC'</span><span class="p">)</span>    
        <span class="c"># endif</span>
    <span class="c"># CALCULATE ENERGY LOSS TO IONISATION AVERAGED OVER NEV EVENTS</span>
    <span class="n">NEV</span><span class="o">=</span><span class="mi">10000000</span>
    <span class="n">ETEMP</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">ETEMPC</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">IPLAST</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">IA</span><span class="o">=</span><span class="n">IARRY</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">IA</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">17</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">22</span> <span class="ow">or</span> <span class="n">IA</span><span class="o">==</span><span class="mi">27</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">EFINAL</span> <span class="o">&lt;</span> <span class="n">EIN</span><span class="p">[</span><span class="n">J</span><span class="p">]):</span>
                <span class="k">pass</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#  NEV = NO OF IONISATION EVENTS TO AVERAGE</span>
                <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">NEV</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">IONMODEL</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                        <span class="c"># CALCULATE SECONDARY ENERGY ,ESEC, IN IONISATION COLLISION USING</span>
                        <span class="c"># FIVE DIFFERENT POSSIBLE MODELS</span>
                        <span class="n">IONSPLIT</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">ESTART</span><span class="p">,</span><span class="n">EIN</span><span class="p">[</span><span class="n">J</span><span class="p">],</span><span class="n">ETEMP1</span><span class="p">)</span>
                        <span class="k">pass</span>
                    <span class="c"># endif # doing to pass and hence the next else</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">R9</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">ETEMP1</span><span class="o">=</span><span class="n">WPL</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">R9</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="n">ESTART</span><span class="o">-</span><span class="n">EIN</span><span class="p">[</span><span class="n">J</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.00</span><span class="o">*</span><span class="n">WPL</span><span class="p">[</span><span class="n">J</span><span class="p">])))</span> 
                        <span class="n">ETEMP1</span><span class="o">=</span><span class="n">WPL</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ETEMP1</span><span class="o">/</span><span class="n">WPL</span><span class="p">[</span><span class="n">J</span><span class="p">])</span><span class="o">**</span><span class="mf">0.9524</span>
                    <span class="n">ETEMP</span><span class="o">=</span><span class="n">ETEMP</span><span class="o">+</span><span class="n">ETEMP1</span><span class="o">+</span><span class="n">EIN</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">*</span><span class="n">RGAS</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
                    <span class="n">NCUTT</span><span class="o">=</span><span class="n">NCUTT</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">if</span><span class="p">((</span><span class="n">ETEMP1</span><span class="o">+</span><span class="n">EIN</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">*</span><span class="n">RGAS</span><span class="p">[</span><span class="n">J</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">EMAXDEL</span><span class="p">)</span> <span class="p">:</span>
                        <span class="n">ETEMPC</span><span class="o">=</span><span class="n">ETEMPC</span><span class="o">+</span><span class="n">ETEMP1</span><span class="o">+</span><span class="n">EIN</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">*</span><span class="n">RGAS</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
                        <span class="n">NCUT</span><span class="o">=</span><span class="n">NCUT</span><span class="o">+</span><span class="mi">1</span>
                    <span class="c"># endif</span>
                <span class="k">if</span><span class="p">(</span><span class="n">J</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span><span class="o">-</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span><span class="p">(</span><span class="n">J</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">CFT</span><span class="o">=</span><span class="n">TCFF</span><span class="o">*</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">J</span><span class="p">]</span>
                <span class="n">ETEMP</span><span class="o">=</span><span class="n">CFT</span><span class="o">*</span><span class="n">ETEMP</span><span class="o">/</span><span class="n">VEL</span>
                <span class="n">ETEMPC</span><span class="o">=</span><span class="n">CFT</span><span class="o">*</span><span class="n">ETEMPC</span><span class="o">/</span><span class="n">VEL</span>
                <span class="n">ETEMP</span><span class="o">=</span><span class="n">ETEMP</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">NEV</span><span class="p">)</span>
                <span class="n">ETEMPC</span><span class="o">=</span><span class="n">ETEMPC</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">NEV</span><span class="p">)</span>
                <span class="n">ELOSION</span><span class="o">=</span><span class="n">ELOSION</span><span class="o">+</span><span class="n">ETEMP</span>
                <span class="n">ELOSIONC</span><span class="o">=</span><span class="n">ELOSIONC</span><span class="o">+</span><span class="n">ETEMPC</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">BETAGAM</span><span class="o">=</span><span class="n">BETA</span><span class="o">*</span><span class="n">GAMM</span>
    <span class="c"># CONVERT TO EV/CM</span>
    <span class="n">ELOSS</span><span class="o">=</span><span class="n">ELOSS</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ELOSEX</span><span class="o">=</span><span class="n">ELOSEX</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ELOSEXI</span><span class="o">=</span><span class="n">ELOSEXI</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ELOSION</span><span class="o">=</span><span class="n">ELOSION</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ELOSIONC</span><span class="o">=</span><span class="n">ELOSIONC</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ELOSBREM</span><span class="o">=</span><span class="n">ELOSBREM</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="c"># CONVERT COLLISIONS/CM</span>
    <span class="n">ANPRELA</span><span class="o">=</span><span class="n">ANPRELA</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ANPRATT</span><span class="o">=</span><span class="n">ANPRATT</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ANPREXC</span><span class="o">=</span><span class="n">ANPREXC</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ANPREXCI</span><span class="o">=</span><span class="n">ANPREXCI</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ANPRION</span><span class="o">=</span><span class="n">ANPRION</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ANPRBRM</span><span class="o">=</span><span class="n">ANPRBRM</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ESUM</span><span class="o">=</span><span class="n">ELOSS</span><span class="o">+</span><span class="n">ELOSEX</span><span class="o">+</span><span class="n">ELOSION</span><span class="o">+</span><span class="n">ELOSBREM</span>
    <span class="n">VELC</span><span class="o">=</span><span class="n">VEL</span><span class="o">*</span><span class="mf">100.</span>
    <span class="n">TCFHIGH</span><span class="o">=</span><span class="n">TCF</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">CUTIONFRC</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">NCUT</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">NCUTT</span><span class="p">)</span>
    <span class="c"># </span>
    <span class="c">#  LOAD EVENT ARRAYS WITH ELECTRON ENERGY AND DIRECTION COSINES</span>
    <span class="c">#  ADDS ELECTRONS FROM PENNING EXCITATION IF ALLOWED</span>
    <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">NEVENT</span> <span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">K</span> <span class="o">&gt;</span> <span class="n">IEVMAX</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">' WARNING MAXIMUM NUMBER OF EVENTS='</span><span class="p">,</span><span class="n">IEVMAX</span><span class="p">,</span><span class="s">' def STOPPED:'</span><span class="p">)</span>
        <span class="c"># endif</span>
        <span class="n">NP</span><span class="o">=</span><span class="mi">0</span>
        <span class="c">#</span>
        <span class="c"># DETERMINE COLLISION TYPE   </span>
        <span class="c">#</span>
        <span class="c">#10</span>
        <span class="k">def</span> <span class="nf">GOTO10</span><span class="p">():</span>
            <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
            <span class="n">I</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">counter11</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">while</span><span class="p">(</span><span class="n">counter11</span><span class="p">):</span>
                <span class="n">counter11</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="o">+</span><span class="mi">1</span> 
                <span class="k">if</span><span class="p">(</span><span class="n">CFTEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">&lt;</span> <span class="n">R1</span><span class="p">):</span>
                    <span class="n">counter11</span><span class="o">=</span><span class="mi">1</span>
            <span class="c"># FIND TYPE OF INTERACTION</span>
            <span class="n">IA</span><span class="o">=</span><span class="n">IARRY</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">IA</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">17</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">22</span> <span class="ow">or</span> <span class="n">IA</span><span class="o">==</span><span class="mi">27</span><span class="p">)</span> <span class="p">:</span>
                <span class="c">#  IONISATION</span>
                <span class="c">#-----------------------------------------------------------------</span>
                <span class="n">counter12</span><span class="o">=</span><span class="mi">1</span> <span class="c"># self added for looping</span>
                <span class="k">while</span><span class="p">(</span><span class="n">counter12</span><span class="p">):</span>
                    <span class="n">counter12</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">R9</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">ESEC</span><span class="o">=</span><span class="n">WPL</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">*</span><span class="n">TAN</span><span class="p">(</span><span class="n">R9</span><span class="o">*</span><span class="n">ATAN</span><span class="p">((</span><span class="n">ESTART</span><span class="o">-</span><span class="n">EIN</span><span class="p">[</span><span class="n">I</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mf">2.00</span><span class="o">*</span><span class="n">WPL</span><span class="p">[</span><span class="n">I</span><span class="p">])))</span> 
                    <span class="n">ESEC</span><span class="o">=</span><span class="n">WPL</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ESEC</span><span class="o">/</span><span class="n">WPL</span><span class="p">[</span><span class="n">I</span><span class="p">])</span><span class="o">**</span><span class="mf">0.9524</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ESEC</span> <span class="o">&gt;</span> <span class="n">EMAXDEL</span><span class="p">):</span>
                        <span class="n">NREJECT</span><span class="o">=</span><span class="n">NREJECT</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">counter12</span><span class="o">=</span><span class="mi">1</span>
                    <span class="c"># endif</span>
                <span class="c"># CALCULATE PRIMARY SCATTERING ANGLE </span>
                <span class="c"># ANISOTROPIC SCATTERING</span>
                <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">INDEX</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">R31</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="n">F3</span><span class="o">=</span><span class="mf">1.00</span><span class="o">-</span><span class="n">R3</span><span class="o">*</span><span class="n">ANTEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
                <span class="k">if</span><span class="p">(</span><span class="n">R31</span> <span class="o">&gt;</span> <span class="n">PSTEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]):</span>
                    <span class="n">F3</span><span class="o">=-</span><span class="n">F3</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">INDEX</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">EPSI</span><span class="o">=</span><span class="n">PSTEMP</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> 
                    <span class="n">F3</span><span class="o">=</span><span class="mf">1.00</span><span class="o">-</span><span class="p">(</span><span class="mf">2.00</span><span class="o">*</span><span class="n">R3</span><span class="o">*</span><span class="p">(</span><span class="mf">1.00</span><span class="o">-</span><span class="n">EPSI</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.00</span><span class="o">+</span><span class="n">EPSI</span><span class="o">*</span><span class="p">(</span><span class="mf">1.00</span><span class="o">-</span><span class="mf">2.00</span><span class="o">*</span><span class="n">R3</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="c"># ISOTROPIC SCATTERING</span>
                    <span class="n">F3</span><span class="o">=</span><span class="mf">1.00</span><span class="o">-</span><span class="mf">2.00</span><span class="o">*</span><span class="n">R3</span>
                <span class="c"># endif</span>
                <span class="n">THETAP</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">F3</span><span class="p">)</span>
                <span class="n">F5P</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THETAP</span><span class="p">)</span>
                <span class="n">GAMSEC</span><span class="o">=</span><span class="p">(</span><span class="n">EMS</span><span class="o">+</span><span class="n">ESEC</span><span class="p">)</span><span class="o">/</span><span class="n">EMS</span>
                <span class="c"># CALCULATE SECONDARY RECOIL ANGLE FROM FREE KINEMATICS</span>
                <span class="n">F5S</span><span class="o">=</span><span class="n">F5P</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ESTART</span><span class="o">/</span><span class="n">ESEC</span><span class="p">)</span><span class="o">*</span><span class="n">GAMM</span><span class="o">/</span><span class="n">GAMSEC</span>
                <span class="k">if</span><span class="p">(</span><span class="n">F5S</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">):</span>
                    <span class="n">F5S</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">THETAS</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">F5S</span><span class="p">)</span>
                <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R1</span>
                <span class="c"># CALCULATE NEW DIRECTION COSINES FROM INITIAL VALUES AND SCAT. ANGLES</span>
                <span class="n">DRCOS</span><span class="p">(</span><span class="n">DRXINIT</span><span class="p">,</span><span class="n">DRYINIT</span><span class="p">,</span><span class="n">DRZINIT</span><span class="p">,</span><span class="n">THETAS</span><span class="p">,</span><span class="n">PHIS</span><span class="p">,</span><span class="n">DRXX</span><span class="p">,</span><span class="n">DRYY</span><span class="p">,</span><span class="n">DRZZ</span><span class="p">)</span>
                <span class="c"># LOAD SECONDARY ELECTRON DATA  </span>
                <span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="n">NPMAX</span><span class="p">):</span>
                    <span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span>
                <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">' EVENT WITH N0 OF PRIMARIES GT 20 IN MIPCALC STOPPED PROGRAM'</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                <span class="n">ENM</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">ESEC</span>
                <span class="n">DIRX</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">DRXX</span> 
                <span class="n">DIRY</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">DRYY</span> 
                <span class="n">DIRZ</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">DRZZ</span>
                <span class="n">XS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">YS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">ZS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">TS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="n">IEVENT</span><span class="p">[</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="n">NP</span>
                <span class="c"># CALCULATE POSSIBLE SHELL EMISSIONS: AUGER OR FLUORESCENCE</span>
                <span class="n">IFLTST</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">if</span><span class="p">(</span><span class="n">WKLM</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">R9</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R9</span> <span class="o">&lt;</span> <span class="n">WKLM</span><span class="p">[</span><span class="n">I</span><span class="p">]):</span>
                        <span class="n">IFLTST</span><span class="o">=</span><span class="mi">1</span>
                <span class="c"># endif</span>
                <span class="k">if</span><span class="p">(</span><span class="n">IFLTST</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="c"># AUGER EMISSION WITHOUT FLUORESCENCE</span>
                    <span class="n">NAUG</span><span class="o">=</span><span class="n">NC0</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
                    <span class="n">EAVAUG</span><span class="o">=</span><span class="n">EC0</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">NAUG</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">JFL</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">NC0</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="o">+</span><span class="mi">1</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="n">NPMAX</span><span class="p">):</span>
                            <span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">' EVENT WITH N0 OF PRIMARIES &gt; 20 IN MIPCALC STOPPED PROGRAM'</span><span class="p">)</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                            <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                        <span class="n">ENM</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">EAVAUG</span>
                        <span class="c"># RANDOM EMISSION ANGLE</span>
                        <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">F3</span><span class="o">=</span><span class="mf">1.00</span><span class="o">-</span><span class="mf">2.00</span><span class="o">*</span><span class="n">R3</span>
                        <span class="n">THETAS</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">F3</span><span class="p">)</span>
                        <span class="n">F6</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span>
                        <span class="n">F5</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span>
                        <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                        <span class="n">F8</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span>
                        <span class="n">F9</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span>
                        <span class="n">DIRX</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span>
                        <span class="n">DIRY</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span>
                        <span class="n">DIRZ</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F6</span>
                        <span class="n">XS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                        <span class="n">YS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                        <span class="n">ZS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                        <span class="n">TS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                    <span class="n">IEVENT</span><span class="p">[</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="n">NP</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="c"># AUGER EMISSION AND FLUORESCENCE</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">NG2</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">NAUG</span><span class="o">=</span><span class="n">NG2</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
                        <span class="n">EAVAUG</span><span class="o">=</span><span class="n">EG2</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">NAUG</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">JFL</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">NG2</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                            <span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="o">+</span><span class="mi">1</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="n">NPMAX</span><span class="p">):</span>
                                <span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                                <span class="k">print</span><span class="p">(</span><span class="s">' EVENT WITH N0 OF PRIMARIES &gt; 20 IN MIPCALC STOPPED PROGRAM'</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                            <span class="n">ENM</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">EAVAUG</span>
                            <span class="c"># RANDOM EMISSION ANGLE</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THETAS</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                            <span class="n">F6</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span>
                            <span class="n">F5</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span>
                            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                            <span class="n">F8</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span>
                            <span class="n">F9</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span>
                            <span class="n">DIRX</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span>
                            <span class="n">DIRY</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span>
                            <span class="n">DIRZ</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F6</span>
                            <span class="n">XS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                            <span class="n">YS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                            <span class="n">ZS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                            <span class="n">TS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                        <span class="n">IEVENT</span><span class="p">[</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="n">NP</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">NG1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">NAUG</span><span class="o">=</span><span class="n">NG1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
                        <span class="n">EAVAUG</span><span class="o">=</span><span class="n">EG1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">NAUG</span><span class="p">)</span>
                        <span class="n">R9</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                        <span class="c"># FLUORESCENCE ABSORPTION DISTANCE</span>
                        <span class="n">DFL</span><span class="o">=-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">DSTFL</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">JFL</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">NG1</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                            <span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="o">+</span><span class="mi">1</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="n">NPMAX</span><span class="p">):</span>
                                <span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                                <span class="k">print</span><span class="p">(</span><span class="s">' EVENT WITH N0 OF PRIMARIES &gt; 20 IN MIPCALC STOPPED PROGRAM'</span><span class="p">)</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                                <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                            <span class="n">ENM</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">EAVAUG</span>
                            <span class="c"># RANDOM EMISSION ANGLE</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THETAS</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                            <span class="n">F6</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span>
                            <span class="n">F5</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span>
                            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                            <span class="n">F8</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span>
                            <span class="n">F9</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span>
                            <span class="n">DIRX</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span>
                            <span class="n">DIRY</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span>
                            <span class="n">DIRZ</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F6</span>
                            <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">THEFL</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span> 
                            <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                            <span class="n">PHifL</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                            <span class="n">XS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">DFL</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THEFL</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHifL</span><span class="p">)</span>
                            <span class="n">YS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">DFL</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THEFL</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHifL</span><span class="p">)</span>
                            <span class="n">ZS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">DFL</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THEFL</span><span class="p">)</span>  
                            <span class="n">TS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">DFL</span><span class="o">/</span><span class="n">VV</span>
                        <span class="n">IEVENT</span><span class="p">[</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="n">NP</span>  
                <span class="c"># endif</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">IA</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">14</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">14</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">19</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">24</span> <span class="ow">or</span> <span class="n">IA</span> <span class="o">==</span> <span class="mi">29</span><span class="p">)</span> <span class="p">:</span>
                <span class="c"># EXCITATION</span>
                <span class="c">#----------------------------------------------------------------</span>
                <span class="k">if</span><span class="p">(</span><span class="n">PENFRA</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">I</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">IPEN</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">GOTO10</span><span class="p">()</span>
                <span class="c"># POSSIBLE PENNING TRANSFER</span>
                <span class="n">R9</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">R9</span> <span class="o">&lt;</span> <span class="n">PENFRA</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">I</span><span class="p">]):</span>
                    <span class="c"># PENNING TRANSFER</span>
                    <span class="n">NP</span><span class="o">=</span><span class="n">NP</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="n">NPMAX</span><span class="p">):</span>
                        <span class="n">NPMAX</span><span class="o">=</span><span class="n">NP</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">' EVENT WITH N0 OF PRIMARIES &gt; 20 IN MIPCALC STOPPED PROGRAM'</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">NP</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>
                    <span class="c"># FINITE PENNING FIXED ELECTRON ENERGY TO 4.0EV</span>
                    <span class="n">ENM</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="mf">4.0</span>
                    <span class="c"># RANDOM EMISSION ANGLE</span>
                    <span class="n">R3</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">THETAS</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">R3</span><span class="p">)</span>
                    <span class="n">F6</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span>
                    <span class="n">F5</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">THETAS</span><span class="p">)</span>
                    <span class="n">R4</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">PHIS</span><span class="o">=</span><span class="n">TWOPI</span><span class="o">*</span><span class="n">R4</span>
                    <span class="n">F8</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span>
                    <span class="n">F9</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHIS</span><span class="p">)</span>
                    <span class="n">DIRX</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F9</span><span class="o">*</span><span class="n">F5</span>
                    <span class="n">DIRY</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F8</span><span class="o">*</span><span class="n">F5</span>
                    <span class="n">DIRZ</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=</span><span class="n">F6</span>
                    <span class="c"># PENNING TRANSFER DISTANCE</span>
                    <span class="n">ASIGN</span><span class="o">=</span><span class="mf">1.00</span>
                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">):</span>
                        <span class="n">ASIGN</span><span class="o">=-</span><span class="n">ASIGN</span>
                    <span class="n">R9</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">XS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span><span class="o">*</span><span class="n">ASIGN</span>
                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">):</span>
                        <span class="n">ASIGN</span><span class="o">=-</span><span class="n">ASIGN</span>
                    <span class="n">R9</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">YS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span><span class="o">*</span><span class="n">ASIGN</span>
                    <span class="n">R1</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">R1</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">):</span>
                        <span class="n">ASIGN</span><span class="o">=-</span><span class="n">ASIGN</span>
                    <span class="n">R9</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">ZS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">I</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span><span class="o">*</span><span class="n">ASIGN</span>
                    <span class="n">R9</span><span class="o">=</span><span class="n">DRAND48</span><span class="p">(</span><span class="n">RDUM</span><span class="p">)</span>
                    <span class="n">TS</span><span class="p">[</span><span class="n">K</span><span class="p">][</span><span class="n">NP</span><span class="p">]</span><span class="o">=-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">R9</span><span class="p">)</span><span class="o">*</span><span class="n">PENFRA</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="n">I</span><span class="p">]</span>
                    <span class="n">IEVENT</span><span class="p">[</span><span class="n">K</span><span class="p">]</span><span class="o">=</span><span class="n">NP</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">GOTO10</span><span class="p">()</span>
                <span class="c"># endif  </span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># ELASTIC</span>
                <span class="c">#-----------------------------------------------------------------</span>
                <span class="n">GOTO10</span><span class="p">()</span>
            <span class="c"># endif</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' NPMAX='</span><span class="p">,</span><span class="n">NPMAX</span><span class="p">)</span>
    <span class="n">update_globals</span><span class="p">()</span>
    <span class="k">return</span>
    <span class="c"># end</span>
</code></pre>